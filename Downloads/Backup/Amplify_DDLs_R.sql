USE ROLE OWNER_EDW_PROD;
USE WAREHOUSE EDW_PROD_INFA_WH;
USE DATABASE EDW_PROD;
USE SCHEMA STG;

DESC TABLE EDW_TEST.STG.LND_AMPLIFYDIRECT_NEWLOAN;


--LANDING

create or replace TABLE EDW_PROD.STG.LND_AMPLIFYDIRECT_NEWLOAN (
LENDER_ID VARCHAR(20),
PERSON_LAST_NM VARCHAR(60),
REQUIRED_COVERAGE_ID NUMBER(38,0),
REQUIRED_COVERAGE_STATUS_CD VARCHAR(2),
COLLATERAL_ID NUMBER(38,0),
QUOTE_STATE_CD VARCHAR(64),
SALE_CANCELLED_DT DATETIME(9),
PERSON_ID NUMBER(38,0),
QUOTE_TERM_TYPE_DC VARCHAR(50),
QUOTE_TERM_MONTH_QTY VARCHAR(256),
SALE_EFFECTIVE_DT DATETIME(9),
SALE_SALE_DT DATETIME(9),
COVERAGE_ID NUMBER(38,0),
COVERAGE_STATUS_CD VARCHAR(2),
LENDER_ADDRESS_LINE_1_TXT VARCHAR(200),
LENDER_ADDRESS_LINE_2_TXT VARCHAR(200),
LENDER_CITY_NM VARCHAR(60),
LENDER_STATE_CD VARCHAR(60),
LENDER_ZIP_CD VARCHAR(60),
EXPIRATION_DT DATETIME(9),
LENDER_NM VARCHAR(200),
LOAN_ORIGINATION_DT DATETIME(9),
PERSON_FIRST_NM VARCHAR(60),
PERSON_EMAIL_TXT VARCHAR(200),
VEHICLE_MAKE_TXT VARCHAR(510),
VEHICLE_MODEL_TXT VARCHAR(510),
MEMBER_CITY_NM VARCHAR(80),
MEMBER_ADDRESS_LINE_1_TXT VARCHAR(200),
MEMBER_ADDRESS_LINE_2_TXT VARCHAR(200),
MEMBER_ZIP_CD VARCHAR(60),
VIN VARCHAR(100),
Vehicle_Year VARCHAR(4),
Loan_Type VARCHAR(10),
Loan_Balance NUMBER(19,2),
Original_Balance NUMBER(19,2),
Payment_Amount NUMBER(19,2),
Payment_Due_Date DATETIME(9),
Payment_Frequency VARCHAR(10),
Member_Cell VARCHAR(10),
Loan_Closed_Date DATETIME(9),
Loan_Officer_Name VARCHAR(50),
Loan_Officer_Email VARCHAR(100),
"Opted-out" boolean,
MemberStartDate DATETIME(9),
BATCH_ID NUMBER(38,0),
HASH_ID VARCHAR(255),
UPDATE_USER_TX VARCHAR(255),
UPDATE_DT DATETIME(9),
CREATE_DT DATETIME(9),
LoanSource VARCHAR(25),
BranchID VARCHAR(25)
); 

--STAGING

DESC TABLE EDW_TEST.STG.STG_AMPLIFYDIRECT_NEWLOAN;

create or replace TABLE EDW_PROD.STG.STG_AMPLIFYDIRECT_NEWLOAN (
LENDER_ID VARCHAR(20),
PERSON_LAST_NM VARCHAR(60),
REQUIRED_COVERAGE_ID NUMBER(38,0),
REQUIRED_COVERAGE_STATUS_CD VARCHAR(2),
COLLATERAL_ID NUMBER(38,0),
QUOTE_STATE_CD VARCHAR(64),
SALE_CANCELLED_DT DATETIME(9),
PERSON_ID NUMBER(38,0),
QUOTE_TERM_TYPE_DC VARCHAR(50),
QUOTE_TERM_MONTH_QTY VARCHAR(256),
SALE_EFFECTIVE_DT DATETIME(9),
SALE_SALE_DT DATETIME(9),
COVERAGE_ID NUMBER(38,0),
COVERAGE_STATUS_CD VARCHAR(2),
LENDER_ADDRESS_LINE_1_TXT VARCHAR(200),
LENDER_ADDRESS_LINE_2_TXT VARCHAR(200),
LENDER_CITY_NM VARCHAR(60),
LENDER_STATE_CD VARCHAR(60),
LENDER_ZIP_CD VARCHAR(60),
EXPIRATION_DT DATETIME(9),
LENDER_NM VARCHAR(200),
LOAN_ORIGINATION_DT DATETIME(9),
PERSON_FIRST_NM VARCHAR(60),
PERSON_EMAIL_TXT VARCHAR(200),
VEHICLE_MAKE_TXT VARCHAR(510),
VEHICLE_MODEL_TXT VARCHAR(510),
MEMBER_CITY_NM VARCHAR(80),
MEMBER_ADDRESS_LINE_1_TXT VARCHAR(200),
MEMBER_ADDRESS_LINE_2_TXT VARCHAR(200),
MEMBER_ZIP_CD VARCHAR(60),
VIN VARCHAR(100),
Vehicle_Year VARCHAR(4),
Loan_Type VARCHAR(10),
Loan_Balance NUMBER(19,2),
Original_Balance NUMBER(19,2),
Payment_Amount NUMBER(19,2),
Payment_Due_Date DATETIME(9),
Payment_Frequency VARCHAR(10),
Member_Cell VARCHAR(10),
Loan_Closed_Date DATETIME(9),
Loan_Officer_Name VARCHAR(50),
Loan_Officer_Email VARCHAR(100),
"Opted-out" boolean,
MemberStartDate DATETIME(9),
BATCH_ID NUMBER(38,0),
HASH_ID VARCHAR(255),
UPDATE_USER_TX VARCHAR(255),
UPDATE_DT DATETIME(9),
CREATE_DT DATETIME(9),
LoanSource VARCHAR(25),
BranchID VARCHAR(25)
);

--TEMP

DESC TABLE EDW_TEST.STG.D_AMPLIFYDIRECT_NEWLOAN_TEMP;

create or replace TABLE EDW_PROD.STG.D_AMPLIFYDIRECT_NEWLOAN_TEMP (
    D_AMPLIFY_ID NUMBER(38,0) NOT NULL,
	LENDER_ID VARCHAR(20),
	PERSON_LAST_NM VARCHAR(60),
	REQUIRED_COVERAGE_ID NUMBER(38,0),
	REQUIRED_COVERAGE_STATUS_CD VARCHAR(2),
	COLLATERAL_ID NUMBER(38,0),
	QUOTE_STATE_CD VARCHAR(64),
	SALE_CANCELLED_DT DATETIME(9),
	PERSON_ID NUMBER(38,0),
	QUOTE_TERM_TYPE_DC VARCHAR(50),
	QUOTE_TERM_MONTH_QTY VARCHAR(256),
	SALE_EFFECTIVE_DT DATETIME(9),
	SALE_SALE_DT DATETIME(9),
	COVERAGE_ID NUMBER(38,0),
	COVERAGE_STATUS_CD VARCHAR(2),
	LENDER_ADDRESS_LINE_1_TXT VARCHAR(200),
	LENDER_ADDRESS_LINE_2_TXT VARCHAR(200),
	LENDER_CITY_NM VARCHAR(60),
	LENDER_STATE_CD VARCHAR(60),
	LENDER_ZIP_CD VARCHAR(60),
	EXPIRATION_DT DATETIME(9),
	LENDER_NM VARCHAR(200),
	LOAN_ORIGINATION_DT DATETIME(9),
	PERSON_FIRST_NM VARCHAR(60),
	PERSON_EMAIL_TXT VARCHAR(200),
	VEHICLE_MAKE_TXT VARCHAR(510),
	VEHICLE_MODEL_TXT VARCHAR(510),
	MEMBER_CITY_NM VARCHAR(80),
	MEMBER_ADDRESS_LINE_1_TXT VARCHAR(200),
	MEMBER_ADDRESS_LINE_2_TXT VARCHAR(200),
	MEMBER_ZIP_CD VARCHAR(60),
	VIN VARCHAR(100),
    Vehicle_Year VARCHAR(4),
    Loan_Type VARCHAR(10),
    Loan_Balance NUMBER(19,2),
    Original_Balance NUMBER(19,2),
    Payment_Amount NUMBER(19,2),
    Payment_Due_Date DATETIME(9),
    Payment_Frequency VARCHAR(10),
    Member_Cell VARCHAR(10),
    Loan_Closed_Date DATETIME(9),
    Loan_Officer_Name VARCHAR(50),
    Loan_Officer_Email VARCHAR(100),
    "Opted-out" boolean,
	MemberStartDate DATETIME(9),
	BATCH_ID NUMBER(38,0),
	HASH_ID VARCHAR(255),
	UPDATE_USER_TX VARCHAR(255),
	EFFECTIVE_FROM_DT DATETIME(9),
	EFFECTIVE_TO_DT DATETIME(9),
	CURRENT_FLG VARCHAR(1),
    LoanSource VARCHAR(25),
    BranchID VARCHAR(25)
);


--LookUp_Table
DESC TABLE EDW_TEST.STG.DELIM_LKP;

create or replace TABLE EDW_PROD.STG.DELIM_LKP (
	CREDIT_UNION VARCHAR(255),
	DELIM_CHAR VARCHAR(255)
);

--AUDIT_TABLE

DESC TABLE EDW_TEST.STG.AUDIT_AMPLIFYDIRECT;

create or replace TABLE EDW_PROD.STG.AUDIT_AMPLIFYDIRECT (
LENDER_NM VARCHAR(200),
FILE_NM VARCHAR(255),
BATCH_ID NUMBER(38,0),
PROCESSED_DT DATETIME(9)
);

--Error_table

DESC TABLE EDW_TEST.STG.ERROR_AMPLIFYDIRECT;

create or replace TABLE EDW_PROD.STG.ERROR_AMPLIFYDIRECT (
FILE_NM VARCHAR(255),
Error_Message VARCHAR(255),
PROCESSED_DT DATETIME(9)
);

--EPC_table

DESC TABLE EDW_TEST.STG.ETL_PROCESS_CONTROL_AMPLIFY;

create or replace TABLE EDW_PROD.STG.ETL_PROCESS_CONTROL_AMPLIFY (
	BATCH_ID NUMBER(38,0) NOT NULL,
	PROCESS_START_DT TIMESTAMP_NTZ(9),
	PROCESS_END_DT TIMESTAMP_NTZ(9),
	PROCESS_NAME VARCHAR(100),
	LWM_DATE TIMESTAMP_NTZ(9),
	HWM_DATE TIMESTAMP_NTZ(9),
	PROCESS_STATUS_CODE VARCHAR(1),
	PROCESS_STATUS_DESCRIPTION VARCHAR(20),
	FAILURE_REASON VARCHAR(255),
	SOURCE_SYSTEM_NAME VARCHAR(32)
);

--ETL_BATCH

DESC TABLE EDW_TEST.STG.ETL_BATCH_AMPLIFY;

create or replace TABLE EDW_PROD.STG.ETL_BATCH_AMPLIFY (
	BATCH_ID NUMBER(38,0) NOT NULL,
	BATCH_START_DT TIMESTAMP_NTZ(9),
	BATCH_END_DT TIMESTAMP_NTZ(9),
	SOURCE_SYSTEM VARCHAR(100),
	constraint PK_ETL_BATCH primary key (BATCH_ID)
);

--RUNTIME_ERROR

DESC TABLE EDW_TEST.STG.RUNTIME_ERROR_AMPLIFY;

create or replace TABLE EDW_PROD.STG.RUNTIME_ERROR_AMPLIFY (
	ID NUMBER(38,0),
	ERROR_CODE VARCHAR(100),
	ERRORMESSAGE VARCHAR(1000),
	SOURCE_FAILED_ROWS NUMBER(38,0),
	TARGET_FAILED_ROWS NUMBER(38,0),
	WORKFLOW_NAME VARCHAR(100),
	EXECUTION_DATE TIMESTAMP_NTZ(9),
	EXECUTION_BATCHID NUMBER(38,0),
	SESSION_NAME VARCHAR(50)
);

--RUNTIME_AUDIT

DESC TABLE EDW_TEST.STG.RUNTIME_AUDIT_AMPLIFY;

create or replace TABLE EDW_PROD.STG.RUNTIME_AUDIT_AMPLIFY (
	BATCH_ID NUMBER(38,0) NOT NULL,
	WORKFLOW_NAME VARCHAR(100) NOT NULL,
	EXECUTION_DATE TIMESTAMP_NTZ(9) NOT NULL,
	SOURCE_SUCCESS_ROWS NUMBER(38,0),
	SOURCE_THROUGHPUT NUMBER(10,4),
	TARGET_SUCCESS_ROWS NUMBER(38,0),
	TARGET_THROUGHPUT NUMBER(10,4),
	COUNT_INSERT_TEMP NUMBER(38,0),
	COUNT_UPDATE_TEMP NUMBER(38,0),
	COUNT_INSERT_TGT NUMBER(38,0),
	COUNT_UPDATE_TGT NUMBER(38,0),
	SESSION_NAME VARCHAR(50),
	RUNTIME NUMBER(10,2),
	primary key (BATCH_ID, WORKFLOW_NAME, EXECUTION_DATE)
);



--DIM
USE SCHEMA CDW;
DESC TABLE EDW_TEST.CDW.D_AMPLIFYDIRECT_NEWLOAN;

create or replace TABLE EDW_PROD.CDW.D_AMPLIFYDIRECT_NEWLOAN (
    D_AMPLIFY_ID NUMBER(38,0) NOT NULL,
	LENDER_ID VARCHAR(20),
	PERSON_LAST_NM VARCHAR(60),
	REQUIRED_COVERAGE_ID NUMBER(38,0),
	REQUIRED_COVERAGE_STATUS_CD VARCHAR(2),
	COLLATERAL_ID NUMBER(38,0),
	QUOTE_STATE_CD VARCHAR(64),
	SALE_CANCELLED_DT DATETIME(9),
	PERSON_ID NUMBER(38,0),
	QUOTE_TERM_TYPE_DC VARCHAR(50),
	QUOTE_TERM_MONTH_QTY VARCHAR(256),
	SALE_EFFECTIVE_DT DATETIME(9),
	SALE_SALE_DT DATETIME(9),
	COVERAGE_ID NUMBER(38,0),
	COVERAGE_STATUS_CD VARCHAR(2),
	LENDER_ADDRESS_LINE_1_TXT VARCHAR(200),
	LENDER_ADDRESS_LINE_2_TXT VARCHAR(200),
	LENDER_CITY_NM VARCHAR(60),
	LENDER_STATE_CD VARCHAR(60),
	LENDER_ZIP_CD VARCHAR(60),
	EXPIRATION_DT DATETIME(9),
	LENDER_NM VARCHAR(200),
	LOAN_ORIGINATION_DT DATETIME(9),
	PERSON_FIRST_NM VARCHAR(60),
	PERSON_EMAIL_TXT VARCHAR(200),
	VEHICLE_MAKE_TXT VARCHAR(510),
	VEHICLE_MODEL_TXT VARCHAR(510),
	MEMBER_CITY_NM VARCHAR(80),
	MEMBER_ADDRESS_LINE_1_TXT VARCHAR(200),
	MEMBER_ADDRESS_LINE_2_TXT VARCHAR(200),
	MEMBER_ZIP_CD VARCHAR(60),
	VIN VARCHAR(100),
    Vehicle_Year VARCHAR(4),
    Loan_Type VARCHAR(10),
    Loan_Balance NUMBER(19,2),
    Original_Balance NUMBER(19,2),
    Payment_Amount NUMBER(19,2),
    Payment_Due_Date DATETIME(9),
    Payment_Frequency VARCHAR(10),
    Member_Cell VARCHAR(10),
    Loan_Closed_Date DATETIME(9),
    Loan_Officer_Name VARCHAR(50),
    Loan_Officer_Email VARCHAR(100),
    "Opted-out" boolean,
	MemberStartDate DATETIME(9),
	BATCH_ID NUMBER(38,0),
	HASH_ID VARCHAR(255),
	UPDATE_USER_TX VARCHAR(255),
	EFFECTIVE_FROM_DT DATETIME(9),
	EFFECTIVE_TO_DT DATETIME(9),
	CURRENT_FLG VARCHAR(1),
    LoanSource VARCHAR(25),
    BranchID VARCHAR(25)
);
