USE LIMC
BEGIN TRAN;
/* Declare variables */
DECLARE 
	@Ticket NVARCHAR(15) = 'AIH12210',
	@RowsToChange INT

/* Step 1 - Calculate rows to be changed - same query as populate Storage table */
SELECT 
	@RowsToChange = count(1)
FROM 
	LIMC.dbo.ExelaReturnStaging  
WHERE
	ID IN
	(
		'1463963',
		'1425860',
		'1426090',
		'1426107',
		'1426144',
		'1489678',
		'1488895',
		'1420428',
		'1565309',
		'1565053',
		'1565091',
		'1307010',
		'1335491',
		'1336549',
		'1347877',
		'1411327',
		'1386288',
		'1422265',
		'1385715',
		'1385757',
		'1385387',
		'1423495',
		'1423287',
		'1416492',
		'1416503',
		'1416063',
		'1416989',
		'1417170',
		'1416787',
		'1386114',
		'1385892',
		'1422499',
		'1422529',
		'1421681',
		'1421289',
		'1421389',
		'1424590',
		'1409181',
		'1594773',
		'1594800',
		'1594447',
		'1487403',
		'1472269',
		'1472000',
		'1472162',
		'1472150',
		'1456071',
		'1472595',
		'1472313',
		'1473273',
		'1422733',
		'1422952',
		'1420616',
		'1489185',
		'1426374',
		'1417816',
		'1414687',
		'1491207',
		'1490757',
		'1490926',
		'1437297',
		'1426872',
		'1491403',
		'1491267',
		'1491253',
		'1491306',
		'1433396',
		'1433466',
		'1433580',
		'1487625',
		'1431729',
		'1490507',
		'1415767',
		'1489914',
		'1488141',
		'1425085',
		'1425200',
		'1424876',
		'1489324',
		'1489726',
		'1489727',
		'1490112',
		'1463987',
		'1464054',
		'1464070',
		'1464049',
		'1464111',
		'1425815',
		'1426007',
		'1426048',
		'1488975',
		'1420463',
		'1420613',
		'1420672',
		'1489152',
		'1423169',
		'1430910',
		'2192779',
		'1308107',
		'1451317',
		'1347866',
		'1347930',
		'1487246',
		'1385449',
		'1626011',
		'1626065',
		'1423192',
		'1423260',
		'1414170',
		'1599605',
		'1424227',
		'1487760',
		'1416454',
		'1424332',
		'1424424',
		'1424183',
		'1416878',
		'1416829',
		'1422668',
		'1422228',
		'1422259',
		'1422308',
		'1421672',
		'1421256',
		'1421300',
		'1408757',
		'1487676',
		'1471978',
		'1472039',
		'1472129',
		'1472016',
		'1455919',
		'1456044',
		'1472607',
		'1420085',
		'1472623',
		'1472560',
		'1473095',
		'1422718',
		'1422961',
		'1596758',
		'1596853',
		'1489170',
		'1489728',
		'1423075',
		'1422814',
		'1488782',
		'1426400',
		'1426195',
		'1416653',
		'1416364',
		'1414198',
		'1414258',
		'1491210',
		'1437100',
		'1437142',
		'1490737',
		'1490834',
		'1426904',
		'1488584',
		'1446288',
		'1490575',
		'1410606',
		'1431742',
		'1431786',
		'1431800',
		'1490518',
		'1416012',
		'1432723',
		'1488369',
		'1488383',
		'1489309',
		'1489712',
		'1489779',
		'1490544',
		'1463943',
		'1463950',
		'1464128',
		'1420059',
		'1489552',
		'1489583',
		'1488904',
		'1420516',
		'1489124',
		'1307017',
		'1335356',
		'1308915',
		'1349833',
		'1349840',
		'1451357',
		'1348163',
		'1411421',
		'1487252',
		'1385856',
		'1423316',
		'1423325',
		'1599626',
		'1424141',
		'1424206',
		'1424236',
		'1415725',
		'1415827',
		'1424285',
		'1424297',
		'1424111',
		'1424131',
		'1417150',
		'1417187',
		'1486885',
		'1422198',
		'1421239',
		'1421341',
		'1421408',
		'1421429',
		'1594731',
		'1472047',
		'1472059',
		'1471993',
		'1472216',
		'1456132',
		'1472626',
		'1472769',
		'1472936',
		'1422912',
		'1422940',
		'1596765',
		'1489719',
		'1426385',
		'1417912',
		'1416641',
		'1436966',
		'1490979',
		'1437338',
		'1491153',
		'1490815',
		'1491000',
		'1426851',
		'1488359',
		'1491314',
		'1491412',
		'1446383',
		'1446545',
		'1446586',
		'1491413',
		'1491239',
		'1491311',
		'1490480',
		'1490612',
		'1490617',
		'1433568',
		'1490383',
		'1431805',
		'1489819',
		'1433299',
		'1433150',
		'1425158',
		'1489278',
		'1489352',
		'1489400',
		'1489414',
		'1489250',
		'1490189',
		'1490220',
		'1429491',
		'1447406',
		'1464100',
		'1458812',
		'1464135',
		'1464147',
		'1464098',
		'1420176',
		'1426038',
		'1489691',
		'1488788',
		'1489135',
		'1420418',
		'1420506',
		'1420552',
		'1488928',
		'1489047',
		'1306082',
		'1334777',
		'1347908',
		'1347945',
		'1411313',
		'1411408',
		'1385409',
		'1626073',
		'1416582',
		'1423222',
		'1423308',
		'1414143',
		'1424012',
		'1423758',
		'1424376',
		'1415930',
		'1416115',
		'1424372',
		'1424475',
		'1410230',
		'1416858',
		'1416864',
		'1416963',
		'1416859',
		'1486892',
		'1422655',
		'1421222',
		'1421482',
		'1421489',
		'1421504',
		'1594440',
		'1487279',
		'1471975',
		'1472103',
		'1472075',
		'1456152',
		'1456168',
		'1455832',
		'1456059',
		'1472630',
		'1472778',
		'1472717',
		'1472411',
		'1472546',
		'1472617',
		'1472765',
		'1472892',
		'1420133',
		'1420168',
		'1422842',
		'1596725',
		'1596457',
		'1596750',
		'1596824',
		'1420618',
		'1489752',
		'1417829',
		'1414694',
		'1414294',
		'1437315',
		'1491011',
		'1491092',
		'1490934',
		'1426880',
		'1426912',
		'1491355',
		'1491238',
		'1491336',
		'1491342',
		'1490559',
		'1490598',
		'1490656',
		'1410551',
		'1415944',
		'1416031',
		'1432712',
		'1488109',
		'1488185',
		'1488239',
		'1417453',
		'1489330',
		'1489346',
		'1489440',
		'1490014',
		'1490136',
		'1489831',
		'1490519'
	)

/* Existence check for Storage tables - Exit if they exist */
	IF NOT EXISTS (SELECT *
				   FROM HDTStorage.sys.tables  
				   WHERE [Name] LIKE  @Ticket + '_%' AND [TYPE] IN (N'U'))
		BEGIN
			/* Backup ScanBatch Table */
			SELECT	
				*
			INTO	
				HDTStorage..AIH12210
			FROM 
				LIMC.dbo.ExelaReturnStaging 
			WHERE
				ID IN
				(
					'1463963',
					'1425860',
					'1426090',
					'1426107',
					'1426144',
					'1489678',
					'1488895',
					'1420428',
					'1565309',
					'1565053',
					'1565091',
					'1307010',
					'1335491',
					'1336549',
					'1347877',
					'1411327',
					'1386288',
					'1422265',
					'1385715',
					'1385757',
					'1385387',
					'1423495',
					'1423287',
					'1416492',
					'1416503',
					'1416063',
					'1416989',
					'1417170',
					'1416787',
					'1386114',
					'1385892',
					'1422499',
					'1422529',
					'1421681',
					'1421289',
					'1421389',
					'1424590',
					'1409181',
					'1594773',
					'1594800',
					'1594447',
					'1487403',
					'1472269',
					'1472000',
					'1472162',
					'1472150',
					'1456071',
					'1472595',
					'1472313',
					'1473273',
					'1422733',
					'1422952',
					'1420616',
					'1489185',
					'1426374',
					'1417816',
					'1414687',
					'1491207',
					'1490757',
					'1490926',
					'1437297',
					'1426872',
					'1491403',
					'1491267',
					'1491253',
					'1491306',
					'1433396',
					'1433466',
					'1433580',
					'1487625',
					'1431729',
					'1490507',
					'1415767',
					'1489914',
					'1488141',
					'1425085',
					'1425200',
					'1424876',
					'1489324',
					'1489726',
					'1489727',
					'1490112',
					'1463987',
					'1464054',
					'1464070',
					'1464049',
					'1464111',
					'1425815',
					'1426007',
					'1426048',
					'1488975',
					'1420463',
					'1420613',
					'1420672',
					'1489152',
					'1423169',
					'1430910',
					'2192779',
					'1308107',
					'1451317',
					'1347866',
					'1347930',
					'1487246',
					'1385449',
					'1626011',
					'1626065',
					'1423192',
					'1423260',
					'1414170',
					'1599605',
					'1424227',
					'1487760',
					'1416454',
					'1424332',
					'1424424',
					'1424183',
					'1416878',
					'1416829',
					'1422668',
					'1422228',
					'1422259',
					'1422308',
					'1421672',
					'1421256',
					'1421300',
					'1408757',
					'1487676',
					'1471978',
					'1472039',
					'1472129',
					'1472016',
					'1455919',
					'1456044',
					'1472607',
					'1420085',
					'1472623',
					'1472560',
					'1473095',
					'1422718',
					'1422961',
					'1596758',
					'1596853',
					'1489170',
					'1489728',
					'1423075',
					'1422814',
					'1488782',
					'1426400',
					'1426195',
					'1416653',
					'1416364',
					'1414198',
					'1414258',
					'1491210',
					'1437100',
					'1437142',
					'1490737',
					'1490834',
					'1426904',
					'1488584',
					'1446288',
					'1490575',
					'1410606',
					'1431742',
					'1431786',
					'1431800',
					'1490518',
					'1416012',
					'1432723',
					'1488369',
					'1488383',
					'1489309',
					'1489712',
					'1489779',
					'1490544',
					'1463943',
					'1463950',
					'1464128',
					'1420059',
					'1489552',
					'1489583',
					'1488904',
					'1420516',
					'1489124',
					'1307017',
					'1335356',
					'1308915',
					'1349833',
					'1349840',
					'1451357',
					'1348163',
					'1411421',
					'1487252',
					'1385856',
					'1423316',
					'1423325',
					'1599626',
					'1424141',
					'1424206',
					'1424236',
					'1415725',
					'1415827',
					'1424285',
					'1424297',
					'1424111',
					'1424131',
					'1417150',
					'1417187',
					'1486885',
					'1422198',
					'1421239',
					'1421341',
					'1421408',
					'1421429',
					'1594731',
					'1472047',
					'1472059',
					'1471993',
					'1472216',
					'1456132',
					'1472626',
					'1472769',
					'1472936',
					'1422912',
					'1422940',
					'1596765',
					'1489719',
					'1426385',
					'1417912',
					'1416641',
					'1436966',
					'1490979',
					'1437338',
					'1491153',
					'1490815',
					'1491000',
					'1426851',
					'1488359',
					'1491314',
					'1491412',
					'1446383',
					'1446545',
					'1446586',
					'1491413',
					'1491239',
					'1491311',
					'1490480',
					'1490612',
					'1490617',
					'1433568',
					'1490383',
					'1431805',
					'1489819',
					'1433299',
					'1433150',
					'1425158',
					'1489278',
					'1489352',
					'1489400',
					'1489414',
					'1489250',
					'1490189',
					'1490220',
					'1429491',
					'1447406',
					'1464100',
					'1458812',
					'1464135',
					'1464147',
					'1464098',
					'1420176',
					'1426038',
					'1489691',
					'1488788',
					'1489135',
					'1420418',
					'1420506',
					'1420552',
					'1488928',
					'1489047',
					'1306082',
					'1334777',
					'1347908',
					'1347945',
					'1411313',
					'1411408',
					'1385409',
					'1626073',
					'1416582',
					'1423222',
					'1423308',
					'1414143',
					'1424012',
					'1423758',
					'1424376',
					'1415930',
					'1416115',
					'1424372',
					'1424475',
					'1410230',
					'1416858',
					'1416864',
					'1416963',
					'1416859',
					'1486892',
					'1422655',
					'1421222',
					'1421482',
					'1421489',
					'1421504',
					'1594440',
					'1487279',
					'1471975',
					'1472103',
					'1472075',
					'1456152',
					'1456168',
					'1455832',
					'1456059',
					'1472630',
					'1472778',
					'1472717',
					'1472411',
					'1472546',
					'1472617',
					'1472765',
					'1472892',
					'1420133',
					'1420168',
					'1422842',
					'1596725',
					'1596457',
					'1596750',
					'1596824',
					'1420618',
					'1489752',
					'1417829',
					'1414694',
					'1414294',
					'1437315',
					'1491011',
					'1491092',
					'1490934',
					'1426880',
					'1426912',
					'1491355',
					'1491238',
					'1491336',
					'1491342',
					'1490559',
					'1490598',
					'1490656',
					'1410551',
					'1415944',
					'1416031',
					'1432712',
					'1488109',
					'1488185',
					'1488239',
					'1417453',
					'1489330',
					'1489346',
					'1489440',
					'1490014',
					'1490136',
					'1489831',
					'1490519'
				)
				
			/* Does Storage Table meet expectations */
			IF( @@RowCount = @RowsToChange )
				BEGIN
					PRINT 'Storage table meets expections - continue'

					/* Step 3 - Perform table update */
					UPDATE 
						LIMC.dbo.ExelaReturnStaging 
					SET 
						active = 0
					WHERE
						ID IN
						(
							'1463963',
							'1425860',
							'1426090',
							'1426107',
							'1426144',
							'1489678',
							'1488895',
							'1420428',
							'1565309',
							'1565053',
							'1565091',
							'1307010',
							'1335491',
							'1336549',
							'1347877',
							'1411327',
							'1386288',
							'1422265',
							'1385715',
							'1385757',
							'1385387',
							'1423495',
							'1423287',
							'1416492',
							'1416503',
							'1416063',
							'1416989',
							'1417170',
							'1416787',
							'1386114',
							'1385892',
							'1422499',
							'1422529',
							'1421681',
							'1421289',
							'1421389',
							'1424590',
							'1409181',
							'1594773',
							'1594800',
							'1594447',
							'1487403',
							'1472269',
							'1472000',
							'1472162',
							'1472150',
							'1456071',
							'1472595',
							'1472313',
							'1473273',
							'1422733',
							'1422952',
							'1420616',
							'1489185',
							'1426374',
							'1417816',
							'1414687',
							'1491207',
							'1490757',
							'1490926',
							'1437297',
							'1426872',
							'1491403',
							'1491267',
							'1491253',
							'1491306',
							'1433396',
							'1433466',
							'1433580',
							'1487625',
							'1431729',
							'1490507',
							'1415767',
							'1489914',
							'1488141',
							'1425085',
							'1425200',
							'1424876',
							'1489324',
							'1489726',
							'1489727',
							'1490112',
							'1463987',
							'1464054',
							'1464070',
							'1464049',
							'1464111',
							'1425815',
							'1426007',
							'1426048',
							'1488975',
							'1420463',
							'1420613',
							'1420672',
							'1489152',
							'1423169',
							'1430910',
							'2192779',
							'1308107',
							'1451317',
							'1347866',
							'1347930',
							'1487246',
							'1385449',
							'1626011',
							'1626065',
							'1423192',
							'1423260',
							'1414170',
							'1599605',
							'1424227',
							'1487760',
							'1416454',
							'1424332',
							'1424424',
							'1424183',
							'1416878',
							'1416829',
							'1422668',
							'1422228',
							'1422259',
							'1422308',
							'1421672',
							'1421256',
							'1421300',
							'1408757',
							'1487676',
							'1471978',
							'1472039',
							'1472129',
							'1472016',
							'1455919',
							'1456044',
							'1472607',
							'1420085',
							'1472623',
							'1472560',
							'1473095',
							'1422718',
							'1422961',
							'1596758',
							'1596853',
							'1489170',
							'1489728',
							'1423075',
							'1422814',
							'1488782',
							'1426400',
							'1426195',
							'1416653',
							'1416364',
							'1414198',
							'1414258',
							'1491210',
							'1437100',
							'1437142',
							'1490737',
							'1490834',
							'1426904',
							'1488584',
							'1446288',
							'1490575',
							'1410606',
							'1431742',
							'1431786',
							'1431800',
							'1490518',
							'1416012',
							'1432723',
							'1488369',
							'1488383',
							'1489309',
							'1489712',
							'1489779',
							'1490544',
							'1463943',
							'1463950',
							'1464128',
							'1420059',
							'1489552',
							'1489583',
							'1488904',
							'1420516',
							'1489124',
							'1307017',
							'1335356',
							'1308915',
							'1349833',
							'1349840',
							'1451357',
							'1348163',
							'1411421',
							'1487252',
							'1385856',
							'1423316',
							'1423325',
							'1599626',
							'1424141',
							'1424206',
							'1424236',
							'1415725',
							'1415827',
							'1424285',
							'1424297',
							'1424111',
							'1424131',
							'1417150',
							'1417187',
							'1486885',
							'1422198',
							'1421239',
							'1421341',
							'1421408',
							'1421429',
							'1594731',
							'1472047',
							'1472059',
							'1471993',
							'1472216',
							'1456132',
							'1472626',
							'1472769',
							'1472936',
							'1422912',
							'1422940',
							'1596765',
							'1489719',
							'1426385',
							'1417912',
							'1416641',
							'1436966',
							'1490979',
							'1437338',
							'1491153',
							'1490815',
							'1491000',
							'1426851',
							'1488359',
							'1491314',
							'1491412',
							'1446383',
							'1446545',
							'1446586',
							'1491413',
							'1491239',
							'1491311',
							'1490480',
							'1490612',
							'1490617',
							'1433568',
							'1490383',
							'1431805',
							'1489819',
							'1433299',
							'1433150',
							'1425158',
							'1489278',
							'1489352',
							'1489400',
							'1489414',
							'1489250',
							'1490189',
							'1490220',
							'1429491',
							'1447406',
							'1464100',
							'1458812',
							'1464135',
							'1464147',
							'1464098',
							'1420176',
							'1426038',
							'1489691',
							'1488788',
							'1489135',
							'1420418',
							'1420506',
							'1420552',
							'1488928',
							'1489047',
							'1306082',
							'1334777',
							'1347908',
							'1347945',
							'1411313',
							'1411408',
							'1385409',
							'1626073',
							'1416582',
							'1423222',
							'1423308',
							'1414143',
							'1424012',
							'1423758',
							'1424376',
							'1415930',
							'1416115',
							'1424372',
							'1424475',
							'1410230',
							'1416858',
							'1416864',
							'1416963',
							'1416859',
							'1486892',
							'1422655',
							'1421222',
							'1421482',
							'1421489',
							'1421504',
							'1594440',
							'1487279',
							'1471975',
							'1472103',
							'1472075',
							'1456152',
							'1456168',
							'1455832',
							'1456059',
							'1472630',
							'1472778',
							'1472717',
							'1472411',
							'1472546',
							'1472617',
							'1472765',
							'1472892',
							'1420133',
							'1420168',
							'1422842',
							'1596725',
							'1596457',
							'1596750',
							'1596824',
							'1420618',
							'1489752',
							'1417829',
							'1414694',
							'1414294',
							'1437315',
							'1491011',
							'1491092',
							'1490934',
							'1426880',
							'1426912',
							'1491355',
							'1491238',
							'1491336',
							'1491342',
							'1490559',
							'1490598',
							'1490656',
							'1410551',
							'1415944',
							'1416031',
							'1432712',
							'1488109',
							'1488185',
							'1488239',
							'1417453',
							'1489330',
							'1489346',
							'1489440',
							'1490014',
							'1490136',
							'1489831',
							'1490519'
						)

					/* Step 4 - Inspect results - Commit/Rollback */
					IF ( @@ROWCOUNT = @RowsToChange )
						BEGIN
							PRINT 'SUCCESS - Performing Commit'
							COMMIT TRAN;
						END
					ELSE
						BEGIN
							PRINT 'FAILED TO UPDATE - Performing Rollback'
							ROLLBACK TRAN;
						END
					END
			ELSE
				BEGIN
					PRINT 'Storage does not meet expectations - rollback'
					ROLLBACK TRAN;
				END
		END
	ELSE
		BEGIN
			PRINT 'HD TABLE EXISTS - Stop work'
			ROLLBACK TRAN;
		END
