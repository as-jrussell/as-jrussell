---- DROP TABLE #TMPLOAN
SELECT * 
--INTO #TMPLOAN
FROM LOAN 
WHERE LOAN.LENDER_ID = 1122
AND LOAN.NUMBER_TX IN  ('77320-500',
'92740-510',
'212950-500',
'221860-500',
'226320-510',
'237540-500',
'249430-510',
'250310-510',
'259240-510',
'271100-510',
'278050-510',
'286130-511',
'288450-500',
'296290-510',
'297770-500',
'300310-511',
'302540-500',
'303120-510',
'311950-500',
'324740-500',
'330760-510',
'337460-510',
'360380-510',
'366320-511',
'374080-510',
'374240-500',
'377540-510',
'390650-510',
'393620-500',
'396280-560',
'397920-500',
'400630-510',
'404510-500',
'416810-510',
'416810-511',
'418970-510',
'422670-500',
'427470-510',
'433150-500',
'433230-500',
'463260-510',
'473810-511',
'485790-510',
'510290-510',
'510290-560',
'513910-511',
'529850-500',
'535530-501',
'537510-510',
'540560-510',
'552770-510',
'565640-510',
'567880-510',
'575050-510',
'593370-500',
'612830-500',
'613900-500',
'633540-510',
'637190-510',
'641540-500',
'666540-511',
'675120-501',
'675610-510',
'698070-510',
'699060-500',
'701360-510',
'729180-510',
'737590-500',
'742600-510',
'742600-513',
'751680-501',
'751680-510',
'771230-510',
'771230-512',
'771490-510',
'773210-510',
'773210-511',
'785270-500',
'791450-510',
'801190-500',
'801190-502',
'811740-510',
'843680-500',
'854310-510',
'867280-510',
'886170-510',
'889140-510',
'929650-500',
'950180-500',
'965290-510',
'975270-500',
'996970-510',
'996970-511',
'999030-510',
'1018990-510',
'1018990-511',
'1024420-510',
'1026400-500',
'1037130-510',
'1045960-510',
'1048770-510',
'1049430-510',
'1051140-510',
'1073670-510',
'1089440-510',
'1091570-510',
'1094620-510',
'1098430-510',
'1104780-510',
'1105100-510',
'1106270-510',
'1133080-500',
'1157170-510',
'1160610-510',
'1163430-500',
'1163430-510',
'1165820-510',
'1174320-510',
'1196440-510',
'1229940-510',
'1240160-500',
'1242300-510',
'1254270-560',
'1274720-510',
'1277870-510',
'1279440-500',
'1280820-510',
'1284390-510',
'1286940-510',
'1288350-500',
'1322660-510',
'1323810-511',
'1331320-500',
'1336520-510',
'1355330-500',
'1369860-510',
'1369940-510',
'1378690-501',
'1383470-500',
'1405740-500',
'1409210-510',
'1426610-500',
'1426870-510',
'1436440-510',
'1442790-510',
'1448730-510',
'1508700-510',
'1517870-510',
'1520250-500',
'1539570-510',
'1562730-510',
'1580710-510',
'1580710-512',
'1581390-511',
'1581390-512',
'1581390-513',
'1584850-510',
'1592850-510',
'1596810-510',
'1608120-510',
'1613230-510',
'1619760-510',
'1621310-510',
'1621720-500',
'1630300-510',
'1630300-511',
'1635010-511',
'1638080-510',
'1638080-511',
'1642770-500',
'1658110-510',
'1660900-510',
'1661080-500',
'1704640-510',
'1705220-510',
'1714540-510',
'1714540-512',
'1724450-510',
'1727420-510',
'1753560-500',
'1783500-510',
'1791920-500',
'1793900-510',
'1797130-510',
'1804220-500',
'1807940-510',
'1819090-510',
'1823450-500',
'1826750-510',
'1829490-510',
'1834670-510',
'1834830-510',
'1839540-510',
'1840850-500',
'1846710-510',
'1856030-510',
'1870130-510',
'1873510-511',
'1884900-510',
'1890010-510',
'1895140-510',
'1900090-511',
'1911550-500',
'1913790-500',
'1913870-500',
'1914780-511',
'1915020-510',
'1919320-510',
'1920210-500',
'1920210-510',
'1928150-500',
'1944640-500',
'1946210-510',
'1955860-500',
'1958000-511',
'1959330-500',
'1967900-510',
'2026060-511',
'2032400-510',
'2032400-513',
'2032400-561',
'2037290-510',
'2041310-510',
'2041490-510',
'2042060-511',
'2051120-510',
'2055260-510',
'2075970-510',
'2111280-510',
'2133630-500',
'2155900-510',
'2167210-510',
'2167470-510',
'2178850-510',
'2189330-500',
'2211270-510',
'2236020-500',
'2238590-510',
'2239740-510',
'2268940-511',
'2276030-510',
'2289810-510',
'2305810-510',
'2321650-510',
'2335020-510',
'2336010-510',
'2353410-510',
'2357540-510',
'2363800-510',
'2365210-510',
'2373700-500',
'2380970-500',
'2394750-511',
'2401430-500',
'2404320-510',
'2414970-500',
'2415700-510',
'2443680-510',
'2445250-510',
'2448550-510',
'2455710-560',
'2462980-510',
'2470980-510',
'2470980-511',
'2489140-511',
'2604550-500',
'2607029-510',
'2607100-510',
'2607150-510',
'2607176-510',
'2607194-510',
'2607194-511',
'2607245-500',
'2607297-510',
'2607297-511',
'2607344-510',
'2607429-510',
'2607612-510',
'2607649-500',
'2607676-510',
'2607676-511',
'2607756-510',
'2607790-510',
'2607895-500',
'2607895-512',
'2608099-510',
'2608149-510',
'2608233-510',
'2608262-510',
'2608325-500',
'2608536-500',
'2608563-510',
'2608671-510',
'2608727-510',
'2608789-510',
'2608832-510',
'2608832-511',
'2608836-500',
'2608883-510',
'2608917-510',
'2608960-510',
'2609034-510',
'2609049-511',
'2609049-512',
'2609100-500',
'2609121-510',
'2609121-511',
'2609128-500',
'2609156-510',
'2609159-510',
'2609176-510',
'2609184-510',
'2609184-512',
'2609199-501',
'2609242-510',
'2609283-510',
'2609305-500',
'2609315-510',
'2609315-511',
'2609317-510',
'2609320-510',
'2609323-510',
'2609359-510',
'2609401-510',
'2609408-510',
'2609424-510',
'2609438-510',
'2609541-510',
'2609552-510',
'2609569-510',
'2609588-510',
'2609617-510',
'2609645-500',
'2609657-510',
'2609657-511',
'2609689-510',
'2609692-510',
'2609693-500',
'2609696-510',
'2609730-500',
'2609735-500',
'2609737-510',
'2609764-510',
'2609804-500',
'2609834-510',
'2609869-500',
'2609971-510',
'2610011-510',
'2610016-500',
'2610029-510',
'2610037-510',
'2610062-500',
'2610062-510',
'2610068-510',
'2610113-510',
'2610172-500',
'2610179-510',
'2610209-510',
'2610221-510',
'2610224-511',
'2610225-510',
'2610228-512',
'2610250-510',
'2610288-510',
'2610346-500',
'2610424-511',
'2610632-510',
'2610633-510',
'2610683-500',
'2610699-510',
'2610730-500',
'2610734-510',
'2610771-510',
'2610784-510',
'2610799-510',
'2610800-510',
'2610821-500',
'2610885-510',
'2610935-510',
'2610952-511',
'2610998-510',
'2610998-511',
'2611018-511',
'2611047-511',
'2611060-510',
'2611089-510',
'2611102-510',
'2611130-510',
'2611143-511',
'2611145-511',
'2611154-510',
'2611157-560',
'2611176-500',
'2611176-510',
'2611187-510',
'2611190-500',
'2611205-500',
'2611206-510',
'2611210-510',
'2611250-510',
'2611254-510',
'2611275-500',
'2611280-500',
'2611281-511',
'2611283-511',
'2611287-500',
'2611293-510',
'2611297-510',
'2611309-511',
'2611312-510',
'2611312-511',
'2611313-510',
'2611333-500',
'2611336-500',
'2611348-510',
'2611371-560',
'2611376-510',
'2611405-510',
'2611416-510',
'2611419-500',
'2611419-510',
'2611435-560',
'2611448-500',
'2611473-500',
'2611473-510',
'2611473-511',
'2611489-501',
'2611493-510',
'2611518-510',
'2611518-511',
'2611518-512',
'2611544-500',
'2611547-510',
'2611563-510',
'2611572-510',
'2611572-511',
'2611585-510',
'2611587-510',
'2611592-510',
'2611594-510',
'2611625-511',
'2611646-500',
'2611658-511',
'2611739-510',
'2611744-510',
'2611748-510',
'2611760-510',
'2611770-510',
'2611797-510',
'2611819-510',
'2611819-560',
'2611824-510',
'2611824-511',
'2611826-510',
'2611834-510',
'2611847-510',
'2611847-511',
'2611850-510',
'2611850-511',
'2611860-510',
'2611900-510',
'2611931-500',
'2611931-511',
'2611939-510',
'2612016-510',
'2612031-510',
'2612034-500',
'2612046-510',
'2612049-511',
'2612063-511',
'2612074-510',
'2612092-500',
'2612120-500',
'2612120-501',
'2612123-510',
'2612124-510',
'2612132-510',
'2612138-511',
'2612141-510',
'2612164-510',
'2612166-511',
'2612168-510',
'2612176-511',
'2612181-500',
'2612192-510',
'2612212-510',
'2612227-500',
'2612227-510',
'2612229-510',
'2612238-510',
'2612246-510',
'2612248-510',
'2612314-500',
'2612325-510',
'2612326-500',
'2612353-510',
'2612359-500',
'2612359-510',
'2612362-510',
'2612375-511',
'2612393-510',
'2612407-510',
'2612412-500',
'2612441-510',
'2612452-510',
'2612457-510',
'2612465-511',
'2612465-512',
'2612466-510',
'2612468-510',
'2612471-510',
'2612473-500',
'2612490-500',
'2612490-501',
'2612517-510',
'2612518-500',
'2612519-500',
'2612521-500',
'2612534-510',
'2612537-510',
'2612538-510',
'2612541-500',
'2612549-500',
'2612549-501',
'2612557-500',
'2612567-500',
'2612577-510',
'2612584-510',
'2612590-510',
'2612592-500',
'2612592-510',
'2612598-510',
'2612619-510',
'2612628-500',
'2612628-510',
'2612640-510',
'2612656-510',
'2612664-510',
'2612673-510',
'2612674-500',
'2612680-510',
'2612701-510',
'2612709-510',
'2612717-510',
'2612740-510',
'2612747-510',
'2612752-510',
'2612756-510',
'2612759-510',
'2612764-510',
'2612773-510',
'2612779-510',
'2612788-512',
'2612791-511',
'2612812-510',
'2612814-510',
'2612815-510',
'2612818-510',
'2612832-510',
'2612834-510',
'2612838-500',
'2612846-510',
'2612864-510',
'2612885-510',
'2612917-510',
'2612918-510',
'2612921-510',
'2612932-510',
'2612933-511',
'2612934-511',
'2612951-510',
'2612955-510',
'2612955-511',
'2612957-510',
'2612974-511',
'2612977-512',
'2612982-510',
'2612984-510',
'2612987-510',
'2613001-510',
'2613022-510',
'2613028-500',
'2613038-510',
'2613046-510',
'2613061-500',
'2613069-510',
'2613071-510',
'2613072-500',
'2613072-510',
'2613093-510',
'2613102-510',
'2613107-510',
'2613115-510',
'2613115-511',
'2613156-500',
'2613158-510',
'2613165-500',
'2613180-510',
'2613239-510',
'2613245-510',
'2613252-510',
'2613255-510',
'2613260-510',
'2613267-510',
'2613281-510',
'2613307-510',
'2613312-510',
'2613321-510',
'2613332-510',
'2613336-510',
'2613351-510',
'2613354-510',
'2613359-510',
'2613374-510',
'2613382-510',
'2613384-510',
'2613385-510',
'2613392-510',
'2613393-510',
'2613415-511',
'2613423-510',
'2613424-510',
'2613427-500',
'2613429-510',
'2613435-500',
'2613442-510',
'2613443-510',
'2613452-510',
'2613453-500',
'2613473-510',
'2613476-500',
'2613477-500',
'2613478-510',
'2613507-510',
'2613517-500',
'2613524-510',
'2613535-510',
'2613538-500',
'2613550-510',
'2613557-500',
'2613562-510',
'2613569-500',
'2613569-510',
'2613579-510',
'2613591-510',
'2613618-510',
'2613630-510',
'2613646-510',
'2613647-510',
'2613653-510',
'2613655-510',
'2613662-510',
'2613664-510',
'2613672-510',
'2613684-510',
'2613684-560',
'2613693-510',
'2613700-510',
'2613708-510',
'2613718-510',
'2613736-510',
'2613738-510',
'2613746-510',
'2613746-511',
'2613751-510',
'2613761-510',
'2613770-500',
'2613780-510',
'2613806-510',
'2613827-510',
'2613830-500',
'2613851-510',
'2760105-500',
'2760121-511',
'2760129-511',
'2760131-510',
'2760151-510',
'2760161-500',
'2760237-510',
'2760241-510',
'2760253-510',
'2760267-510',
'2760269-510',
'2760279-511',
'2760291-500',
'2760333-510',
'2760355-511',
'2760361-510',
'2760365-510',
'2760367-510',
'2760369-510',
'2760371-500',
'2760389-500',
'2760399-510',
'2760409-500',
'2760429-510',
'2760447-510',
'2760475-510',
'2760479-510',
'2760491-510',
'2760503-510',
'2760505-510',
'2760529-510',
'2760553-510',
'2760615-510',
'250310-520',
'296290-520',
'299590-520',
'337460-520',
'404510-520',
'428790-520',
'508490-521',
'618870-500',
'633540-520',
'633880-520',
'666540-520',
'674210-520',
'697730-520',
'701360-520',
'843680-520',
'1026400-520',
'1037130-520',
'1133320-520',
'1196690-520',
'1222910-520',
'1274800-520',
'1288350-520',
'1348170-520',
'1393520-520',
'1490470-520',
'1557470-520',
'1599210-520',
'1611170-520',
'1635010-511',
'1638080-520',
'1650190-520',
'1750830-520',
'1763700-520',
'1802810-520',
'1879140-502',
'1900090-520',
'1931690-520',
'2032400-522',
'2049170-521',
'2085040-520',
'2155900-520',
'2195680-520',
'2258050-520',
'2302680-520',
'2336010-520',
'2359370-520',
'2365210-521',
'2405070-520',
'2607676-520',
'2607895-512',
'2608302-520',
'2608488-520',
'2608971-520',
'2609199-520',
'2609270-520',
'2609617-520',
'2609696-520',
'2609994-521',
'2610011-521',
'2610016-520',
'2610037-520',
'2610121-520',
'2610228-512',
'2610253-520',
'2610701-520',
'2610828-520',
'2610959-520',
'2611120-520',
'2611250-520',
'2611282-520',
'2611347-520',
'2611371-520',
'2611518-520',
'2611555-520',
'2611770-520',
'2611826-520',
'2611854-520',
'2612007-520',
'2612016-520',
'2612079-520',
'2612212-520',
'2612226-520',
'2612246-520',
'2612251-520',
'2612267-520',
'2612325-520',
'2612359-520',
'2612365-520',
'2612367-520',
'2612536-520',
'2612573-520',
'2612752-520',
'2612818-520',
'2612933-520',
'2613021-520',
'2613058-520',
'2613072-520',
'2613102-520',
'2613156-520',
'2613180-520',
'2613333-520',
'2613370-520',
'2613373-520',
'2088760-521',
'2611037-521')
----- 43123

---- DROP TABLE #TMPLOAN_01
SELECT * 
INTO #TMPLOAN_01
FROM #TMPLOAN

---- 230


----- DROP TABLE #TMPRC
SELECT T1.ID AS LOAN_ID ,  T1.NUMBER_TX , T1.BRANCH_CODE_TX , T1.DIVISION_CODE_TX , T1.RECORD_TYPE_CD , 
T1.STATUS_CD AS LN_STATUS_CD , T1.EXTRACT_UNMATCH_COUNT_NO AS LN_EXTRACT_UNMATCH_COUNT_NO , 
COLL.ID AS COLL_ID , COLL.COLLATERAL_CODE_ID , COLL.PROPERTY_ID , COLL.PRIMARY_LOAN_IN , 
COLL.STATUS_CD AS COLL_STATUS_CD , COLL.EXTRACT_UNMATCH_COUNT_NO AS COLL_EXTRACT_UNMATCH_COUNT_NO ,
PR.RECORD_TYPE_CD AS PR_RECORD_TYPE_CD , PR.ADDRESS_ID , 
OA.LINE_1_TX , OA.CITY_TX , OA.STATE_PROV_TX , OA.POSTAL_CODE_TX , 
RC.ID AS RC_ID , RC.TYPE_CD AS RC_TYPE_CD , RC.NOTICE_DT , RC.NOTICE_SEQ_NO , 
RC.NOTICE_TYPE_CD , RC.CPI_QUOTE_ID , RC.LAST_EVENT_DT , 
RC.LAST_EVENT_SEQ_ID , RC.LAST_SEQ_CONTAINER_ID , RC.RECORD_TYPE_CD AS RC_RECORD_TYPE_CD , 
CC.CODE_TX AS CC_CODE_TX , CC.DESCRIPTION_TX AS CC_DESCRIPTION_TX ,
0 AS EXCLUDE
INTO #TMPRC
FROM #TMPLOAN_01 t1
JOIN COLLATERAL COLL ON COLL.LOAN_ID = T1.ID
AND COLL.PURGE_DT IS NULL AND T1.PURGE_DT IS NULL
JOIN PROPERTY PR ON PR.ID = COLL.PROPERTY_ID
AND PR.PURGE_DT IS NULL
LEFT JOIN OWNER_ADDRESS OA ON OA.ID = PR.ADDRESS_ID
JOIN REQUIRED_COVERAGE RC ON RC.PROPERTY_ID = PR.ID
AND RC.PURGE_DT IS NULL
JOIN COLLATERAL_CODE CC ON CC.ID = COLL.COLLATERAL_CODE_ID
ORDER BY T1.NUMBER_TX
----459



UPDATE #TMPRC SET EXCLUDE = 1
WHERE LOAN_ID IN 
(
SELECT T1.LOAN_ID
FROM #TMPRC T1
JOIN COLLATERAL COLL ON COLL.PROPERTY_ID = T1.PROPERTY_ID
AND COLL.ID <> T1.COLL_ID
AND COLL.LOAN_ID <> T1.LOAN_ID
AND  COLL.PURGE_DT IS NULL
JOIN LOAN ON LOAN.ID = COLL.LOAN_ID
AND LOAN.PURGE_DT IS NULL
)
----24

---- DROP TABLE #TMPRC_01
SELECT * 
INTO #TMPRC_01
FROM #TMPRC
WHERE EXCLUDE = 0
ORDER BY NUMBER_TX
----- 435

--- DROP TABLE #TMPRC_02
SELECT * 
INTO #TMPRC_02
FROM #TMPRC
WHERE EXCLUDE = 1
ORDER BY NUMBER_TX
----- 24

--SELECT DISTINCT NUMBER_TX , BRANCH_CODE_TX , CC_CODE_TX  , RECORD_TYPE_CD FROM #TMPRC_02
--SELECT * FROM LENDER WHERE CODE_TX = '1729' AND PURGE_DT IS NULL
---- 306

--SELECT * FROM #TMPRC_01

---- 'Type' - for those that say HELOC - map to the HOM EQUITY under 1729, those that say 1st Mortgage - map to Mortgage/<Default>.
/*
SELECT * FROM LENDER_COLLATERAL_CODE_GROUP WHERE LENDER_ID = 306
SELECT CC.ID , CC.CODE_TX FROM LCCG_COLLATERAL_CODE_RELATE REL
JOIN COLLATERAL_CODE CC ON CC.ID = REL.COLLATERAL_CODE_ID
WHERE REL.PURGE_DT IS NULL
AND CC.PURGE_DT IS NULL
AND REL.LCCG_ID = 1462
/*
ID	CODE_TX
2	<DEFAULT>
41	HOM EQUITY
*/
*/


SELECT NUMBER_TX , LOAN_ID , WI.*
INTO #TMPWI
	FROM WORK_ITEM WI JOIN #TMPRC_01 T1 ON T1.LOAN_ID = WI.RELATE_ID
where WI.status_cd not in ('Complete', 'Error', 'Withdrawn')
and WI.purge_dt is null
and WI.relate_type_cd = 'Allied.UniTrac.Loan'
----- 2

SELECT LN.*
into unitrachdstorage..INC0487008_LN
FROM LOAN LN JOIN #TMPRC_01 T1 ON T1.LOAN_ID = LN.ID

SELECT PR.*
into unitrachdstorage..INC0487008_PR
FROM PROPERTY PR JOIN #TMPRC_01 T1 ON T1.PROPERTY_ID = PR.ID

 SELECT  SF.*
 into unitrachdstorage..INC0487008_SF
	FROM #TMPRC_01 t
	JOIN SEARCH_FULLTEXT sf ON sf.PROPERTY_ID = t.PROPERTY_ID

SELECT wi.*
 into unitrachdstorage..INC0487008_WI
	FROM WORK_ITEM WI JOIN #TMPRC_01 T1 ON T1.LOAN_ID = WI.RELATE_ID
where WI.status_cd not in ('Complete', 'Error', 'Withdrawn')
and WI.purge_dt is null
and WI.relate_type_cd = 'Allied.UniTrac.Loan'

SELECT EQ.*
 into unitrachdstorage..INC0487008_EQ
	from #TMPRC_01 t    
    inner join EVALUATION_QUEUE eq on T.RC_ID = eq.REQUIRED_COVERAGE_ID and eq.PURGE_DT is null
	----- 0
	
 SELECT EE.*
  into unitrachdstorage..INC0487008_EE
	from #TMPRC_01 t   
    inner join EVALUATION_EVENT ee on ee.REQUIRED_COVERAGE_ID = T.RC_ID and ee.PURGE_DT is null
	where ee.STATUS_CD = 'PEND'

	SELECT RC.*
	  into unitrachdstorage..INC0487008_RC
	from #TMPRC_01 t    
    inner join REQUIRED_COVERAGE rc on rc.ID = T.RC_ID 
    and rc.PURGE_DT is null 

UPDATE LN SET LENDER_ID = 1122 , RECORD_TYPE_CD = CASE WHEN LN.RECORD_TYPE_CD IN ( 'D' , 'A') THEN 'G' ELSE LN.RECORD_TYPE_CD END ,
STATUS_CD = 'A', LN.BRANCH_CODE_TX = '014900',EXTRACT_UNMATCH_COUNT_NO = 0  , UPDATE_DT = GETDATE() , UPDATE_USER_TX = 'INC0487008', 
LOCK_ID = LN.LOCK_ID % 255 + 1
---- SELECT DISTINCT LN.ID , LN.LENDER_ID , LN.STATUS_CD , LN.EXTRACT_UNMATCH_COUNT_NO , LN.DIVISION_CODE_TX
FROM LOAN LN JOIN #TMPRC_01 T1 ON T1.LOAN_ID = LN.ID
---- 218



UPDATE PR SET LENDER_ID = 1122 , 
RECORD_TYPE_CD = CASE WHEN PR.RECORD_TYPE_CD IN ( 'D' , 'A') THEN 'G' ELSE PR.RECORD_TYPE_CD END ,
UPDATE_DT = GETDATE() , UPDATE_USER_TX = 'INC0487008', 
LOCK_ID = PR.LOCK_ID % 255 + 1
---- SELECT DISTINCT PR.ID , PR.RECORD_TYPE_CD
FROM PROPERTY PR JOIN #TMPRC_01 T1 ON T1.PROPERTY_ID = PR.ID

----- 182


INSERT INTO
	PROPERTY_CHANGE (
		ENTITY_NAME_TX,
		ENTITY_ID,
		USER_TX,
		ATTACHMENT_IN,
		CREATE_DT,
		AGENCY_ID,
		DESCRIPTION_TX,
		DETAILS_IN,
		FORMATTED_IN,
		LOCK_ID,
		PARENT_NAME_TX,
		PARENT_ID,
		TRANS_STATUS_CD,
		UTL_IN)
SELECT DISTINCT
	'Allied.UniTrac.Loan',
	LOAN_ID,
	'INC0487008',
	'N',
	GETDATE(),
	1,
	'Moved Loan from Lender 018900 to 014900',
	'N',
	'Y',
	1,
	'Allied.UniTrac.Loan',
	LOAN_ID,
	'PEND',
	'N'
FROM #TMPRC_01
---- 218


update SEARCH_FULLTEXT
	set LENDER_ID = 1122,
		UPDATE_DT = GETDATE()
		----- SELECT DISTINCT SF.PROPERTY_ID
	FROM #TMPRC_01 t
	JOIN SEARCH_FULLTEXT sf ON sf.PROPERTY_ID = t.PROPERTY_ID
	----- 182
	
update WI
set CONTENT_XML.modify('replace value of (/Content/Lender/Code/text())[1] with ("014900")'),
	UPDATE_DT = GETDATE(),
	UPDATE_USER_TX = 'INC0487008',
	LOCK_ID = (WI.LOCK_ID + 1) % 256
	----- SELECT *
	FROM WORK_ITEM WI JOIN #TMPRC_01 T1 ON T1.LOAN_ID = WI.RELATE_ID
where WI.status_cd not in ('Complete', 'Error', 'Withdrawn')
and WI.purge_dt is null
and WI.relate_type_cd = 'Allied.UniTrac.Loan'
----- 2

update WI
set CONTENT_XML.modify('replace value of (/Content/Lender/Id/text())[1] with ("2107")'),
	UPDATE_DT = GETDATE(),
	UPDATE_USER_TX = 'INC0487008',
	LOCK_ID = (WI.LOCK_ID + 1) % 256
	----- SELECT *
	FROM WORK_ITEM WI JOIN #TMPRC_01 T1 ON T1.LOAN_ID = WI.RELATE_ID
where WI.status_cd not in ('Complete', 'Error', 'Withdrawn')
and WI.purge_dt is null
and WI.relate_type_cd = 'Allied.UniTrac.Loan'
----- 2

update WI
set CONTENT_XML.modify('replace value of (/Content/Lender/Name/text())[1] with ("River Valley Credit Union")'),
	UPDATE_DT = GETDATE(),
	UPDATE_USER_TX = 'INC0487008',
	LOCK_ID = (WI.LOCK_ID + 1) % 256
	----- SELECT *
	FROM WORK_ITEM WI JOIN #TMPRC_01 T1 ON T1.LOAN_ID = WI.RELATE_ID
where WI.status_cd not in ('Complete', 'Error', 'Withdrawn')
and WI.purge_dt is null
and WI.relate_type_cd = 'Allied.UniTrac.Loan'
----- 2
	
update EQ
	set PURGE_DT = GETDATE(),
		UPDATE_DT = GETDATE(),
		UPDATE_USER_TX = 'INC0487008',
		LOCK_ID = (eq.LOCK_ID + 1) % 256
		---- SELECT EQ.*
	from #TMPRC_01 t    
    inner join EVALUATION_QUEUE eq on T.RC_ID = eq.REQUIRED_COVERAGE_ID and eq.PURGE_DT is null
	----- 0
	
update ee
	set STATUS_CD = 'CLR',
		PURGE_DT = GETDATE() ,
		UPDATE_DT = GETDATE() ,
		UPDATE_USER_TX = 'INC0487008',
		LOCK_ID = (ee.LOCK_ID + 1) % 256
		---- SELECT *
	from #TMPRC_01 t   
    inner join EVALUATION_EVENT ee on ee.REQUIRED_COVERAGE_ID = T.RC_ID and ee.PURGE_DT is null
	where ee.STATUS_CD = 'PEND'
	----- 0
	
---- NO CPI QUOTE & NO NOTICE CYCLE
update rc
	set UPDATE_DT = GETDATE() ,
		UPDATE_USER_TX = 'INC0487008',
		LOCK_ID = (rc.LOCK_ID + 1) % 256,
		GOOD_THRU_DT = null,
		LENDER_PRODUCT_ID = null,
		LCGCT_ID = null,
		NOTICE_DT = null,
		NOTICE_TYPE_CD = NULL,
		NOTICE_SEQ_NO = null,
		CPI_QUOTE_ID = null,
		LAST_EVENT_SEQ_ID = null,
		LAST_EVENT_DT = null,
		LAST_SEQ_CONTAINER_ID = null ,
		RECORD_TYPE_CD = CASE WHEN RC.RECORD_TYPE_CD IN ( 'D' , 'A') THEN 'G' ELSE RC.RECORD_TYPE_CD END 
		---- SELECT RC.RECORD_TYPE_CD , RC.CPI_QUOTE_ID , RC.NOTICE_SEQ_NO ,  *
	from #TMPRC_01 t    
    inner join REQUIRED_COVERAGE rc on rc.ID = T.RC_ID 
    and rc.PURGE_DT is null 
    ---- 435



	--Backout 
UPDATE LN SET LENDER_ID = T1.LENDER_ID , RECORD_TYPE_CD = T1.LENDER_ID,
STATUS_CD = T1.STATUS_CD, LN.BRANCH_CODE_TX = T1.BRANCH_CODE_TX,EXTRACT_UNMATCH_COUNT_NO = T1.EXTRACT_UNMATCH_COUNT_NO , UPDATE_DT = GETDATE() , UPDATE_USER_TX = 'INC0487008', 
LOCK_ID = LN.LOCK_ID % 255 + 1
---- SELECT DISTINCT LN.ID , LN.LENDER_ID , LN.STATUS_CD , LN.EXTRACT_UNMATCH_COUNT_NO , LN.DIVISION_CODE_TX
FROM LOAN LN JOIN unitrachdstorage..INC0487008_LN T1 ON T1.ID = LN.ID


UPDATE PR SET LENDER_ID = T1.LENDER_ID , RECORD_TYPE_CD = T1.LENDER_ID, UPDATE_DT = GETDATE() , UPDATE_USER_TX = 'INC0487008', 
LOCK_ID = PR.LOCK_ID % 255 + 1
---- SELECT DISTINCT PR.ID , PR.RECORD_TYPE_CD
FROM PROPERTY PR JOIN INC0487008_PR T1 ON T1.ID = PR.ID



update SF
	set LENDER_ID = 1141,
		UPDATE_DT = GETDATE()
		----- SELECT DISTINCT SF.PROPERTY_ID
	FROM SEARCH_FULLTEXT sf 
JOIN INC0487008_sf T ON sf.ID  = t.id
	----- 182
	
update WI
set CONTENT_XML = T.CONTENT_XML
	UPDATE_DT = GETDATE(),
	UPDATE_USER_TX = 'INC0487008',
	LOCK_ID = (WI.LOCK_ID + 1) % 256
	----- SELECT *
	FROM WORK_ITEM WI JOIN INC0487008_WI T ON wi.ID  = t.id

----- 2

update EQ
	set PURGE_DT = T.PURGE_DT,
		UPDATE_DT = GETDATE(),
		UPDATE_USER_TX = 'INC0487008',
		LOCK_ID = (eq.LOCK_ID + 1) % 256
		---- SELECT EQ.*
	from EVALUATION_QUEUE eq 
	JOIN INC0487008_EQ T ON eq.ID  = t.id
	
	----- 0
	
update ee
	set STATUS_CD = T.STATUS_CD,
		PURGE_DT = T.PURGE_DT ,
		UPDATE_DT = GETDATE() ,
		UPDATE_USER_TX = 'INC0487008',
		LOCK_ID = (ee.LOCK_ID + 1) % 256
		---- SELECT *
	from EVALUATION_EVENT ee
	JOIN INC0487008_EE T ON EE.ID  = t.id
	
	----- 0

	update rc
	set UPDATE_DT = GETDATE() ,
		UPDATE_USER_TX = 'INC0487008',
		LOCK_ID = (rc.LOCK_ID + 1) % 256,
		GOOD_THRU_DT = T.GOOD_THRU_DT,
		LENDER_PRODUCT_ID = T.LENDER_PRODUCT_ID,
		LCGCT_ID = T.LCGCT_ID,
		NOTICE_DT = T.NOTICE_DT,
		NOTICE_TYPE_CD = T.NOTICE_TYPE_CD,
		NOTICE_SEQ_NO = T.NOTICE_SEQ_NO,
		CPI_QUOTE_ID = T.CPI_QUOTE_ID,
		LAST_EVENT_SEQ_ID = T.CPI_QUOTE_ID,
		LAST_EVENT_DT = T.LAST_EVENT_DT,
		LAST_SEQ_CONTAINER_ID = T.LAST_SEQ_CONTAINER_ID ,
		RECORD_TYPE_CD = T.RECORD_TYPE_CD
		---- SELECT RC.RECORD_TYPE_CD , RC.CPI_QUOTE_ID , RC.NOTICE_SEQ_NO ,  *
	from REQUIRED_COVERAGE rc
	JOIN INC0487008_RC T ON RC.ID  = t.id



	delete pc
--select * 
from PROPERTY_CHANGE pc
where pc.ENTITY_NAME_TX = 'Allied.UniTrac.Loan'
and USER_TX = 'INC0487008'
and ENTITY_ID IN (SELECT ID FROM UniTracHDStorage..INC0487008_LN)