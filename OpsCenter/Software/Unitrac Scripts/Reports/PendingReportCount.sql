
SELECT DISTINCT
	REPORT_ID,
	REPORT_DOMAIN_CD INTO #tmptable
FROM REPORT_CONFIG

SELECT
	COUNT(*) TotalPending
FROM REPORT_HISTORY
WHERE STATUS_CD = 'pend'


SELECT
			* INTO #tmpSubRH
		FROM OPENQUERY(SUBSCRIBERREPORTHISTORY, 'select id, status_cd from report_history where status_cd = ''PEND'' ')
		

		
		SELECT COUNT(*) ReplicationReady FROM report_history rh 
				JOIN #tmpSubRH sr	ON sr.ID = rh.ID
				wHERE rh.STATUS_CD = 'PEND' AND sr.STATUS_CD = 'PEND'

SELECT
	rh.REPORT_ID,
	tt.REPORT_DOMAIN_CD,
	MIN(CREATE_DT) EarliestCreateDate,
	MAX(CREATE_DT) MaximumCreateDate,
	COUNT(*) PendingCount
FROM REPORT_HISTORY rh
JOIN #tmptable tt
	ON rh.REPORT_ID = tt.REPORT_ID
WHERE STATUS_CD = 'pend'
GROUP BY	rh.REPORT_ID,
			tt.REPORT_DOMAIN_CD
ORDER BY COUNT(*) DESC

SELECT
	rh.REPORT_ID,
	tt.REPORT_DOMAIN_CD,
	MIN(CREATE_DT) EarliestCreateDate,
	MAX(CREATE_DT) MaximumCreateDate,
	COUNT(*) ReplicationPendingCount
FROM REPORT_HISTORY rh
JOIN #tmptable tt
	ON rh.REPORT_ID = tt.REPORT_ID
JOIN  #tmpSubRH sr	ON sr.ID = rh.ID
WHERE rh.STATUS_CD = 'pend' AND sr.STATUS_CD = 'PEND'
GROUP BY	rh.REPORT_ID,
			tt.REPORT_DOMAIN_CD
ORDER BY COUNT(*) DESC



SELECT
	COUNT(*) TotalErrorToday
FROM REPORT_HISTORY
WHERE STATUS_CD = 'err' AND CAST(UPDATE_DT AS date) = CAST(GETDATE() AS date) AND GENERATION_SOURCE_CD = 'u'
AND MSG_LOG_TX IS NOT NULL

SELECT
	COUNT(*) TotalCompleteToday
FROM REPORT_HISTORY rh
JOIN DOCUMENT_CONTAINER dc ON dc.ID = rh.DOCUMENT_CONTAINER_ID AND CAST(dc.CREATE_DT AS DATE) = CAST(GETDATE() AS date)
WHERE rh.STATUS_CD = 'comp' AND CAST(rh.UPDATE_DT AS date) = CAST(GETDATE() AS date) AND rh.GENERATION_SOURCE_CD = 'u'

SELECT
	rh.REPORT_ID,
	tt.REPORT_DOMAIN_CD,
	COUNT(*) CompletedCount
FROM REPORT_HISTORY rh
JOIN #tmptable tt
	ON rh.REPORT_ID = tt.REPORT_ID
	JOIN DOCUMENT_CONTAINER dc ON dc.ID = rh.DOCUMENT_CONTAINER_ID AND CAST(dc.CREATE_DT AS DATE) = CAST(GETDATE() AS date)
WHERE rh.STATUS_CD = 'comp' AND CAST(rh.UPDATE_DT AS date) = CAST(GETDATE() AS date) AND rh.GENERATION_SOURCE_CD = 'u'
GROUP BY	rh.REPORT_ID,
			tt.REPORT_DOMAIN_CD
ORDER BY COUNT(*) DESC

DROP TABLE #tmptable
DROP TABLE #tmpSubRH