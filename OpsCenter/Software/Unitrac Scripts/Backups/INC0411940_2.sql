USE [UniTrac]
GO 

--Loan Screen Information - LOAN/COLLATERAL/PROPERTY/OWNER/REQUIRED COVERAGE
SELECT DISTINCT L.ID [LoanID], IH.ID [InteractionHistory], RC.ID [RequiredCoverageID]
into #tmpIH
FROM LOAN L
INNER JOIN COLLATERAL C ON L.ID = C.LOAN_ID
INNER JOIN PROPERTY P ON C.PROPERTY_ID = P.ID
inner join dbo.REQUIRED_COVERAGE RC on RC.PROPERTY_ID = P.ID
INNER JOIN dbo.LENDER LL ON LL.ID = L.LENDER_ID
INNER JOIN dbo.INTERACTION_HISTORY IH ON IH.PROPERTY_ID = P.ID 
WHERE LL.CODE_TX IN ('1065') 
AND L.NUMBER_TX IN ( '2800318251',
'1280004191',
'2800265940',
'60563168',
'2800475085',
'2800009296',
'1280007790',
'2800025277',
'2800001876',
'1280005934',
'108818467',
'2800152353',
'2800521102',
'2800004707',
'1280005916',
'1280005366',
'2800459550',
'66337367',
'2800095594',
'1280003831',
'2800506764',
'2800494961',
'74966467',
'7729769',
'2800017229',
'1280008665',
'2800018723',
'2800450575',
'2800441608',
'2800158996',
'2800335321',
'2800512879',
'2800018451',
'2800405926',
'1280003321',
'2800432003',
'2800070456',
'2800005376',
'2800333805',
'2800234904',
'80337769',
'2800238236',
'2800253698',
'1280002069',
'2800016872',
'2800022065',
'2800513661',
'2800062594',
'2800465565',
'2800522688',
'22190167',
'2800415594',
'2800018304',
'88891967',
'2800453587',
'2800383040',
'2800250314',
'1280009171',
'2800155166',
'2800005704',
'2800513000',
'2800358398',
'2800328037',
'1280005726',
'11348667',
'1280000426',
'2800304590',
'2800417764',
'2800518116',
'2800424679',
'2800372647',
'1280003396',
'2800004795',
'2800400059',
'1280000721',
'2800160372',
'57027867',
'1280003809',
'2800075596',
'97485467',
'2800182095',
'1280004914',
'1280006440',
'2800299253',
'2800008398',
'2800019797',
'1280000240',
'2800445617',
'2800511640',
'2800425882',
'1280004086',
'1280000332',
'1280011532',
'2800060531',
'1280010166',
'1280005505',
'2800285013',
'2800503886',
'1280004908',
'2800134526',
'2800006825',
'97021767',
'72077667',
'2800498566',
'2800078707',
'2800343564',
'2800329282',
'2800120236',
'2800262566',
'2800020772',
'2800208544',
'1280008709',
'60778368',
'104024167',
'2800347581',
'2800008609',
'1280004684',
'2800216703',
'2800018648',
'2800115707',
'2800474427',
'2800238574',
'1280005669',
'2800008826',
'2800510279',
'2800020828',
'107729667',
'2800453470',
'2800476869',
'2800100162',
'1280002942',
'2800007980',
'2800018789',
'2800227155',
'2800539856',
'2800105666',
'2800338754',
'2800458776',
'2800422483',
'2800392587',
'2800072718',
'2800022575',
'45271967',
'2800314185',
'1280007309',
'2800441723',
'1280005292',
'1280005938',
'2800211803',
'2800464956',
'2800006057',
'2800282309',
'2800428381',
'2800021016',
'2800154722',
'1280003524',
'2800331247',
'2800316040',
'1280000638',
'2800016460',
'2800418820',
'2800137396',
'2800295335',
'2800005005',
'1280003812',
'1280006956',
'2800240794',
'2800326056',
'1280004265',
'2800259562',
'2800185676',
'2800006319',
'84920867',
'1280008343',
'2800394476',
'2800002484',
'2800019700',
'2800176253',
'2800073187',
'2800356129',
'2800180867',
'2800451458',
'1280000924',
'2800376481',
'2800426971',
'2800148278',
'95750467',
'2800207157',
'1280001011',
'2800306280',
'2800339091',
'45714567',
'2800469898',
'1280003596',
'2800487627',
'2800123354',
'1280010357',
'2800238681',
'2800234946',
'2800147882',
'2800433407',
'1280009723',
'2800469823',
'2800367654',
'2800115509',
'2800009556',
'2800475846',
'2800022702',
'2800341469',
'2800476596',
'2800153989',
'101461767',
'2800167336',
'64679467',
'2800420495',
'2800518082',
'1280002730',
'2800316818',
'44325368',
'1280007429',
'6245467',
'2800021012',
'1280010815',
'93066467',
'2800209260',
'2800255933',
'2800447522',
'2800514594',
'1280001185',
'2800476851',
'2800510774',
'1280008329',
'1280002172',
'2800205664',
'2800014663',
'1280004521',
'2800340222',
'2800378230',
'1280002812',
'2800519155',
'2800227684',
'1280003401',
'2800019833',
'2800021121',
'2800450864',
'2800227577',
'2800004786',
'1280001717',
'2800268191',
'2800513281',
'2800157840',
'1280004520',
'1280003534',
'1280001701',
'2800022775',
'2800375574',
'14585567',
'2800274595',
'2800379451',
'2800511335',
'1433067',
'2800480804',
'2800508596',
'2800295400',
'2800166403',
'2800452803',
'2800321644',
'2800062545',
'2800150258',
'4258867',
'2800306876',
'2800137172',
'1280006383',
'1280004502',
'2800016430',
'2800535672',
'2800303584',
'2800160430',
'2800170009',
'2800419323',
'2800422095',
'1280005107',
'2800345866',
'2800511962',
'2800230761',
'2800148674',
'2800248557',
'2800089985',
'1280004286',
'2800498426',
'69363367',
'1280006696',
'2800260636',
'2800532810',
'2800369650',
'2800340834',
'2800019244',
'2800460616',
'1280009444',
'2800285906',
'2800237444',
'2800512770',
'2800325231',
'42456767',
'2800186864',
'1280006726',
'61178467',
'2800414258',
'63654267',
'2800103539',
'2800486249',
'2800383370',
'2800001953',
'2800354140',
'2800509966',
'2800446151',
'2800088912',
'70133267',
'2800314169',
'2800519593',
'2800338820',
'2800382539',
'2800168813',
'2800341774',
'2800067544',
'2800076800',
'2800452951',
'2800511087',
'2800388387',
'2800451318',
'2800355824',
'2800007173',
'2800483048',
'2800233625',
'2800020321',
'2800019237',
'2800361889',
'1280001618',
'71729769',
'2800161362',
'2800504389',
'2800230639',
'63111367',
'88813967',
'2800119428',
'2800357630',
'1280011085',
'2800085579',
'2800104073',
'2800404341',
'2800482586',
'1280005539',
'2800362127',
'2800284354',
'2800331783',
'1280009247',
'2800448918',
'2800504751',
'92044067',
'2800216869',
'2800330173',
'2800388940',
'2800334472',
'2800016733',
'2800453983',
'2800232296',
'2800507861',
'2800254266',
'2800507929',
'2800455095',
'2800538296',
'2800521151',
'88392467',
'59781368',
'1280001564',
'2800022197',
'2800016895',
'2800371433',
'2800448694',
'2800108595',
'2800471183',
'2800405843',
'96493167',
'71437968',
'2800480168',
'63286369',
'1280009878',
'2800112266',
'1280005686',
'2800241388',
'2800002302',
'2800172385',
'2800391076',
'2800156248',
'2800465508',
'66384067',
'2800087658',
'2800103398',
'2800158145',
'2800407823',
'1280004403',
'2800008260',
'1280008204',
'2800316487',
'2800162667',
'1280004829',
'2800012897',
'2800416857',
'2800137800',
'2800536258',
'2800368595',
'64815967',
'70997567',
'2800506129',
'2800146942',
'1280006910',
'2800519510',
'2800002733',
'2800453207',
'2800102176',
'2800419356',
'2800022366',
'2800478154',
'85837868',
'13284967',
'2800017215',
'1280000472',
'48666367',
'2800005514',
'2800012137',
'2800154540',
'2800424497',
'73741067',
'2800309086',
'2800505147',
'44686368',
'1280000664',
'2800135598',
'82510168',
'2800215978',
'2800151991',
'1280010317',
'2800009693',
'2800416543',
'2800123040',
'1280003850',
'2800335131',
'2800015916',
'1280003883',
'2800007554',
'2800318640',
'2800325629',
'2800394765',
'2800345965',
'2800147023',
'49533468',
'84163868',
'2800024850',
'2800238459',
'2800361947',
'75829668',
'41997467',
'17437768',
'1280009610',
'2800451573',
'2800509743',
'2800008470',
'2800019246',
'2800097319',
'2800176840',
'2800508695',
'2800232858',
'81089568',
'2800495851',
'2800229920',
'2800147924',
'2800505030',
'2800237550',
'84398067',
'2800239747',
'2800022278',
'2800161271',
'2800018857',
'1280004237',
'2800015668',
'7095567',
'2800438075',
'2800006473',
'1280004948',
'2800316024',
'2800379824',
'2800420909',
'2800017906',
'2800016706',
'63774667',
'2800289791',
'2800333029',
'2800326791',
'2800337046',
'1280002083',
'2800509669',
'1280003336',
'78175167',
'57284667',
'2800403681',
'2800291383',
'2800060473',
'22646267',
'1280010065',
'2800492056',
'1280009432',
'2800373678',
'2800343234',
'2800020352',
'2800334027',
'2800004747',
'1280002101',
'2800137040',
'1280005699',
'2800355907',
'2800313211',
'51802767',
'2800413243',
'2800517910',
'2800016847',
'1280004801',
'2800164481',
'2800310597',
'1280001045',
'1280008811',
'2800163616',
'2800238582',
'2800341543',
'2800073641',
'2800525251',
'1280002996',
'2800087781',
'2800108785',
'2800398634',
'2800025423',
'2800275618',
'2800106359',
'2800336477',
'87842167',
'2800380780',
'2800410397',
'2800350874',
'2800376309',
'16948667',
'2800259364',
'2800322832',
'2800179109',
'2800350254') 


select n.id into #tmpNotice 
from loan L
join lender ll on ll.id = l.lender_id 
join notice n on l.id = n.loan_id
WHERE LL.CODE_TX IN ('1065') 
AND L.NUMBER_TX IN ( '2800318251',
'1280004191',
'2800265940',
'60563168',
'2800475085',
'2800009296',
'1280007790',
'2800025277',
'2800001876',
'1280005934',
'108818467',
'2800152353',
'2800521102',
'2800004707',
'1280005916',
'1280005366',
'2800459550',
'66337367',
'2800095594',
'1280003831',
'2800506764',
'2800494961',
'74966467',
'7729769',
'2800017229',
'1280008665',
'2800018723',
'2800450575',
'2800441608',
'2800158996',
'2800335321',
'2800512879',
'2800018451',
'2800405926',
'1280003321',
'2800432003',
'2800070456',
'2800005376',
'2800333805',
'2800234904',
'80337769',
'2800238236',
'2800253698',
'1280002069',
'2800016872',
'2800022065',
'2800513661',
'2800062594',
'2800465565',
'2800522688',
'22190167',
'2800415594',
'2800018304',
'88891967',
'2800453587',
'2800383040',
'2800250314',
'1280009171',
'2800155166',
'2800005704',
'2800513000',
'2800358398',
'2800328037',
'1280005726',
'11348667',
'1280000426',
'2800304590',
'2800417764',
'2800518116',
'2800424679',
'2800372647',
'1280003396',
'2800004795',
'2800400059',
'1280000721',
'2800160372',
'57027867',
'1280003809',
'2800075596',
'97485467',
'2800182095',
'1280004914',
'1280006440',
'2800299253',
'2800008398',
'2800019797',
'1280000240',
'2800445617',
'2800511640',
'2800425882',
'1280004086',
'1280000332',
'1280011532',
'2800060531',
'1280010166',
'1280005505',
'2800285013',
'2800503886',
'1280004908',
'2800134526',
'2800006825',
'97021767',
'72077667',
'2800498566',
'2800078707',
'2800343564',
'2800329282',
'2800120236',
'2800262566',
'2800020772',
'2800208544',
'1280008709',
'60778368',
'104024167',
'2800347581',
'2800008609',
'1280004684',
'2800216703',
'2800018648',
'2800115707',
'2800474427',
'2800238574',
'1280005669',
'2800008826',
'2800510279',
'2800020828',
'107729667',
'2800453470',
'2800476869',
'2800100162',
'1280002942',
'2800007980',
'2800018789',
'2800227155',
'2800539856',
'2800105666',
'2800338754',
'2800458776',
'2800422483',
'2800392587',
'2800072718',
'2800022575',
'45271967',
'2800314185',
'1280007309',
'2800441723',
'1280005292',
'1280005938',
'2800211803',
'2800464956',
'2800006057',
'2800282309',
'2800428381',
'2800021016',
'2800154722',
'1280003524',
'2800331247',
'2800316040',
'1280000638',
'2800016460',
'2800418820',
'2800137396',
'2800295335',
'2800005005',
'1280003812',
'1280006956',
'2800240794',
'2800326056',
'1280004265',
'2800259562',
'2800185676',
'2800006319',
'84920867',
'1280008343',
'2800394476',
'2800002484',
'2800019700',
'2800176253',
'2800073187',
'2800356129',
'2800180867',
'2800451458',
'1280000924',
'2800376481',
'2800426971',
'2800148278',
'95750467',
'2800207157',
'1280001011',
'2800306280',
'2800339091',
'45714567',
'2800469898',
'1280003596',
'2800487627',
'2800123354',
'1280010357',
'2800238681',
'2800234946',
'2800147882',
'2800433407',
'1280009723',
'2800469823',
'2800367654',
'2800115509',
'2800009556',
'2800475846',
'2800022702',
'2800341469',
'2800476596',
'2800153989',
'101461767',
'2800167336',
'64679467',
'2800420495',
'2800518082',
'1280002730',
'2800316818',
'44325368',
'1280007429',
'6245467',
'2800021012',
'1280010815',
'93066467',
'2800209260',
'2800255933',
'2800447522',
'2800514594',
'1280001185',
'2800476851',
'2800510774',
'1280008329',
'1280002172',
'2800205664',
'2800014663',
'1280004521',
'2800340222',
'2800378230',
'1280002812',
'2800519155',
'2800227684',
'1280003401',
'2800019833',
'2800021121',
'2800450864',
'2800227577',
'2800004786',
'1280001717',
'2800268191',
'2800513281',
'2800157840',
'1280004520',
'1280003534',
'1280001701',
'2800022775',
'2800375574',
'14585567',
'2800274595',
'2800379451',
'2800511335',
'1433067',
'2800480804',
'2800508596',
'2800295400',
'2800166403',
'2800452803',
'2800321644',
'2800062545',
'2800150258',
'4258867',
'2800306876',
'2800137172',
'1280006383',
'1280004502',
'2800016430',
'2800535672',
'2800303584',
'2800160430',
'2800170009',
'2800419323',
'2800422095',
'1280005107',
'2800345866',
'2800511962',
'2800230761',
'2800148674',
'2800248557',
'2800089985',
'1280004286',
'2800498426',
'69363367',
'1280006696',
'2800260636',
'2800532810',
'2800369650',
'2800340834',
'2800019244',
'2800460616',
'1280009444',
'2800285906',
'2800237444',
'2800512770',
'2800325231',
'42456767',
'2800186864',
'1280006726',
'61178467',
'2800414258',
'63654267',
'2800103539',
'2800486249',
'2800383370',
'2800001953',
'2800354140',
'2800509966',
'2800446151',
'2800088912',
'70133267',
'2800314169',
'2800519593',
'2800338820',
'2800382539',
'2800168813',
'2800341774',
'2800067544',
'2800076800',
'2800452951',
'2800511087',
'2800388387',
'2800451318',
'2800355824',
'2800007173',
'2800483048',
'2800233625',
'2800020321',
'2800019237',
'2800361889',
'1280001618',
'71729769',
'2800161362',
'2800504389',
'2800230639',
'63111367',
'88813967',
'2800119428',
'2800357630',
'1280011085',
'2800085579',
'2800104073',
'2800404341',
'2800482586',
'1280005539',
'2800362127',
'2800284354',
'2800331783',
'1280009247',
'2800448918',
'2800504751',
'92044067',
'2800216869',
'2800330173',
'2800388940',
'2800334472',
'2800016733',
'2800453983',
'2800232296',
'2800507861',
'2800254266',
'2800507929',
'2800455095',
'2800538296',
'2800521151',
'88392467',
'59781368',
'1280001564',
'2800022197',
'2800016895',
'2800371433',
'2800448694',
'2800108595',
'2800471183',
'2800405843',
'96493167',
'71437968',
'2800480168',
'63286369',
'1280009878',
'2800112266',
'1280005686',
'2800241388',
'2800002302',
'2800172385',
'2800391076',
'2800156248',
'2800465508',
'66384067',
'2800087658',
'2800103398',
'2800158145',
'2800407823',
'1280004403',
'2800008260',
'1280008204',
'2800316487',
'2800162667',
'1280004829',
'2800012897',
'2800416857',
'2800137800',
'2800536258',
'2800368595',
'64815967',
'70997567',
'2800506129',
'2800146942',
'1280006910',
'2800519510',
'2800002733',
'2800453207',
'2800102176',
'2800419356',
'2800022366',
'2800478154',
'85837868',
'13284967',
'2800017215',
'1280000472',
'48666367',
'2800005514',
'2800012137',
'2800154540',
'2800424497',
'73741067',
'2800309086',
'2800505147',
'44686368',
'1280000664',
'2800135598',
'82510168',
'2800215978',
'2800151991',
'1280010317',
'2800009693',
'2800416543',
'2800123040',
'1280003850',
'2800335131',
'2800015916',
'1280003883',
'2800007554',
'2800318640',
'2800325629',
'2800394765',
'2800345965',
'2800147023',
'49533468',
'84163868',
'2800024850',
'2800238459',
'2800361947',
'75829668',
'41997467',
'17437768',
'1280009610',
'2800451573',
'2800509743',
'2800008470',
'2800019246',
'2800097319',
'2800176840',
'2800508695',
'2800232858',
'81089568',
'2800495851',
'2800229920',
'2800147924',
'2800505030',
'2800237550',
'84398067',
'2800239747',
'2800022278',
'2800161271',
'2800018857',
'1280004237',
'2800015668',
'7095567',
'2800438075',
'2800006473',
'1280004948',
'2800316024',
'2800379824',
'2800420909',
'2800017906',
'2800016706',
'63774667',
'2800289791',
'2800333029',
'2800326791',
'2800337046',
'1280002083',
'2800509669',
'1280003336',
'78175167',
'57284667',
'2800403681',
'2800291383',
'2800060473',
'22646267',
'1280010065',
'2800492056',
'1280009432',
'2800373678',
'2800343234',
'2800020352',
'2800334027',
'2800004747',
'1280002101',
'2800137040',
'1280005699',
'2800355907',
'2800313211',
'51802767',
'2800413243',
'2800517910',
'2800016847',
'1280004801',
'2800164481',
'2800310597',
'1280001045',
'1280008811',
'2800163616',
'2800238582',
'2800341543',
'2800073641',
'2800525251',
'1280002996',
'2800087781',
'2800108785',
'2800398634',
'2800025423',
'2800275618',
'2800106359',
'2800336477',
'87842167',
'2800380780',
'2800410397',
'2800350874',
'2800376309',
'16948667',
'2800259364',
'2800322832',
'2800179109',
'2800350254') 


	update ih set purge_dt = null, update_dt = GETDATE(), update_user_tx = 'INC0411940',LOCK_ID = CASE WHEN LOCK_ID >= 255 THEN 1 ELSE LOCK_ID + 1 END	    	
	--select * 
	from  INTERACTION_HISTORY ih
     where ID IN (select InteractionHistory from #tmpIH)
 and RELATE_CLASS_TX = 'Allied.UniTrac.Notice' and TYPE_CD = 'NOTICE'
 and purge_dt is not null
     
    	update n set purge_dt = null, update_dt = GETDATE(), update_user_tx = 'INC0411940',LOCK_ID = CASE WHEN LOCK_ID >= 255 THEN 1 ELSE LOCK_ID + 1 END	    	
	--select * 
	from NOTICE_REQUIRED_COVERAGE_RELATE n
	where NOTICE_ID IN (select * from #tmpNotice)  and purge_dt is not null

     
	update n set purge_dt = null, update_dt = GETDATE(), update_user_tx = 'INC0411940',LOCK_ID = CASE WHEN LOCK_ID >= 255 THEN 1 ELSE LOCK_ID + 1 END	    	
	--select * 
	from  NOTICE n
	where ID IN  (select * from #tmpNotice)  and purge_dt is not null

		
	select * from  EVALUATION_EVENT 
	where REQUIRED_COVERAGE_ID IN (select RequiredCoverageId from #tmpIH) and STATUS_CD = 'NOTU'
  and purge_dt is not null
	



	update dc set purge_dt = null, update_dt = GETDATE(), update_user_tx = 'INC0411940',LOCK_ID = CASE WHEN LOCK_ID >= 255 THEN 1 ELSE LOCK_ID + 1 END	    	
		--select * 
	from  DOCUMENT_CONTAINER dc
	WHERE RELATE_ID IN  (select * from #tmpNotice) 
 AND RELATE_CLASS_NAME_TX = 'ALLIED.UNITRAC.NOTICE'
  and purge_dt is not null
