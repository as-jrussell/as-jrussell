USE UniTrac

SELECT M.* FROM UniTracHDStorage..metronorthvins M
JOIN dbo.PROPERTY P ON P.VIN_TX = M.VIN
--WHERE VIN IN ('1HGCP2F82BA028947','3FA6P0H75DR112618')
WHERE Lender_ID = '1141'
ORDER BY [New Acct Num] ASC




SELECT L.ID [LoanID], PP.* INTO #tmp1 FROM dbo.LOAN L
JOIN dbo.COLLATERAL C ON C.LOAN_ID = L.ID
JOIN dbo.PROPERTY P ON P.ID = C.PROPERTY_ID
JOIN #tmpP PP ON PP.ID = P.ID

SELECT L.ID, L.NUMBER_TX, P.* FROM dbo.LOAN L
JOIN dbo.COLLATERAL C ON C.LOAN_ID = L.ID
JOIN dbo.PROPERTY P ON P.ID = C.PROPERTY_ID
JOIN UniTracHDStorage..metronorthvins M ON M.VIN = P.VIN_TX
WHERE L.LENDER_ID = '1141' --AND L.NUMBER_TX = '300310-202'
AND P.VIN_TX IN ('1HGCP2F82BA028947','3FA6P0H75DR112618')

SELECT * FROM #tmp1
WHERE

 VIN IN ('1HGCP2F82BA028947','3FA6P0H75DR112618')
ORDER BY [New Acct Num] ASC

SELECT L.* 
INTO UniTracHDStorage..INC0249434_Loan
FROM dbo.LOAN L
JOIN dbo.COLLATERAL C ON C.LOAN_ID = L.ID
JOIN dbo.PROPERTY P ON P.ID = C.PROPERTY_ID
JOIN UniTracHDStorage..metronorthvins M ON  P.VIN_TX = 
WHERE L.LENDER_ID = '1141'


SELECT C.* 
INTO UniTracHDStorage..INC0249434_Collateral
FROM dbo.LOAN L
JOIN dbo.COLLATERAL C ON C.LOAN_ID = L.ID
JOIN dbo.PROPERTY P ON P.ID = C.PROPERTY_ID
JOIN UniTracHDStorage..metronorthvins M ON M.VIN = P.VIN_TX
WHERE L.LENDER_ID = '1141'

SELECT * FROM dbo.LENDER
WHERE ID = 1141
SELECT P.* 
INTO UniTracHDStorage..INC0249434_Property
FROM dbo.LOAN L
JOIN dbo.COLLATERAL C ON C.LOAN_ID = L.ID
JOIN dbo.PROPERTY P ON P.ID = C.PROPERTY_ID
JOIN UniTracHDStorage..metronorthvins M ON M.VIN = P.VIN_TX
WHERE L.LENDER_ID = '1141'

SELECT L.ID, L.NUMBER_TX 
FROM dbo.LOAN L
JOIN dbo.COLLATERAL C ON C.LOAN_ID = L.ID
JOIN dbo.PROPERTY P ON P.ID = C.PROPERTY_ID
JOIN UniTracHDStorage..metronorthvins M ON M.[VIN] = P.VIN_TX
WHERE L.LENDER_ID = '1141'


SELECT * FROM #tmp1

UPDATE L
SET L.NUMBER_TX = M.[New Acct Num], L.UPDATE_DT = GETDATE(), L.LOCK_ID = L.LOCK_ID+1,
L.UPDATE_USER_TX = 'INC0249434'
--SELECT * 
FROM dbo.LOAN L
JOIN #tmp1 M ON M.LoanID = L.ID
WHERE L.LENDER_ID = '1141'



--2) INSERT into PROPERTY_CHANGE table
INSERT INTO PROPERTY_CHANGE (ENTITY_NAME_TX,ENTITY_ID,USER_TX,ATTACHMENT_IN,CREATE_DT,AGENCY_ID,DETAILS_IN,FORMATTED_IN,LOCK_ID,PARENT_NAME_TX,PARENT_ID,TRANS_STATUS_CD,UTL_IN)
SELECT 'Allied.UniTrac.Loan',LOAN.ID,'INC0249434','N','2016-04-01 00:00:00.000',1,'Y','N',1,'Allied.UniTrac.Loan',LOAN.ID,'PEND','N'
FROM LOAN
WHERE ID IN (SELECT ID FROM UniTracHDStorage..INC0249434_Loan)
--42


--3) INSERT into PROPERTY_CHANGE_UPDATE table
INSERT INTO PROPERTY_CHANGE_UPDATE (CHANGE_ID, TABLE_NAME_TX, TABLE_ID, COLUMN_NM, FROM_VALUE_TX,TO_VALUE_TX,DATATYPE_NO,CREATE_DT,DISPLAY_IN,OPERATION_CD)
select PROPERTY_CHANGE.ID,'LOAN',ENTITY_ID,'NUMBER_TX',UniTracHDStorage..INC0249434_Loan.NUMBER_TX,LOAN.NUMBER_TX,1,'2016-04-01 00:00:00.000','Y','U'
from PROPERTY_CHANGE
INNER JOIN LOAN ON PROPERTY_CHANGE.ENTITY_ID = LOAN.ID AND ENTITY_NAME_TX = 'Allied.UniTrac.Loan' 
INNER JOIN UniTracHDStorage..INC0249434_Loan ON LOAN.ID = UniTracHDStorage..INC0249434_Loan.ID --AND ENTITY_NAME_TX = 'Allied.UniTrac.Loan' 
WHERE PROPERTY_CHANGE.CREATE_DT = '2016-04-01 00:00:00.000'
AND ENTITY_ID IN (SELECT ID FROM UniTracHDStorage..INC0249434_Loan)
--0

---4) Insert into LOAN_NUMBER Table (Leave old numbers for matching purposes)

INSERT INTO LOAN_NUMBER (LOAN_ID,NUMBER_TX,EFFECTIVE_DT,CREATE_DT,UPDATE_DT,UPDATE_USER_TX, LOCK_ID)
SELECT dbo.LOAN.ID, dbo.LOAN.NUMBER_TX,dbo.LOAN.EFFECTIVE_DT,GETDATE(),GETDATE(),'INC0249434',1
FROM UniTracHDStorage..INC0249434_Loan HD INNER JOIN dbo.LOAN ON HD.ID = LOAN.ID
--42

--5) Full Text Search Updates

--Create updates
SELECT 'EXEC SaveSearchFullText', PROPERTY.ID 
FROM PROPERTY
INNER JOIN COLLATERAL ON PROPERTY.ID = COLLATERAL.PROPERTY_ID
AND LOAN_ID in (select ID FROM UniTracHDStorage..INC0249434_Loan)
--42

EXEC SaveSearchFullText	22789865
EXEC SaveSearchFullText	37603095
EXEC SaveSearchFullText	13006729
EXEC SaveSearchFullText	47859812
EXEC SaveSearchFullText	19166215
EXEC SaveSearchFullText	115310920
EXEC SaveSearchFullText	14721194
EXEC SaveSearchFullText	47859717
EXEC SaveSearchFullText	14721303
EXEC SaveSearchFullText	21527109
EXEC SaveSearchFullText	32558515
EXEC SaveSearchFullText	121922976
EXEC SaveSearchFullText	21527093
EXEC SaveSearchFullText	30221891
EXEC SaveSearchFullText	34444138
EXEC SaveSearchFullText	35861698
EXEC SaveSearchFullText	21527102
EXEC SaveSearchFullText	47859752
EXEC SaveSearchFullText	14721448
EXEC SaveSearchFullText	51437774
EXEC SaveSearchFullText	118641785
EXEC SaveSearchFullText	34444156
EXEC SaveSearchFullText	92921096
EXEC SaveSearchFullText	99178045
EXEC SaveSearchFullText	34444158
EXEC SaveSearchFullText	86863553
EXEC SaveSearchFullText	53466996
EXEC SaveSearchFullText	57763575
EXEC SaveSearchFullText	62534361
EXEC SaveSearchFullText	69451966
EXEC SaveSearchFullText	65498125
EXEC SaveSearchFullText	72741296
EXEC SaveSearchFullText	78201001
EXEC SaveSearchFullText	55490110
EXEC SaveSearchFullText	81004937
EXEC SaveSearchFullText	75442075
EXEC SaveSearchFullText	89922669
EXEC SaveSearchFullText	83747474
EXEC SaveSearchFullText	34444173
EXEC SaveSearchFullText	34444182
EXEC SaveSearchFullText	47859920
EXEC SaveSearchFullText	47859921
EXEC SaveSearchFullText	34444195
EXEC SaveSearchFullText	108459659
EXEC SaveSearchFullText	34444192
EXEC SaveSearchFullText	47859987
EXEC SaveSearchFullText	47859988
EXEC SaveSearchFullText	49511255
EXEC SaveSearchFullText	49511256
EXEC SaveSearchFullText	62534388
EXEC SaveSearchFullText	99178066
EXEC SaveSearchFullText	65498491
EXEC SaveSearchFullText	69452033
EXEC SaveSearchFullText	57763597
EXEC SaveSearchFullText	89922701
EXEC SaveSearchFullText	62534357
EXEC SaveSearchFullText	108458880
EXEC SaveSearchFullText	129008447
EXEC SaveSearchFullText	92921098
EXEC SaveSearchFullText	89922671
EXEC SaveSearchFullText	83747477
EXEC SaveSearchFullText	86863562
EXEC SaveSearchFullText	96033143
EXEC SaveSearchFullText	102294177
EXEC SaveSearchFullText	105398583
EXEC SaveSearchFullText	106195304
EXEC SaveSearchFullText	99178041
EXEC SaveSearchFullText	72741299
EXEC SaveSearchFullText	72741300
EXEC SaveSearchFullText	72741313
EXEC SaveSearchFullText	75442093
EXEC SaveSearchFullText	86863589
EXEC SaveSearchFullText	89922699
EXEC SaveSearchFullText	78201014
EXEC SaveSearchFullText	75442092
EXEC SaveSearchFullText	81004948
EXEC SaveSearchFullText	78201015
EXEC SaveSearchFullText	81004949
EXEC SaveSearchFullText	89922698
EXEC SaveSearchFullText	83747492
EXEC SaveSearchFullText	83747494
EXEC SaveSearchFullText	86863588
EXEC SaveSearchFullText	96033165
EXEC SaveSearchFullText	92921125
EXEC SaveSearchFullText	92921124
EXEC SaveSearchFullText	96033164
EXEC SaveSearchFullText	92921109
EXEC SaveSearchFullText	111513184
EXEC SaveSearchFullText	78201005
EXEC SaveSearchFullText	99178053
EXEC SaveSearchFullText	102294194
EXEC SaveSearchFullText	108459168
EXEC SaveSearchFullText	96033150
EXEC SaveSearchFullText	92921108
EXEC SaveSearchFullText	102294193
EXEC SaveSearchFullText	105398596
EXEC SaveSearchFullText	13005989
EXEC SaveSearchFullText	13006014
EXEC SaveSearchFullText	13006205
EXEC SaveSearchFullText	13006843
EXEC SaveSearchFullText	13006855
EXEC SaveSearchFullText	13007297
EXEC SaveSearchFullText	13007299
EXEC SaveSearchFullText	13007322
EXEC SaveSearchFullText	17318021
EXEC SaveSearchFullText	17318154
EXEC SaveSearchFullText	17318303
EXEC SaveSearchFullText	17318326
EXEC SaveSearchFullText	17318328
EXEC SaveSearchFullText	22789868
EXEC SaveSearchFullText	22789897
EXEC SaveSearchFullText	28094323
EXEC SaveSearchFullText	30221886
EXEC SaveSearchFullText	35861705
EXEC SaveSearchFullText	37603083
EXEC SaveSearchFullText	39971865
EXEC SaveSearchFullText	39971907
EXEC SaveSearchFullText	44414140
EXEC SaveSearchFullText	44414141
EXEC SaveSearchFullText	47859681
EXEC SaveSearchFullText	47859729
EXEC SaveSearchFullText	47859898
EXEC SaveSearchFullText	53466975
EXEC SaveSearchFullText	53467053
EXEC SaveSearchFullText	55490143
EXEC SaveSearchFullText	57763583
EXEC SaveSearchFullText	57763587
EXEC SaveSearchFullText	62534368
EXEC SaveSearchFullText	65498017
EXEC SaveSearchFullText	65498120
EXEC SaveSearchFullText	65498279
EXEC SaveSearchFullText	69452014
EXEC SaveSearchFullText	72741303
EXEC SaveSearchFullText	75442084
EXEC SaveSearchFullText	75442088
EXEC SaveSearchFullText	78201009
EXEC SaveSearchFullText	78201010
EXEC SaveSearchFullText	81004931
EXEC SaveSearchFullText	81004932
EXEC SaveSearchFullText	81004943
EXEC SaveSearchFullText	83747490
EXEC SaveSearchFullText	83747497
EXEC SaveSearchFullText	86863578
EXEC SaveSearchFullText	86863579
EXEC SaveSearchFullText	89922686
EXEC SaveSearchFullText	89922687
EXEC SaveSearchFullText	89922711
EXEC SaveSearchFullText	89922712
EXEC SaveSearchFullText	89922713
EXEC SaveSearchFullText	89922714
EXEC SaveSearchFullText	92921051
EXEC SaveSearchFullText	92921114
EXEC SaveSearchFullText	92921115
EXEC SaveSearchFullText	96033153
EXEC SaveSearchFullText	96033154
EXEC SaveSearchFullText	99178028
EXEC SaveSearchFullText	99178057
EXEC SaveSearchFullText	99178058
EXEC SaveSearchFullText	99178062
EXEC SaveSearchFullText	99261105
EXEC SaveSearchFullText	102294160
EXEC SaveSearchFullText	102294182
EXEC SaveSearchFullText	102294197
EXEC SaveSearchFullText	102294198
EXEC SaveSearchFullText	105398598
EXEC SaveSearchFullText	105398599
EXEC SaveSearchFullText	105398600
EXEC SaveSearchFullText	106195280
EXEC SaveSearchFullText	106195302
EXEC SaveSearchFullText	108459167
EXEC SaveSearchFullText	108459291
EXEC SaveSearchFullText	108460020
EXEC SaveSearchFullText	111512737
EXEC SaveSearchFullText	115310886
EXEC SaveSearchFullText	115310928
EXEC SaveSearchFullText	115310956
EXEC SaveSearchFullText	118640966
EXEC SaveSearchFullText	124666596
EXEC SaveSearchFullText	125694102
EXEC SaveSearchFullText	125694103
EXEC SaveSearchFullText	129008439
EXEC SaveSearchFullText	129055597
EXEC SaveSearchFullText	130232142
EXEC SaveSearchFullText	131516266
EXEC SaveSearchFullText	132564959
EXEC SaveSearchFullText	140901897
EXEC SaveSearchFullText	141020874
EXEC SaveSearchFullText	141108405
EXEC SaveSearchFullText	141108406
EXEC SaveSearchFullText	141170729
EXEC SaveSearchFullText	141170738
EXEC SaveSearchFullText	141542734
EXEC SaveSearchFullText	142642857
EXEC SaveSearchFullText	143350713
EXEC SaveSearchFullText	143350714
EXEC SaveSearchFullText	143476949
EXEC SaveSearchFullText	143476950
EXEC SaveSearchFullText	143645649
EXEC SaveSearchFullText	143645665


SELECT * 
FROM dbo.LOAN L
JOIN dbo.COLLATERAL C ON C.LOAN_ID = L.ID
JOIN dbo.PROPERTY P ON P.ID = C.PROPERTY_ID
JOIN UniTracHDStorage..metronorthvins M ON M.[VIN] = P.VIN_TX
WHERE L.LENDER_ID <> '1141'
