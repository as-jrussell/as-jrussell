--CREATE TABLE #tmpFPCIDs ( 
--	ID bigint PRIMARY KEY
--) ON [PRIMARY]

--DECLARE @StartDateSpecial DATE
--DECLARE @EndDateSpecial DATE
--DECLARE @StartDate DATE
--DECLARE @EndDate DATE

--SET @EndDate = '2016-10-18T02:01:50'
--SET @EndDateSpecial = '2016-10-18T02:01:50'
--SET @StartDate = '2016-10-04T02:01:36'
--SET @StartDateSpecial = '2016-10-04T02:01:36'

--	--INSERT INTO #tmpFPCIDs (ID)	
--	--	SELECT SFPC.ID 
--	--	FROM #tmpSpecialFPCs SFPC
--	--	WHERE 
-- --     (
-- --      (SFPC.QUICK_ISSUE_IN = 'N' AND SFPC.NEW_ISSUE_DT BETWEEN @StartDateSpecial AND @EndDateSpecial) OR --only pulls the FPC IDs that fall between the Start/End date and have the special logic
-- --      (SFPC.QUICK_ISSUE_IN = 'Y' AND SFPC.NEW_ISSUE_DT BETWEEN @StartDate AND @EndDate)  ---use end date of prev & current cycle for QI
-- --     )
--	--	GROUP BY SFPC.ID

--INSERT INTO #tmpFPCIDs (ID)
--		SELECT DISTINCT FPC.ID
--		FROM FORCE_PLACED_CERTIFICATE FPC
--		JOIN LOAN L ON FPC.LOAN_ID = L.ID AND L.PURGE_DT IS NULL
--		JOIN FORCE_PLACED_CERT_REQUIRED_COVERAGE_RELATE FPCRCR ON FPCRCR.FPC_ID = FPC.ID AND FPCRCR.PURGE_DT IS NULL
--		JOIN REQUIRED_COVERAGE RC ON FPCRCR.REQUIRED_COVERAGE_ID = RC.ID AND RC.PURGE_DT IS NULL	
--		CROSS APPLY
--		(
--		  SELECT MIN(TXN_DT) AS FUND_DT 
--		  FROM FINANCIAL_TXN FT WHERE FT.FPC_ID = FPC.ID
--		  AND FT.PURGE_DT IS NULL
--		  AND FT.TXN_TYPE_CD = 'P'
--		) AS ISSUE_POST
--		WHERE 1=1
--		AND FPC.PURGE_DT IS NULL
--		AND L.LENDER_ID = '306'
--		AND ISSUE_POST.FUND_DT between @StartDate and @EndDate 	
		
----IF @FIL_DATERANGE = 'T'
--BEGIN
--	INSERT INTO #tmpFPCIDs (ID)
--		SELECT FPC.ID
--		FROM FORCE_PLACED_CERTIFICATE FPC
--		JOIN LOAN L ON FPC.LOAN_ID = L.ID AND L.PURGE_DT IS NULL
--		WHERE FPC.PURGE_DT IS NULL
--		AND L.LENDER_ID = '306'
--		AND FPC.PAYMENT_REPORT_DT between @StartDate and @EndDate 





SELECT fpc.*
FROM FORCE_PLACED_CERTIFICATE FPC 
JOIN FORCE_PLACED_CERT_REQUIRED_COVERAGE_RELATE FPCRCR ON FPCRCR.FPC_ID = FPC.ID AND FPCRCR.PURGE_DT IS NULL
JOIN CARRIER CR ON FPC.CARRIER_ID = CR.ID AND CR.PURGE_DT IS NULL	
JOIN REQUIRED_COVERAGE RC ON FPCRCR.REQUIRED_COVERAGE_ID = RC.ID AND RC.PURGE_DT IS NULL					 
JOIN LOAN L ON L.ID = FPC.LOAN_ID AND L.PURGE_DT IS NULL 
JOIN LENDER LND ON LND.ID = L.LENDER_ID AND LND.PURGE_DT IS NULL
JOIN OWNER_LOAN_RELATE OLR ON OLR.LOAN_ID = L.ID AND OLR.PRIMARY_IN = 'Y' AND OLR.PURGE_DT IS NULL
JOIN [OWNER] O ON O.ID = OLR.OWNER_ID AND O.PURGE_DT IS NULL
JOIN PROPERTY P ON RC.PROPERTY_ID = P.ID AND P.PURGE_DT IS NULL											
JOIN COLLATERAL C ON C.LOAN_ID = L.ID AND C.PROPERTY_ID = P.ID AND C.PURGE_DT IS NULL
JOIN dbo.NOTICE N ON N.LOAN_ID = L.ID
LEFT JOIN LENDER_ORGANIZATION LO ON L.BRANCH_CODE_TX = LO.CODE_TX AND L.LENDER_ID = LO.LENDER_ID AND LO.TYPE_CD = 'BRCH' AND LO.PURGE_DT IS NULL
LEFT JOIN [ADDRESS] LOPADDR ON LO.PHYSICAL_ADDRESS_ID = LOPADDR.ID AND LOPADDR.PURGE_DT IS NULL
LEFT JOIN [ADDRESS] LOMADDR ON LO.MAILING_ADDRESS_ID = LOMADDR.ID AND LOMADDR.PURGE_DT IS NULL
LEFT JOIN OWNER_ADDRESS AP ON AP.ID = P.ADDRESS_ID AND AP.PURGE_DT IS NULL
LEFT JOIN [OWNER_ADDRESS] AO ON AO.ID = O.ADDRESS_ID AND AO.PURGE_DT IS NULL
LEFT JOIN REF_CODE RC_COVERAGETYPE ON RC_COVERAGETYPE.DOMAIN_CD = 'Coverage' and RC_COVERAGETYPE.CODE_CD = RC.TYPE_CD 
LEFT JOIN REF_CODE RC_DIVISION on RC_DIVISION.DOMAIN_CD = 'ContractType' and RC_DIVISION.CODE_CD = L.DIVISION_CODE_TX 
LEFT JOIN COLLATERAL_CODE CC ON CC.ID = C.COLLATERAL_CODE_ID AND CC.PURGE_DT IS NULL
LEFT Join REF_CODE RC_SC on RC_SC.DOMAIN_CD = 'SecondaryClassification' AND CC.SECONDARY_CLASS_CD = RC_SC.CODE_CD
left Join REF_CODE_ATTRIBUTE RCA_PROP on RC_SC.DOMAIN_CD = RCA_PROP.DOMAIN_CD and RC_SC.CODE_CD = RCA_PROP.REF_CD and RCA_PROP.ATTRIBUTE_CD = 'PropertyType'
LEFT JOIN SERVICE_CENTER_FUNCTION_LENDER_RELATE SCR ON SCR.LENDER_ID = LND.ID
LEFT JOIN SERVICE_CENTER_FUNCTION SCF ON SCF.ID = SCR.SERVICE_CENTER_FUNCTION_ID
LEFT JOIN SERVICE_CENTER SC ON SC.ID = SCF.SERVICE_CENTER_ID
LEFT JOIN CPI_QUOTE CPQ ON  CPQ.ID = FPC.CPI_QUOTE_ID AND CPQ.PURGE_DT IS NULL
LEFT JOIN CPI_ACTIVITY CPA_I on CPA_I.CPI_QUOTE_ID = CPQ.ID AND CPA_I.TYPE_CD = 'I'	AND CPA_I.PURGE_DT IS NULL --AND CPA_I.CREATE_DT <= @EndDateSpecial
WHERE LND.CODE_TX = '1729' AND RC_COVERAGETYPE.CODE_CD = 'HAZARD' AND RC_DIVISION.CODE_CD = '4'
AND L.NUMBER_TX = '0000117472-70' 
--END


--DROP TABLE #tmpFPCIDs

