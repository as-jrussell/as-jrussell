USE [UniTrac]
GO 

--Loan Screen Information - LOAN/COLLATERAL/PROPERTY/OWNER/REQUIRED COVERAGE
--SELECT L.NUMBER_TX, RC.* --INTO UniTracHDStorage..INC0218350 
SELECT  DISTINCT
		LL.ID [Lender ID],
		LL.CODE_TX [Lender Code],
        L.id [Loan ID] ,
        Rc.id [RC ID],
        RC.UPDATE_USER_TX ,
        L.NUMBER_TX ,
        INSURANCE_SUB_STATUS_CD ,
        INSURANCE_STATUS_CD ,
        SUMMARY_STATUS_CD ,
        SUMMARY_SUB_STATUS_CD
--INTO #T
FROM    LOAN L
        INNER JOIN COLLATERAL C ON L.ID = C.LOAN_ID
        INNER JOIN PROPERTY P ON C.PROPERTY_ID = P.ID
        INNER JOIN REQUIRED_COVERAGE RC ON P.ID = RC.PROPERTY_ID
        INNER JOIN OWNER_LOAN_RELATE OL ON L.ID = OL.LOAN_ID
        INNER JOIN OWNER O ON OL.OWNER_ID = O.ID
        INNER JOIN OWNER_ADDRESS OA ON O.ADDRESS_ID = OA.ID
        INNER JOIN dbo.PROPERTY_OWNER_POLICY_RELATE POP ON POP.PROPERTY_ID = P.ID
        INNER JOIN dbo.OWNER_POLICY OP ON OP.ID = POP.OWNER_POLICY_ID
        INNER JOIN dbo.POLICY_COVERAGE PC ON PC.OWNER_POLICY_ID = OP.ID
        INNER JOIN dbo.LENDER LL ON LL.ID = L.LENDER_ID
WHERE   LL.CODE_TX IN ( '1045' )
        AND L.NUMBER_TX IN ( '16319350-12', '18904350-03', '16782350-03',
                             '16782350-04', '16782350-05', '6227790-01',
                             '18806950-02', '18274150-04', '6055270-26',
                             '17987550-08', '5360350-11', '1315810-06',
                             '144070-01', '17930450-01', '6156170-10',
                             '5572950-01', '163601-02', '18302750-01',
                             '19009950-01', '5498850-09', '18438350-01',
                             '19465550-01', '286541-05', '18592050-01',
                             '18854850-01', '4013720-02', '18573050-02',
                             '8347050-02', '18936950-02', '18936950-05',
                             '18200450-02', '1316980-05', '19075550-01',
                             '5197650-01', '16925850-02', '6053050-02',
                             '18063350-02', '453020-06', '17244250-04',
                             '18788150-01', '18986050-01', '18367250-01',
                             '16714750-06', '546010-01', '14374750-02',
                             '7315960-13', '584610-24', '584610-22',
                             '10188780-02', '16197050-04', '15049950-02',
                             '18158850-05', '13869850-03', '606082-01',
                             '8169590-03', '18132950-04', '18132950-04',
                             '13145950-03', '12516950-11', '18451750-01',
                             '673060-03', '16189350-11', '18588350-02',
                             '4353960-09', '18684750-02', '7009710-02',
                             '18605350-01', '18436350-01', '1173900-02',
                             '19235350-02', '16622750-06', '7241040-03',
                             '806220-14', '15722350-05', '13182050-01',
                             '19336050-01', '5118450-14', '5339150-01',
                             '13921450-09', '15293250-07', '18394550-03',
                             '16248550-05', '16248550-09', '19070250-02',
                             '17560550-01', '19141550-01', '17907950-07',
                             '1089021-12', '557560-06', '14545050-03',
                             '18253050-01', '19053850-01', '19053850-04',
                             '18852450-01', '19129050-01', '8791553-04',
                             '14728450-05', '14728450-04', '18424350-02',
                             '15428350-01', '16517550-03', '19442350-01',
                             '17103350-03', '19304950-06', '16619050-02',
                             '10370680-03', '5208450-03', '16036650-04',
                             '8344810-09', '18972450-02', '17082250-02',
                             '18263150-01', '18952950-01', '8910931-03',
                             '8910931-04', '16431150-04', '786830-05',
                             '1390062-03', '173270-02', '18694350-04',
                             '18379350-01', '17882250-01', '15737750-04',
                             '18315950-01', '5699950-01', '1011390-08',
                             '16759450-05', '1489570-07', '8607750-01',
                             '8159510-05', '17347450-03', '19065050-01',
                             '5695750-06', '6256570-04', '6256570-05',
                             '17281350-02', '15760850-03', '18344550-01',
                             '17738150-01', '18068150-03', '18030650-01',
                             '5995250-01', '19106750-02', '15588050-02',
                             '19451250-01', '17601150-01', '17773150-01',
                             '4363290-22', '13128650-02', '5862050-05',
                             '6193120-13', '12843150-01', '19423550-01',
                             '6073900-16', '16171850-03', '689730-02',
                             '18024850-01', '1746980-04', '8343250-03',
                             '19015950-07', '868503-05', '1773290-01',
                             '8420540-01', '18193650-06', '15232150-01',
                             '19325950-01', '18197150-02', '10024270-14',
                             '4017520-10', '1969490-01', '1969490-02',
                             '18796650-01', '185561-03', '18935050-02',
                             '2064090-02', '20251850-01', '19005250-01',
                             '10027810-04', '13600650-01', '13824250-01',
                             '8382190-07', '18840850-05', '17845050-01',
                             '6051450-05', '19263950-14', '18316950-01',
                             '1293120-17', '13883550-04', '685691-26',
                             '685691-30', '18963150-01', '16384350-02',
                             '13988250-05', '19153350-04', '18839850-02',
                             '13813250-10', '16152750-03', '16152750-03',
                             '15583150-01', '193150-04', '18327950-03',
                             '17909250-02', '20892950-01', '13103750-11',
                             '9662420-02', '13333850-03', '12314250-13',
                             '19198150-01', '2363230-05', '10030780-01',
                             '19707850-01', '19485750-01', '18621950-01',
                             '19173950-03', '18675550-01', '5066950-08',
                             '18769550-01', '13615950-01', '17925050-01',
                             '17338050-01', '18016450-01', '13050650-19',
                             '13694950-01', '1283630-04', '18450650-01',
                             '15422550-05', '8175690-02', '17039750-07',
                             '2545570-03', '20234150-01', '14775950-01',
                             '10325720-07', '17392250-03', '17392250-04',
                             '17999550-01', '18108050-01', '5823050-11',
                             '18354850-01', '2636811-01', '8271130-04',
                             '15878550-03', '18195050-02', '8673580-11',
                             '8753690-13', '8753690-14', '12467950-03',
                             '19793850-01', '15461450-01', '16033350-04',
                             '12956350-12', '12956350-12', '18480550-01',
                             '18669850-02', '206770-05', '13951450-11',
                             '18893950-01', '13235150-08', '18439050-01',
                             '17877450-01', '2793073-02', '18822250-01',
                             '18109250-02', '2812381-01', '15482650-08',
                             '9407751-03', '18398350-01', '18688850-02',
                             '18406350-01', '8968451-03', '17929650-01',
                             '18285950-03', '1013450-01', '5020050-08',
                             '7235100-10', '7239320-02', '17559550-01',
                             '13555350-23', '12533450-01', '18637450-01',
                             '3031070-06', '10045550-02', '17083150-04',
                             '13423850-12', '5054950-01', '13970450-03',
                             '18464850-01', '18466650-02', '5493850-06',
                             '19555550-01', '8505600-03', '15834450-12',
                             '18529550-02', '8872570-06', '6229100-01',
                             '17671850-04', '10286201-01', '18827050-02',
                             '18077050-05', '18560450-01', '19457950-01',
                             '3406383-04', '17199150-04', '15202350-08',
                             '16977050-02', '19340650-04', '18236550-02',
                             '223190-07', '17604450-05', '15193850-03',
                             '3601560-03', '5408450-01', '18709850-01',
                             '16417950-04', '16417950-04', '17984850-01',
                             '15937550-02', '827190-05', '13468550-05',
                             '8022560-11', '15877650-04', '16290850-05',
                             '16290850-03', '18564650-01', '10252610-01',
                             '16969850-01', '18318250-01', '13563250-05',
                             '19331750-01', '3815250-04', '17836150-03',
                             '17836150-03', '14623550-03', '12903750-06',
                             '19220450-01', '3922580-01', '17697850-10',
                             '8341270-13', '18308550-02', '18819650-03',
                             '14327150-06', '10368540-02', '8385810-28',
                             '19146750-01', '5332750-29', '16532250-04',
                             '8920750-02', '15163050-01', '19171550-01',
                             '19410250-01', '605090-03', '18921450-01',
                             '6026310-01', '10058750-01', '12680850-01',
                             '18776450-01', '19205250-01', '6107580-05',
                             '6107580-06', '18491550-01', '236630-02',
                             '236630-03', '18944750-02', '4031470-04',
                             '4112720-09', '18502850-01', '19272850-01',
                             '8199870-02', '15144250-06', '749550-03',
                             '18214750-01', '417150-01', '16987250-01',
                             '19247050-03', '19247050-04', '12257550-03',
                             '5429950-01', '17192350-04', '19547050-03',
                             '5790350-03', '15630750-02', '4240852-09',
                             '1300880-19', '5642350-01', '4323020-05',
                             '13729450-03', '15430450-01', '5054150-15',
                             '6278850-04', '16421950-05', '15587150-03',
                             '5657950-17', '4430360-16', '18713850-01',
                             '19362350-03', '17997850-01', '13487150-06',
                             '16407250-03', '13395950-01', '13679550-02',
                             '10285470-15', '18068450-03', '17253650-02',
                             '14762750-03', '4279060-01', '246950-05',
                             '15124850-02', '17501950-03', '16828750-03',
                             '16272050-02', '15072350-01', '18531450-01',
                             '4806570-15', '17411050-01', '9308910-04',
                             '18022450-01', '16995150-02', '8113491-01',
                             '19281950-01', '13701150-01', '19197150-01',
                             '13923250-01', '19444550-02', '19440150-01',
                             '14733050-02', '15004250-03', '18009750-02',
                             '18684450-01', '18889050-01', '16947150-02',
                             '9138300-02', '10078550-02', '14572550-01',
                             '14572550-01', '15502550-05', '5182581-02',
                             '18344350-01', '5337650-09', '4185250-09',
                             '17839050-01', '18114950-03', '5244540-19',
                             '15870450-04', '14062650-02', '18797850-04',
                             '6098150-02', '4284250-04', '15518650-02',
                             '16510550-14', '18214650-03', '9705410-05',
                             '6102050-01', '20058150-01', '18949450-01',
                             '15072850-01', '16942250-07', '5754231-06',
                             '1674030-02', '4391250-01', '16081850-02',
                             '18903550-02', '12140650-03', '18923250-05',
                             '8820350-06', '19471750-01', '9329130-01',
                             '18215750-02', '18005050-02', '18561850-01',
                             '18303950-02', '16706550-02', '6048250-02',
                             '9617890-12', '13839850-03', '9713740-01',
                             '9654260-01', '798061-02', '18566950-01',
                             '15753850-06', '17633350-02', '19622750-01',
                             '19189750-01', '18318950-01', '12853450-01',
                             '6027480-14', '15341550-11', '5429650-07',
                             '5429650-08', '5429650-05', '18927150-01',
                             '6305900-15', '19287150-01', '18655550-01',
                             '5075250-01', '10314260-05', '18196950-03',
                             '6416130-01', '19414350-03', '14775450-01',
                             '18547750-05', '8347700-27', '18739950-01',
                             '18381550-01', '16783950-02', '19466950-01',
                             '17967350-01', '15392850-22', '19234550-01',
                             '9752010-11', '19258150-01', '9400980-03',
                             '20364850-01', '19429650-06', '17424550-04',
                             '12598850-01', '18990150-01', '8819870-05',
                             '6132150-07', '2287591-14', '18346850-02',
                             '19242150-01', '19372850-01', '10102970-14',
                             '19418650-01', '19180450-01', '18281550-01',
                             '14859650-05', '19348250-01', '4330370-03',
                             '6808500-24', '6078870-07', '18373450-01',
                             '17342150-05', '8579461-03', '8438210-15',
                             '18511650-01', '18833450-01', '18072150-02',
                             '14013450-01', '18743050-01', '18338450-01',
                             '12018400-07', '4272780-09', '913890-01',
                             '4026510-01', '19243950-01', '18653650-03',
                             '18179950-01', '1078470-01', '18873450-01',
                             '18555850-01', '567130-04', '767860-01',
                             '13919650-01', '17919550-01', '14787550-01',
                             '15594550-07', '898130-03', '19730350-03',
                             '9613670-11', '8526650-07', '9609220-02',
                             '10115500-08', '5876550-07', '15699350-05',
                             '18548050-01', '473240-14', '19176850-06',
                             '18943850-02', '14515950-01', '18915950-01',
                             '15215750-13', '10117820-01', '8976600-01',
                             '12342250-05', '19066850-02', '18325650-01',
                             '17063150-02', '8844860-02', '18927650-01',
                             '17615250-01', '7596130-02', '18751350-01',
                             '7602980-05', '13444350-02', '18866850-01',
                             '18383050-01', '17898250-01', '18430250-01',
                             '15997950-02', '12522650-04', '10191650-13',
                             '7203180-02', '19033350-03', '1192480-04',
                             '19162050-01', '5107430-01', '18397350-01',
                             '19109450-01', '18094750-02', '18701850-01',
                             '16542750-03', '15365750-03', '18368250-01',
                             '16536150-01', '16536150-03', '18468650-03',
                             '19268050-01', '18666550-01', '481320-25',
                             '15555550-04', '19421350-01', '12395050-07',
                             '9651862-01', '18761650-02', '18402350-01',
                             '10282240-02', '16624450-04', '13175350-05',
                             '14006750-16', '18143650-01', '8132790-33',
                             '8132793-20', '19175650-01', '8181380-03',
                             '8199040-01', '8200011-09', '5187380-03',
                             '16844850-02', '16015850-01', '15243750-08',
                             '8299520-02', '8299520-03', '18356250-03',
                             '17630950-01', '18915850-01', '8329232-13',
                             '8329232-14', '1691510-02', '5810150-03',
                             '18360250-03', '18300150-02', '12378050-07',
                             '18359850-01', '887322-15', '18429450-04',
                             '17343950-01', '18418150-01', '18787450-01',
                             '13235450-06', '487280-01', '8457010-02',
                             '15517050-03', '9707070-12', '14464450-04',
                             '18831050-02', '18722850-06', '16970650-01',
                             '18938250-01', '17636150-03', '18858650-01',
                             '13523750-07', '19177350-04', '16845050-02',
                             '8090200-11', '1015270-26', '17498650-01',
                             '17424150-01', '12697650-10', '17332850-01',
                             '6231400-02', '8864400-02', '1206750-07',
                             '9505683-05', '13783950-04', '8812500-01',
                             '7192290-11', '7192290-12', '6128550-16',
                             '17991550-01', '19256850-01', '6020350-02',
                             '6114910-04', '18162550-02', '13755850-18',
                             '12726350-09', '18214050-04', '8901290-15',
                             '8901290-15', '5044640-01' )
        --AND RC.ID IN ( SELECT   ID
        --               FROM     UniTracHDStorage..INC0218350 )

SELECT * FROM dbo.PROPERTY_CHANGE
WHERE ENTITY_ID IN --(52840067)
(SELECT ID FROM dbo.LOAN WHERE NUMBER_TX IN 
(SELECT NUMBER_TX FROM UniTracHDStorage..INC0218350) AND LENDER_ID = '2047') AND ENTITY_NAME_TX= 'Allied.UniTrac.Loan'
AND CAST(PROPERTY_CHANGE.CREATE_DT AS DATE) = CAST(GETDATE() AS DATE)



SELECT * FROM #t


SELECT * FROM dbo.REF_CODE 
WHERE   DOMAIN_CD IN ('RequiredCoverageInsSubStatus', 'RequiredCoverageInsStatus') AND --CODE_CD IN ('E', 'r')

 CODE_CD IN ('F', 'D') 



 UPDATE RC SET RC.UPDATE_DT = GETDATE() , RC.UPDATE_USER_TX = 'INC0218350' ,
RC.LOCK_ID = CASE WHEN RC.LOCK_ID >= 255 THEN 1 ELSE RC.LOCK_ID + 1 END, RC.SUMMARY_STATUS_CD = 'F',
RC.SUMMARY_SUB_STATUS_CD = 'D', RC.INSURANCE_STATUS_CD = 'F', RC.INSURANCE_SUB_STATUS_CD = 'D'
---- SELECT DISTINCT RC.ID
FROM REQUIRED_COVERAGE RC 
INNER JOIN PROPERTY P ON RC.PROPERTY_ID = P.ID
INNER JOIN COLLATERAL C ON P.ID = C.PROPERTY_ID
INNER JOIN LOAN L ON L.ID = C.LOAN_ID
WHERE RC.ID IN (SELECT DISTINCT  ID FROM     UniTracHDStorage..INC0218350 )


SELECT LAST_GOOD_INSURANCE_DT, GOOD_THRU_DT, * FROM dbo.REQUIRED_COVERAGE RC
WHERE RC.ID IN (SELECT DISTINCT  ID FROM     UniTracHDStorage..INC0218350 )

SELECT * FROM dbo.LENDER
WHERE CODE_TX = '1045'


SELECT * FROM UniTrac..PROCESS_DEFINITION
WHERE PROCESS_TYPE_CD = 'GOODTHRUDT' AND ACTIVE_IN = 'Y'


SELECT * FROM dbo.PROCESS_LOG PL
WHERE PROCESS_DEFINITION_ID = '8885' AND
--STATUS_CD = 'InProcess' AND
 CAST(PL.UPDATE_DT AS DATE) = CAST(GETDATE() AS DATE)