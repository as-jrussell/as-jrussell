USE UniTrac

SELECT * FROM dbo.REF_CODE
WHERE DESCRIPTION_TX LIKE '%blanket%'

SELECT * FROM dbo.LENDER
WHERE CODE_TX = '014800'

SELECT * FROM dbo.AGENCY

SELECT rc.*
INTO unitrachdstorage..INC0338132
FROM   dbo.LOAN L
       JOIN dbo.COLLATERAL C ON C.LOAN_ID = L.ID
       JOIN dbo.PROPERTY P ON P.ID = C.PROPERTY_ID
       JOIN dbo.REQUIRED_COVERAGE rc ON rc.PROPERTY_ID = P.ID
WHERE L.LENDER_ID = 2111 and  L.NUMBER_TX IN ( '300053001', '300090802', '300111601', '300296201' ,
                        '300298801' ,'300321102', '300347201', '300349801' ,
                        '300420001' ,'300430201', '300435201', '300439001' ,
                        '300440602' ,'300446102', '300447602', '300450601' ,
                        '300453502' ,'300453601', '300453602', '300454101' ,
                        '300455602' ,'300457202', '300461902', '300462101' ,
                        '300468102' ,'300468501', '300472401', '300477101'
                      );


UPDATE RC
SET rc.STATUS_CD = 'B', rc.UPDATE_DT = GETDATE(), rc.LOCK_ID= rc.LOCK_ID+1,
rc.UPDATE_USER_TX  ='INC0338132'
--SELECT rc.STATUS_CD, *
FROM dbo.REQUIRED_COVERAGE rc
WHERE ID IN (SELECT id FROM unitrachdstorage..INC0338132)



INSERT INTO PROPERTY_CHANGE
 ( ENTITY_NAME_TX , ENTITY_ID , USER_TX , ATTACHMENT_IN , 
 CREATE_DT , AGENCY_ID , DESCRIPTION_TX ,  DETAILS_IN , FORMATTED_IN ,
 LOCK_ID , PARENT_NAME_TX , PARENT_ID , TRANS_STATUS_CD , UTL_IN )
 SELECT DISTINCT 'Allied.UniTrac.RequiredCoverage' , L.ID , 'INC0338132' , 'N' , 
 GETDATE() ,  1 , 
'Moved to Blanket Status', 
 'Y' , 'N' , 1 ,  'Allied.UniTrac.RequiredCoverage' , L.ID , 'PEND' , 'N'
FROM LOAN L 
WHERE L.ID IN (SELECT ID FROM unitrachdstorage..INC0338132)
