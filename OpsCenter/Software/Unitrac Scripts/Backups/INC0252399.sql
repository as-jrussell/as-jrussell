USE [UniTrac]
GO 


SELECT DISTINCT L.ID [LoanID], C.ID [CollID], P.ID [PropID], RC.ID [RC_ID] INTO #tmp
--INTO UniTracHDStorage..INC0252399_L
FROM LOAN L
INNER JOIN COLLATERAL C ON L.ID = C.LOAN_ID
INNER JOIN PROPERTY P ON C.PROPERTY_ID = P.ID
INNER JOIN REQUIRED_COVERAGE RC ON P.ID = RC.PROPERTY_ID
--INNER JOIN OWNER_LOAN_RELATE OL ON L.ID = OL.LOAN_ID
--INNER JOIN OWNER O ON OL.OWNER_ID = O.ID
--INNER JOIN OWNER_ADDRESS OA ON O.ADDRESS_ID = OA.ID
INNER JOIN dbo.LENDER LL ON LL.ID = L.LENDER_ID
WHERE --L.ID = '2488003' ORDER BY RC.PURGE_DT ASc

--L. NUMBER_TX = '8030274238'


LL.CODE_TX IN ('2864') AND L.NUMBER_TX IN ('8020274238' ,'8030274238',
'8010275488', '4200091452', '9110031818', '121344289', '122607420')  AND L.PURGE_DT IS NOT NULL

SELECT L.NUMBER_TX,  C.*--INTO UniTracHDStorage..INC0252399_C
FROM LOAN L
INNER JOIN COLLATERAL C ON L.ID = C.LOAN_ID
INNER JOIN PROPERTY P ON C.PROPERTY_ID = P.ID
INNER JOIN REQUIRED_COVERAGE RC ON P.ID = RC.PROPERTY_ID
INNER JOIN OWNER_LOAN_RELATE OL ON L.ID = OL.LOAN_ID
INNER JOIN OWNER O ON OL.OWNER_ID = O.ID
INNER JOIN OWNER_ADDRESS OA ON O.ADDRESS_ID = OA.ID
INNER JOIN dbo.LENDER LL ON LL.ID = L.LENDER_ID
WHERE LL.CODE_TX IN ('2864') AND L.NUMBER_TX IN ('8020274238' ,'8030274238',
'8010275488', '4200091452', '9110031818', '121344289', '122607420')  AND C.PURGE_DT IS NOT NULL


SELECT P.* INTO UniTracHDStorage..INC0252399_P
FROM LOAN L
INNER JOIN COLLATERAL C ON L.ID = C.LOAN_ID
INNER JOIN PROPERTY P ON C.PROPERTY_ID = P.ID
INNER JOIN REQUIRED_COVERAGE RC ON P.ID = RC.PROPERTY_ID
INNER JOIN OWNER_LOAN_RELATE OL ON L.ID = OL.LOAN_ID
INNER JOIN OWNER O ON OL.OWNER_ID = O.ID
INNER JOIN OWNER_ADDRESS OA ON O.ADDRESS_ID = OA.ID
INNER JOIN dbo.LENDER LL ON LL.ID = L.LENDER_ID
WHERE LL.CODE_TX IN ('2864') AND L.NUMBER_TX IN ('8020274238' ,'8030274238',
'8010275488', '4200091452', '9110031818', '121344289', '122607420')  AND P.PURGE_DT IS NOT NULL



SELECT RC.* INTO UniTracHDStorage..INC0252399_RC
FROM LOAN L
INNER JOIN COLLATERAL C ON L.ID = C.LOAN_ID
INNER JOIN PROPERTY P ON C.PROPERTY_ID = P.ID
INNER JOIN REQUIRED_COVERAGE RC ON P.ID = RC.PROPERTY_ID
INNER JOIN OWNER_LOAN_RELATE OL ON L.ID = OL.LOAN_ID
INNER JOIN OWNER O ON OL.OWNER_ID = O.ID
INNER JOIN OWNER_ADDRESS OA ON O.ADDRESS_ID = OA.ID
INNER JOIN dbo.LENDER LL ON LL.ID = L.LENDER_ID
WHERE LL.CODE_TX IN ('2864') AND L.NUMBER_TX IN ('8020274238' ,'8030274238',
'8010275488', '4200091452', '9110031818', '121344289', '122607420')  AND RC.PURGE_DT IS NOT NULL



SELECT O.* INTO UniTracHDStorage..INC0252399_O
FROM LOAN L
INNER JOIN COLLATERAL C ON L.ID = C.LOAN_ID
INNER JOIN PROPERTY P ON C.PROPERTY_ID = P.ID
INNER JOIN REQUIRED_COVERAGE RC ON P.ID = RC.PROPERTY_ID
INNER JOIN OWNER_LOAN_RELATE OL ON L.ID = OL.LOAN_ID
INNER JOIN OWNER O ON OL.OWNER_ID = O.ID
INNER JOIN OWNER_ADDRESS OA ON O.ADDRESS_ID = OA.ID
INNER JOIN dbo.LENDER LL ON LL.ID = L.LENDER_ID
WHERE LL.CODE_TX IN ('2864') AND L.NUMBER_TX IN ('8020274238' ,'8030274238',
'8010275488', '4200091452', '9110031818', '121344289', '122607420')  AND O.PURGE_DT IS NOT NULL


SELECT OA.* INTO UniTracHDStorage..INC0252399_OA
FROM LOAN L
INNER JOIN COLLATERAL C ON L.ID = C.LOAN_ID
INNER JOIN PROPERTY P ON C.PROPERTY_ID = P.ID
INNER JOIN REQUIRED_COVERAGE RC ON P.ID = RC.PROPERTY_ID
INNER JOIN OWNER_LOAN_RELATE OL ON L.ID = OL.LOAN_ID
INNER JOIN OWNER O ON OL.OWNER_ID = O.ID
INNER JOIN OWNER_ADDRESS OA ON O.ADDRESS_ID = OA.ID
INNER JOIN dbo.LENDER LL ON LL.ID = L.LENDER_ID
WHERE LL.CODE_TX IN ('2864') AND L.NUMBER_TX IN ('8020274238' ,'8030274238',
'8010275488', '4200091452', '9110031818', '121344289', '122607420')  AND OA.PURGE_DT IS NOT NULL

SELECT OL.* INTO UniTracHDStorage..INC0252399_OL
FROM LOAN L
INNER JOIN COLLATERAL C ON L.ID = C.LOAN_ID
INNER JOIN PROPERTY P ON C.PROPERTY_ID = P.ID
INNER JOIN REQUIRED_COVERAGE RC ON P.ID = RC.PROPERTY_ID
INNER JOIN OWNER_LOAN_RELATE OL ON L.ID = OL.LOAN_ID
INNER JOIN OWNER O ON OL.OWNER_ID = O.ID
INNER JOIN OWNER_ADDRESS OA ON O.ADDRESS_ID = OA.ID
INNER JOIN dbo.LENDER LL ON LL.ID = L.LENDER_ID
WHERE LL.CODE_TX IN ('2864') AND L.NUMBER_TX IN ('8020274238' ,'8030274238',
'8010275488', '4200091452', '9110031818', '121344289', '122607420') AND OL.PURGE_DT IS NOT NULL

SELECT PURGE_DT, * FROM UniTracHDStorage..INC0252399_L
WHERE PURGE_DT >= '2016-10-12 '

SELECT PURGE_DT, * FROM UniTracHDStorage..INC0252399_C
WHERE PURGE_DT >= '2016-10-12 '

SELECT PURGE_DT, * FROM UniTracHDStorage..INC0252399_P
WHERE PURGE_DT >= '2016-10-12 '

SELECT PURGE_DT, * FROM UniTracHDStorage..INC0252399_RC
WHERE PURGE_DT >= '2016-10-12 '

SELECT PURGE_DT, * FROM UniTracHDStorage..INC0252399_O
WHERE PURGE_DT >= '2016-10-12 '

SELECT PURGE_DT, * FROM UniTracHDStorage..INC0252399_OA
WHERE PURGE_DT >= '2016-10-12 '

SELECT PURGE_DT, * FROM UniTracHDStorage..INC0252399_OL
WHERE PURGE_DT >= '2016-10-12 '





UPDATE dbo.LOAN
SET  UPDATE_DT = GETDATE(),UPDATE_USER_TX = 'INC0252399', LOCK_ID = CASE WHEN LOCK_ID >= 255 THEN 1 ELSE LOCK_ID + 1 END,PURGE_DT = NULL,
RECORD_TYPE_CD = 'G'
--SELECT * FROM LOAN
WHERE ID IN (SELECT ID FROM UniTracHDStorage..INC0252399_L
WHERE PURGE_DT >= '2016-10-12 ')


UPDATE PROPERTY
SET  UPDATE_DT = GETDATE(),UPDATE_USER_TX = 'INC0252399', LOCK_ID = CASE WHEN LOCK_ID >= 255 THEN 1 ELSE LOCK_ID + 1 END,PURGE_DT = NULL , RECORD_TYPE_CD = 'G' 
--SELECT * FROM PROPERTY
WHERE ID IN (SELECT ID FROM UniTracHDStorage..INC0252399_P WHERE PURGE_DT >= '2016-10-12 ')


UPDATE dbo.COLLATERAL
SET  UPDATE_DT = GETDATE(),UPDATE_USER_TX = 'INC0252399', LOCK_ID = CASE WHEN LOCK_ID >= 255 THEN 1 ELSE LOCK_ID + 1 END,PURGE_DT = NULL 
--SELECT * FROM dbo.COLLATERAL
WHERE ID IN (SELECT ID FROM UniTracHDStorage..INC0252399_C WHERE PURGE_DT >= '2016-10-12 ')



UPDATE dbo.REQUIRED_COVERAGE
SET  UPDATE_DT = GETDATE(),UPDATE_USER_TX = ' INC0252399', LOCK_ID = CASE WHEN LOCK_ID >= 255 THEN 1 ELSE LOCK_ID + 1 END 
--SELECT * FROM dbo.REQUIRED_COVERAGE
WHERE ID IN (SELECT ID FROM UniTracHDStorage..INC0252399_RC WHERE PURGE_DT >= '2016-10-12 ')



SELECT TOP 1 * FROM dbo.CPI_QUOTE
WHERE REFERENCE_ID_TX ='PHX0014546'


SELECT * FROM dbo.LOAN
WHERE NUMBER_TX = '8030274238'

SELECT * FROM dbo.INTERACTION_HISTORY
WHERE PROPERTY_ID = '10459495' AND RELATE_ID = '5754319'


SELECT * FROM dbo.FORCE_PLACED_CERTIFICATE
WHERE ID IN (374296,
373334)


SELECT * FROM dbo.FORCE_PLACED_CERTIFICATE
WHERE NUMBER_TX = 'PHX0014546'

SELECT * FROM dbo.LOAN
WHERE ID = '2488003'



UPDATE dbo.REQUIRED_COVERAGE
SET PURGE_DT = NULL, UPDATE_DT = GETDATE(), UPDATE_USER_TX = 'INC0252399'
--SELECT PURGE_DT, * FROM dbo.REQUIRED_COVERAGE
WHERE PROPERTY_ID = '10459495'
47940638



SELECT * FROM dbo.MASTER_POLICY
WHERE NUMBER_TX = '56782864'


SELECT LoanID, CollID, PropID, RC_ID FROM  #tmp






SELECT * FROM dbo.LOAN
WHERE ID IN (SELECT LoanID FROM  #tmp) AND RECORD_TYPE_CD NOT IN ('G', 'A')

SELECT * FROM dbo.COLLATERAL	
WHERE ID IN (SELECT CollID FROM  #tmp)  AND RECORD_TYPE_CD NOT IN ('G', 'A')

SELECT * FROM dbo.PROPERTY
WHERE ID IN (SELECT PropID FROM  #tmp) AND RECORD_TYPE_CD NOT IN ('G', 'A')

SELECT RECORD_TYPE_CD, * FROM dbo.REQUIRED_COVERAGE
WHERE ID IN (SELECT RC_ID FROM  #tmp) AND RECORD_TYPE_CD NOT IN ('G', 'A')


UPDATE dbo.LOAN
SET PURGE_DT = NULL, UPDATE_DT = GETDATE(), UPDATE_USER_TX = 'INC0252399', RECORD_TYPE_CD = 'G'
WHERE ID IN (SELECT LoanID FROM  #tmp)  AND RECORD_TYPE_CD = 'D'


UPDATE dbo.PROPERTY
SET PURGE_DT = NULL, UPDATE_DT = GETDATE(), UPDATE_USER_TX = 'INC0252399', RECORD_TYPE_CD = 'G'
WHERE ID IN (SELECT PropID FROM  #tmp)  AND RECORD_TYPE_CD = 'D'

UPDATE dbo.REQUIRED_COVERAGE
SET PURGE_DT = NULL, UPDATE_DT = GETDATE(), UPDATE_USER_TX = 'INC0252399', RECORD_TYPE_CD = 'G'
WHERE ID IN (SELECT RC_ID FROM  #tmp)  AND RECORD_TYPE_CD = 'D'


SELECT * FROM dbo.INTERACTION_HISTORY
WHERE PROPERTY_ID IN (SELECT PropID FROM  #tmp) 