USE UniTrac
SELECT * FROM dbo.LENDER
WHERE CODE_TX = '4171'

SELECT  * INTO UniTracHDStorage.dbo.LOAN_4171_1
FROM    dbo.LOAN
WHERE   LENDER_ID IN (2275  )
        AND NUMBER_TX IN ( '143070-03',
'209011-01',
'202634-01',
'200661-02',
'195701-03',
'206512-01',
'206749-01',
'101219-01',
'177618-01',
'194561-01',
'156581-01',
'185924-01',
'157685-02',
'159034-02',
'72109-01',
'88571-01',
'108798-02',
'219157-01',
'30399-01',
'216029-01'
 )

SELECT * FROM UniTracHDStorage.dbo.LOAN_4171_1

UPDATE  Loan
SET     NUMBER_TX = '14307003' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0272969'
WHERE   NUMBER_TX = '143070-03'
        AND LENDER_ID = 2275
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '20901101' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0272969'
WHERE   NUMBER_TX = '209011-01'
        AND LENDER_ID = 2275
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '20263401' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0272969'
WHERE   NUMBER_TX = '202634-01'
        AND LENDER_ID = 2275
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '20066102' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0272969'
WHERE   NUMBER_TX = '200661-02'
        AND LENDER_ID = 2275
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '19570103' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0272969'
WHERE   NUMBER_TX = '195701-03'
        AND LENDER_ID = 2275
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '20651201' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0272969'
WHERE   NUMBER_TX = '206512-01'
        AND LENDER_ID = 2275
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '20674901' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0272969'
WHERE   NUMBER_TX = '206749-01'
        AND LENDER_ID = 2275
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '10121901' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0272969'
WHERE   NUMBER_TX = '101219-01'
        AND LENDER_ID = 2275
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '17761801' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0272969'
WHERE   NUMBER_TX = '177618-01'
        AND LENDER_ID = 2275
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '19456101' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0272969'
WHERE   NUMBER_TX = '194561-01'
        AND LENDER_ID = 2275
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '15658101' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0272969'
WHERE   NUMBER_TX = '156581-01'
        AND LENDER_ID = 2275
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '18592401' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0272969'
WHERE   NUMBER_TX = '185924-01'
        AND LENDER_ID = 2275
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '15768502' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0272969'
WHERE   NUMBER_TX = '157685-02'
        AND LENDER_ID = 2275
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '15903402' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0272969'
WHERE   NUMBER_TX = '159034-02'
        AND LENDER_ID = 2275
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '7210901' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0272969'
WHERE   NUMBER_TX = '72109-01'
        AND LENDER_ID = 2275
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '8857101' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0272969'
WHERE   NUMBER_TX = '88571-01'
        AND LENDER_ID = 2275
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '10879802' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0272969'
WHERE   NUMBER_TX = '108798-02'
        AND LENDER_ID = 2275
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '21915701' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0272969'
WHERE   NUMBER_TX = '219157-01'
        AND LENDER_ID = 2275
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '3039901' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0272969'
WHERE   NUMBER_TX = '30399-01'
        AND LENDER_ID = 2275
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '21602901' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0272969'
WHERE   NUMBER_TX = '216029-01'
        AND LENDER_ID = 2275
        AND PURGE_DT IS NULL;




--2) INSERT into PROPERTY_CHANGE table
INSERT INTO PROPERTY_CHANGE (ENTITY_NAME_TX,ENTITY_ID,USER_TX,ATTACHMENT_IN,CREATE_DT,AGENCY_ID,DETAILS_IN,FORMATTED_IN,LOCK_ID,PARENT_NAME_TX,PARENT_ID,TRANS_STATUS_CD,UTL_IN)
SELECT 'Allied.UniTrac.Loan',LOAN.ID,'INC0272969','N','2016-11-23 00:00:00.000',1,'Y','N',1,'Allied.UniTrac.Loan',LOAN.ID,'PEND','N'
FROM LOAN
WHERE ID IN (SELECT ID FROM UnitracHDStorage.dbo.LOAN_4171_1)
--42


--3) INSERT into PROPERTY_CHANGE_UPDATE table
INSERT INTO PROPERTY_CHANGE_UPDATE (CHANGE_ID, TABLE_NAME_TX, TABLE_ID, COLUMN_NM, FROM_VALUE_TX,TO_VALUE_TX,DATATYPE_NO,CREATE_DT,DISPLAY_IN,OPERATION_CD)
select PROPERTY_CHANGE.ID,'LOAN',ENTITY_ID,'NUMBER_TX',UnitracHDStorage.dbo.LOAN_4171_1.NUMBER_TX,LOAN.NUMBER_TX,1,'2016-11-23 00:00:00.000','Y','U'
from PROPERTY_CHANGE
INNER JOIN LOAN ON PROPERTY_CHANGE.ENTITY_ID = LOAN.ID AND ENTITY_NAME_TX = 'Allied.UniTrac.Loan' 
INNER JOIN UnitracHDStorage.dbo.LOAN_4171_1 ON LOAN.ID = UnitracHDStorage.dbo.LOAN_4171_1.ID --AND ENTITY_NAME_TX = 'Allied.UniTrac.Loan' 
WHERE PROPERTY_CHANGE.CREATE_DT = '2016-11-23 00:00:00.000'
AND ENTITY_ID IN (SELECT ID FROM UnitracHDStorage.dbo.LOAN_4171_1)
--0

---4) Insert into LOAN_NUMBER Table (Leave old numbers for matching purposes)

INSERT INTO LOAN_NUMBER (LOAN_ID,NUMBER_TX,EFFECTIVE_DT,CREATE_DT,UPDATE_DT,UPDATE_USER_TX, LOCK_ID)
SELECT dbo.LOAN.ID, dbo.LOAN.NUMBER_TX,dbo.LOAN.EFFECTIVE_DT,GETDATE(),GETDATE(),'INC0272969',1
FROM UnitracHDStorage.dbo.LOAN_4171_1 HD INNER JOIN dbo.LOAN ON HD.ID = LOAN.ID
--42

--5) Full Text Search Updates

--Create updates
SELECT 'EXEC SaveSearchFullText', PROPERTY.ID 
FROM PROPERTY
INNER JOIN COLLATERAL ON PROPERTY.ID = COLLATERAL.PROPERTY_ID
AND LOAN_ID in (select ID FROM UnitracHDStorage.dbo.LOAN_4171_1)
--42


EXEC SaveSearchFullText	120933993
EXEC SaveSearchFullText	120945404
EXEC SaveSearchFullText	120949461
EXEC SaveSearchFullText	120951122
EXEC SaveSearchFullText	120955167
EXEC SaveSearchFullText	120956228
EXEC SaveSearchFullText	120957216
EXEC SaveSearchFullText	120957229
EXEC SaveSearchFullText	120957436
EXEC SaveSearchFullText	120957698
EXEC SaveSearchFullText	120958288
EXEC SaveSearchFullText	120958670
EXEC SaveSearchFullText	120958993
EXEC SaveSearchFullText	120961008
EXEC SaveSearchFullText	120961577
EXEC SaveSearchFullText	120963170
EXEC SaveSearchFullText	122458828
EXEC SaveSearchFullText	122459490
EXEC SaveSearchFullText	122459618
EXEC SaveSearchFullText	122459631
EXEC SaveSearchFullText	122459641
EXEC SaveSearchFullText	122459915
EXEC SaveSearchFullText	122459916
EXEC SaveSearchFullText	122466721
EXEC SaveSearchFullText	122466818
EXEC SaveSearchFullText	122466836
EXEC SaveSearchFullText	122466857
EXEC SaveSearchFullText	122466941
EXEC SaveSearchFullText	122466966
EXEC SaveSearchFullText	122467361
EXEC SaveSearchFullText	122470000
EXEC SaveSearchFullText	122470784
EXEC SaveSearchFullText	122471092
EXEC SaveSearchFullText	122471464
EXEC SaveSearchFullText	122471815
EXEC SaveSearchFullText	122471840
EXEC SaveSearchFullText	141125099
EXEC SaveSearchFullText	122471815
EXEC SaveSearchFullText	122470784
EXEC SaveSearchFullText	122466966
EXEC SaveSearchFullText	122459618
EXEC SaveSearchFullText	122471092
EXEC SaveSearchFullText	122466721
EXEC SaveSearchFullText	122470000
EXEC SaveSearchFullText	122458828
EXEC SaveSearchFullText	122466941
EXEC SaveSearchFullText	122467361
EXEC SaveSearchFullText	122466857
EXEC SaveSearchFullText	122466818
EXEC SaveSearchFullText	122466836
EXEC SaveSearchFullText	122459641
EXEC SaveSearchFullText	122459915
EXEC SaveSearchFullText	122459916
EXEC SaveSearchFullText	122459631
EXEC SaveSearchFullText	122459490
EXEC SaveSearchFullText	122471840
EXEC SaveSearchFullText	122471464
EXEC SaveSearchFullText	122466966
EXEC SaveSearchFullText	122459618
EXEC SaveSearchFullText	122466836