USE UniTrac



SELECT LO.NAME_TX [Type],  dc.RELATE_CLASS_NAME_TX ,  fpc.SEQUENCE_NO,
dc.DISPLAY_DT ,dc.DISPLAY_DESC_TX , dc.PRINT_STATUS_CD ,
dc.PRINT_STATUS_ASSIGNED_DT , dc.RECIPIENT_TYPE_CD 
INTO jcs..INC0328880_20171204
FROM dbo.NOTICE fpc
JOIN dbo.NOTICE_REQUIRED_COVERAGE_RELATE FPCRCR ON FPCRCR.NOTICE_ID = FPC.ID AND FPCRCR.PURGE_DT IS NULL AND fpc.PURGE_DT IS NULL 
JOIN REQUIRED_COVERAGE RC ON FPCRCR.REQUIRED_COVERAGE_ID = RC.ID AND RC.PURGE_DT IS NULL
JOIN LOAN L ON L.ID = FPC.LOAN_ID	AND ISNULL(L.RECORD_TYPE_CD,'') IN ('A', 'D', 'G') AND L.PURGE_DT IS NULL
JOIN dbo.DOCUMENT_CONTAINER dc ON fpc.id = dc.RELATE_ID AND dc.RELATE_CLASS_NAME_TX ='Allied.UniTrac.Notice' AND dc.PURGE_DT IS NULL 
JOIN dbo.LENDER_ORGANIZATION LO ON L.DIVISION_CODE_TX = Lo.CODE_TX AND LO.TYPE_CD = 'DIV' AND LO.LENDER_ID = '252'
WHERE  L.LENDER_ID = '252' AND  dc.RECIPIENT_TYPE_CD = 'BORR' AND dc.PRINT_STATUS_CD = 'PRINTED' AND  Dc.UPDATE_DT >= '2017-01-01'
AND rc.TYPE_CD = 'PHYS-DAMAGE'
UNION
SELECT LO.NAME_TX [Type], dc.RELATE_CLASS_NAME_TX , NULL ,
dc.DISPLAY_DT ,dc.DISPLAY_DESC_TX , dc.PRINT_STATUS_CD ,
dc.PRINT_STATUS_ASSIGNED_DT , dc.RECIPIENT_TYPE_CD 
FROM FORCE_PLACED_CERTIFICATE FPC
JOIN FORCE_PLACED_CERT_REQUIRED_COVERAGE_RELATE FPCRCR ON FPCRCR.FPC_ID = FPC.ID AND FPCRCR.PURGE_DT IS NULL AND fpc.PURGE_DT IS NULL 
JOIN REQUIRED_COVERAGE RC ON FPCRCR.REQUIRED_COVERAGE_ID = RC.ID AND RC.PURGE_DT IS NULL
JOIN LOAN L ON L.ID = FPC.LOAN_ID	AND ISNULL(L.RECORD_TYPE_CD,'') IN ('A', 'D', 'G') AND L.PURGE_DT IS NULL
JOIN dbo.DOCUMENT_CONTAINER dc ON fpc.id = dc.RELATE_ID AND dc.RELATE_CLASS_NAME_TX ='Allied.UniTrac.ForcePlacedCertificate' AND dc.PURGE_DT IS NULL 
JOIN dbo.LENDER_ORGANIZATION LO ON L.DIVISION_CODE_TX = Lo.CODE_TX AND LO.TYPE_CD = 'DIV' AND LO.LENDER_ID = '252'
WHERE  L.LENDER_ID = '252' AND  dc.RECIPIENT_TYPE_CD = 'BORR' AND dc.PRINT_STATUS_CD = 'PRINTED' AND  Dc.UPDATE_DT >= '2017-01-01'
AND rc.TYPE_CD = 'PHYS-DAMAGE'
