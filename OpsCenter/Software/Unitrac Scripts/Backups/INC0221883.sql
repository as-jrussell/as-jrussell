
USE [UniTrac]
GO 

--Loan Screen Information - LOAN/COLLATERAL/PROPERTY/OWNER/REQUIRED COVERAGE
SELECT  L.*
INTO    #tmp
FROM    LOAN L
        INNER JOIN COLLATERAL C ON L.ID = C.LOAN_ID
        INNER JOIN PROPERTY P ON C.PROPERTY_ID = P.ID
        INNER JOIN REQUIRED_COVERAGE RC ON P.ID = RC.PROPERTY_ID
        INNER JOIN OWNER_LOAN_RELATE OL ON L.ID = OL.LOAN_ID
        INNER JOIN OWNER O ON OL.OWNER_ID = O.ID
        INNER JOIN OWNER_ADDRESS OA ON O.ADDRESS_ID = OA.ID
        INNER JOIN dbo.LENDER LL ON LL.ID = L.LENDER_ID
WHERE   LL.CODE_TX IN ( '2864' )
        AND L.NUMBER_TX IN ( '120513480', '120513639', '120513639',
                             '120513998', '120513998', '120513998',
                             '120514052', '120514162', '120514175',
                             '120514243', '120514405', '120514599',
                             '120517868', '120517868', '120517868',
                             '120523250', '120524123', '120533240',
                             '120534951', '120534951', '120535947',
                             '120558102', '120582563', '120626199',
                             '120629989', '120643279', '120643279',
                             '120643279', '120643279', '120647084',
                             '120688917', '120716805', '120716805',
                             '120719789', '120719789', '120719789',
                             '120720956', '120750638', '120798904',
                             '120798904', '120798904', '120848388',
                             '120848388', '120859979', '120859979',
                             '120859979', '120882140', '120914788',
                             '120920743', '120930403', '120931143',
                             '120931143', '120931143', '120938612',
                             '120960143', '120961883', '120981122',
                             '120987883', '120987883', '120987883',
                             '120987883', '120991060', '121013358',
                             '121038171', '121038980', '121038980',
                             '121038980', '121099754', '121102706',
                             '121127419', '121185707', '121192693',
                             '121227306', '121227872', '121250713',
                             '121254379', '121254641', '121255116',
                             '121270528', '121272429', '121280673',
                             '121280673', '121280673', '121290595',
                             '121297129', '121324681', '121331726',
                             '121346494', '121347972', '121359724',
                             '121359724', '121359724', '121359821',
                             '121389121', '121403159', '121419321',
                             '121419321', '121419321', '121421665',
                             '121421665', '121422295', '121425920',
                             '121449249', '121449249', '121450319',
                             '121452883', '121456672', '121456672',
                             '121477457', '121477457', '121488488',
                             '121493596', '121493923', '121495345',
                             '121499147', '121512202', '121512202',
                             '121512202', '121519467', '121534329',
                             '121534329', '121534329', '121534329',
                             '121539269', '121539269', '121539269',
                             '121561839', '121562113', '121567147',
                             '121568191', '121568191', '121568191',
                             '121572006', '121578495', '121578974',
                             '121587392', '121589099', '121590473',
                             '121591540', '121592976', '121592976',
                             '121592976', '121594181', '121594181',
                             '121598307', '121635875', '121635875',
                             '121635875', '121636447', '121638225',
                             '121675945', '121686905', '121686905',
                             '121686905', '121697172', '121700852',
                             '121703503', '121707839', '121723871',
                             '121741390', '121741578', '121741578',
                             '121741578', '121752761', '121757313',
                             '121757313', '121757313', '121775612',
                             '121790529', '121792624', '121792624',
                             '121792624', '121793872', '121800943',
                             '121800943', '121800943', '121826448',
                             '121837398', '121851442', '121852904',
                             '121852904', '121852904', '121853945',
                             '121853945', '121853945', '121853945',
                             '121853945', '121853945', '121864756',
                             '121868493', '121872984', '121872984',
                             '121872984', '121877361', '121883355',
                             '121903921', '121908117', '121908447',
                             '121939429', '121939623', '121948274',
                             '121956114', '121965435', '121966243',
                             '121970967', '121984050', '122020641',
                             '122039632', '122041808', '122047572',
                             '122058299', '122066223', '122072738',
                             '122078677', '122078677', '122078677',
                             '122108644', '122113493', '122113493',
                             '122113493', '122115970', '122116005',
                             '122127052', '122135426', '122135536',
                             '122135536', '122135536', '122141326',
                             '122150443', '122161403', '122166712',
                             '122171710', '122172683', '122176456',
                             '122177947', '122180882', '122185997',
                             '122199116', '122209475', '122210095',
                             '122216497', '122216497', '122222698',
                             '122222698', '122222698', '122226733',
                             '122229552', '122231906', '122233823',
                             '122242649', '122245866', '122252370',
                             '122266515', '122266515', '122266515',
                             '122270750', '122273197', '122288904',
                             '122294273', '122296271', '122299100',
                             '122319161', '122323173', '122336843',
                             '122337020', '122337020', '122337020',
                             '122359066', '122365568', '122365568',
                             '122365568', '122381542', '122390229',
                             '122400986', '122415272', '122415586',
                             '122442203', '122445433', '122453739',
                             '122454563', '122471643', '122479195',
                             '122479276', '122480948', '122483424',
                             '122511419', '122526556', '122530843',
                             '122532883', '122538573', '122548288',
                             '122564958', '122577440', '122578229',
                             '122596803', '122603961', '122604834',
                             '122609619', '122624678', '122645372',
                             '122650066', '122652682', '122665530',
                             '6100001846', '6100007924', '6100012606',
                             '6100020842', '6100023417', '6100026530',
                             '6100035763', '6100041767', '6100043588',
                             '6100043664', '6100052684', '6100053344',
                             '6100059001', '6100059288', '6100060748',
                             '6100061477', '6100062344', '6100063123',
                             '6100068971', '6100072410', '6100072702',
                             '6100079390', '6100080300', '6100084697',
                             '6100089722', '6100100862', '6100104873',
                             '6100105161', '6100108784', '6100118432',
                             '6100119044', '6100126696', '6100127029',
                             '6100161962', '6100167972', '6100168332',
                             '6100176137', '6100193722', '6100199056',
                             '6100215472', '6100215545', '6100219352',
                             '6100225073', '6100231177', '6100233199',
                             '6100236646', '6100238799', '6100245183',
                             '6100252886', '6100261260', '6100267035',
                             '6100277097', '6100278145', '6100279879',
                             '6100282328', '6100289012', '6100294751',
                             '6100307944', '6100311827', '6100312943',
                             '6100315925', '6100316320', '6100318359',
                             '6100322982', '6100345710', '6100349239',
                             '6100349689', '6100352687', '6100352997',
                             '6100370600', '6100379584', '6100395599',
                             '6100404991', '6100412738', '6100417965',
                             '6100424655', '6100433423', '6100433535',
                             '6100435969', '6100437661', '6100447783',
                             '6100448880', '6100450776', '6100460072',
                             '6100461629', '6100468734', '6100472267',
                             '6100477397', '6100482306', '6100484359',
                             '6100485393', '6100489443', '6100490554',
                             '6100494941', '6100497703', '6100501319',
                             '6100501704', '6100508307', '6100511418',
                             '6100512215', '6100513180', '6100513252',
                             '6100515156', '6100521090', '6100522040',
                             '6100522653', '6100525927', '6100525933',
                             '6100527899', '6100529812', '6100530739',
                             '6100533151', '6100536422', '6100540255',
                             '6100543731', '6100543785', '6100543829',
                             '6100548806', '6100548907', '6100550528',
                             '6100550689', '6100551306', '6100551537',
                             '6100553665', '6100558126', '6100558126',
                             '6100558126', '6100561439', '6100563858',
                             '6100564671', '6100567964', '6100568075',
                             '6100570921', '6100574564', '6100574606',
                             '6100575423', '6100579272', '6100581428',
                             '6100582631', '6100587045', '6100591704',
                             '6100591836', '6100593379', '6100595374',
                             '6100595374', '6100595374', '6100595957',
                             '6100598997', '6100599628', '6100599628',
                             '6100599628', '6100601958', '6100603583',
                             '6100603889', '6102189735', '6102202729',
                             '6109614740', '6110017542', '6111403552',
                             '6117733696', '6130000893', '6134384005',
                             '6140035430', '6140092970', '6140107950',
                             '6140132450', '6140132880', '6150019776',
                             '6150021920', '6150022116', '6150022470',
                             '6150051207', '6150061507', '6150081468',
                             '6194467577', '6200020386', '6200070260',
                             '6200078507', '6200187445', '6200195487',
                             '6200226900', '6200584213', '6202070356' )

SELECT * INTO UniTracHDStorage..INC0221883 FROM #tmp

SELECT DISTINCT T.ID [LoanID] 
        ,T.NUMBER_TX [Loan Number] ,
       RCA.DESCRIPTION_TX [Loan Type] ,
        RCB.DESCRIPTION_TX [Loan Status] ,
      RCC.DESCRIPTION_TX [Record Type] ,
        T.EFFECTIVE_DT [Effective Date] ,
        T.UPDATE_DT [Last update date] ,
        T.BRANCH_CODE_TX [Branch Code] ,
        T.DIVISION_CODE_TX [Division Code]
		--T.TYPE_CD,T.STATUS_CD,T.RECORD_TYPE_CD
		--INTO #tmp2
FROM    #tmp T
INNER JOIN dbo.REF_CODE RCA ON RCA.CODE_CD = T.TYPE_CD AND RCA.DOMAIN_CD = 'LoanType'
INNER JOIN dbo.REF_CODE RCB ON RCB.CODE_CD = T.STATUS_CD AND RCB.DOMAIN_CD = 'LoanStatus'
INNER JOIN dbo.REF_CODE RCC ON RCC.CODE_CD = T.RECORD_TYPE_CD AND RCC.DOMAIN_CD = 'RecordType'
where T.BRANCH_CODE_TX = '2ND & HE'

SELECT  BRANCH_CODE_TX, LENDER_BRANCH_CODE_TX
--INTO    #tmp
FROM    LOAN L
        INNER JOIN COLLATERAL C ON L.ID = C.LOAN_ID
        INNER JOIN PROPERTY P ON C.PROPERTY_ID = P.ID
        INNER JOIN REQUIRED_COVERAGE RC ON P.ID = RC.PROPERTY_ID
        INNER JOIN OWNER_LOAN_RELATE OL ON L.ID = OL.LOAN_ID
        INNER JOIN OWNER O ON OL.OWNER_ID = O.ID
        INNER JOIN OWNER_ADDRESS OA ON O.ADDRESS_ID = OA.ID
        INNER JOIN dbo.LENDER LL ON LL.ID = L.LENDER_ID
		INNER JOIN dbo.COLLATERAL_CODE CC ON CC.ID = C.COLLATERAL_CODE_ID
WHERE   LL.CODE_TX IN ( '2864' )
        AND L.ID IN (SELECT * FROM #tmp2)
		
SELECT * FROM dbo.REF_CODE
WHERE CODE_CD = 'EQ'

SELECT * FROM #tmp

SELECT   COUNT(*)
--INTO    #tmp
FROM    LOAN L
        INNER JOIN COLLATERAL C ON L.ID = C.LOAN_ID
        INNER JOIN PROPERTY P ON C.PROPERTY_ID = P.ID
        INNER JOIN REQUIRED_COVERAGE RC ON P.ID = RC.PROPERTY_ID
        INNER JOIN OWNER_LOAN_RELATE OL ON L.ID = OL.LOAN_ID
        INNER JOIN OWNER O ON OL.OWNER_ID = O.ID
        INNER JOIN OWNER_ADDRESS OA ON O.ADDRESS_ID = OA.ID
        INNER JOIN dbo.LENDER LL ON LL.ID = L.LENDER_ID
WHERE   LL.CODE_TX IN ( '2864' ) AND L.BRANCH_CODE_TX = '2ND & HE'
SELECT  *
FROM    dbo.COLLATERAL_CODE
WHERE   DESCRIPTION_TX LIKE '%%'
        AND AGENCY_ID = '1'
        AND ID IN (  )



SELECT LO.TYPE_CD, LO.CODE_TX , Lo.NAME_TX,*
FROM LENDER L
INNER JOIN LENDER_ORGANIZATION LO ON L.ID = LO.LENDER_ID
INNER JOIN RELATED_DATA RD ON LO.ID = RD.RELATE_ID --AND RD.DEF_ID = '105'
WHERE L.CODE_TX = '2864' AND Lo.TYPE_CD = 'DIV'




SELECT * 
INTO #tmpD
FROM #tmp
WHERE BRANCH_CODE_TX = '2ND & HE'



UPDATE dbo.LOAN
SET PURGE_DT = GETDATE(), UPDATE_DT = GETDATE(),
LOCK_ID = LOCK_ID +1, UPDATE_USER_TX = 'INC0221883'
--SELECT BRANCH_CODE_TX, * FROM dbo.LOAN
WHERE ID IN (SELECT ID FROM #tmpD)
--367