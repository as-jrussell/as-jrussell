-------------- Check Work Items Before Update (To Verify Work Item Definition and Status)
-------------- Work Item ID Number(s) should be provided on HDT
----REPLACE XXXXX WITH THE THE WI ID

SELECT  *
FROM    UniTrac..WORK_ITEM
WHERE   ID IN ( XXXXXXX  )


-------- Verify Data Work Item Clean Up for Cancelled Lender or update initial Select if only specific WI's being closed out.
----REPLACE XXXXXXX WITH THE THE WI ID
----REPLACE #### WITH THE THE Lender ID

SELECT DISTINCT
        WI.ID AS WI_ID ,
        LOAN.ID AS LOAN_ID
INTO    #TMPWI
FROM    LOAN
        JOIN LENDER ON LENDER.ID = LOAN.LENDER_ID
        JOIN WORK_ITEM WI ON WI.RELATE_ID = LOAN.ID
WHERE   LENDER.CODE_TX = '1615'
        AND WI.WORKFLOW_DEFINITION_ID = 8
        AND WI.STATUS_CD NOT IN ( 'COMPLETE', 'WITHDRAWN' )
        AND WI.PURGE_DT IS NULL
        --AND WI.CREATE_DT < '2014-01-01 00:00:00.000'
        AND LOAN.PURGE_DT IS NULL
        AND LOAN.RECORD_TYPE_CD IN ( 'G', 'A' )
        AND WI.ID IN ( 26291604, 26483571, 26497811, 26291494, 26495813,
                       26497792, 26687899, 26687906, 26687913, 26687924,
                       26687931, 26687938, 26687942, 26687949, 26687956,
                       26687963, 26687967, 26687974, 26687981, 26687988,
                       26687992, 26687999, 26688006, 26688017, 26688024,
                       26688031, 26688042, 26713835, 26713846, 26713853,
                       26713860, 26713871, 26713878, 26713885, 26713896,
                       26713903, 26713910, 26713921, 26713928, 26713935,
                       26713946, 26713953, 26713960, 26713971, 26713978,
                       26713985, 26713996, 26714003, 26714010, 26714021,
                       26714028, 26714035, 26714046, 26714053, 26714060,
                       26714071, 26714078, 26714085, 26714096, 26714103,
                       26714110, 26714121, 26714128, 26714135, 26714253,
                       26687905, 26687907, 26687914, 26687916, 26687939,
                       26687941, 26687948, 26687950, 26687973, 26687975,
                       26687982, 26688005, 26688007, 26688014, 26688016,
                       26688041, 26358910, 26578678, 26687909, 26713843,
                       26713845, 26713852, 26713854, 26713877, 26713879,
                       26713884, 26713886, 26713888, 26713911, 26713913,
                       26713918, 26713920, 26713943, 26713945, 26687910,
                       26687927, 26687928, 26687945, 26687946, 26687959,
                       26687960, 26713952, 26713954, 26713977, 26713979,
                       26687977, 26687978, 26687995, 26687996, 26713986,
                       26713988, 26714011, 26688009, 26688010, 26688013,
                       26688027, 26714013, 26714020, 26714043, 26714045,
                       26714054, 26714077, 26714079, 26714086, 26714088,
                       26714111, 26714113, 26714118, 26714120, 26714122,
                       26688028, 26688045, 26688046, 26713849, 26713850,
                       26713864, 26713867, 26713881, 26713882, 26713899,
                       26713900, 26713914, 26713917, 26713931, 26713932,
                       26713949, 26713950, 26713964, 26713967, 26713981,
                       26713982, 26714000, 26714014, 26714017, 26714031,
                       26714032, 26714050, 26714064, 26714067, 26714081,
                       26714082, 26714099, 26714100, 26714114, 26714117,
                       26714254, 26714131, 26714132, 26687901, 26687918,
                       26687920, 26687935, 26687937, 26687952, 26687954,
                       26687969, 26687971, 26687984, 26687986, 26688001,
                       26688003, 26688018, 26688020, 26688035, 26688037,
                       26713839, 26713841, 26713856, 26713858, 26713873,
                       26713875, 26713890, 26713892, 26713905, 26713907,
                       26713909, 26713922, 26713924, 26713939, 26713941,
                       26713956, 26713973, 26713975, 26713990, 26713992,
                       26714007, 26714009, 26714056, 26714058, 26714073,
                       26714075, 26714090, 26714092, 26714107, 26714109,
                       26714126, 25622252, 25622520, 26291602, 26483280,
                       26497259, 26687908, 26687915, 26687933, 26687940,
                       26687947, 26687958, 26687965, 26687972, 26687983,
                       26687990, 26687997, 26688008, 26688015, 26688022,
                       26688033, 26688040, 26688047, 26713837, 26713844,
                       26713851, 26713862, 26713869, 26713876, 26713887,
                       26713894, 26713901, 26713912, 26713919, 26713926,
                       26713937, 26713944, 26713951, 26713962, 26713969,
                       26713976, 26713980, 26713987, 26713994, 26714001,
                       26714005, 26714012, 26714026, 26714030, 26714037,
                       26714062, 26714069, 26714080, 26714087, 26714094,
                       26714105, 26714112, 26714119, 26714130, 26714137,
                       26361465, 26481094, 26481343, 26687900, 26687923,
                       26687925, 26687930, 26687932, 26687955, 26687957,
                       26687964, 26687966, 26687989, 26687991, 26687998,
                       26688000, 26688023, 26688025, 26688032, 26713834,
                       26713836, 26713859, 26713861, 26713863, 26713868,
                       26713870, 26713893, 26713895, 26713902, 26713904,
                       26713927, 26713929, 26713936, 26713938, 26713961,
                       26713963, 26713968, 26713970, 26713993, 26713995,
                       26714002, 26714004, 26714027, 26714029, 26714036,
                       26714038, 26714061, 26714063, 26714068, 26714070,
                       26714093, 26714095, 26714097, 26714104, 26714127,
                       26714129, 26714136, 26714138, 26497865, 26687902,
                       26687904, 26687917, 26687919, 26687921, 26687934,
                       26687936, 26687951, 26687953, 26687968, 26687970,
                       26687985, 26687987, 26688002, 26688004, 26688019,
                       26688021, 26688034, 26688036, 26688038, 26713838,
                       26713840, 26713842, 26713855, 26713857, 26713872,
                       26713874, 26713889, 26713891, 26713906, 26713908,
                       26713923, 26713925, 26713940, 26713942, 26713955,
                       26713957, 26713959, 26713972, 26713974, 26713989,
                       26713991, 26714006, 26714008, 26714023, 26714025,
                       26714057, 26714059, 26714072, 26714074, 26714076,
                       26714089, 26714091, 26714106, 26714108, 26714123,
                       26714125, 26483634, 26687911, 26687912, 26687926,
                       26687929, 26687943, 26687944, 26687961, 26687962,
                       26687976, 26687979, 26687993, 26687994, 26688011,
                       26688012, 26688029, 26688043, 26688044, 26713833,
                       26713847, 26713848, 26713865, 26713866, 26713880,
                       26713883, 26713897, 26713898, 26713915, 26713916,
                       26713930, 26713933, 26713934, 26713947, 26713948,
                       26713965, 26713966, 26713983, 26713984, 26713997,
                       26714015, 26714065, 26714066, 26714083, 26714084,
                       26714098, 26714101, 26714115, 26714116, 26714133,
                       26714134 )
		
SELECT * FROM #TMPWI

UPDATE  LN
SET     SPECIAL_HANDLING_XML = NULL ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'UNITRAC' ,
        LOCK_ID = CASE WHEN LOCK_ID >= 255 THEN 1
                       ELSE LOCK_ID + 1
                  END
--SELECT COUNT(*)
FROM    LOAN LN
        JOIN #TMPWI ON #TMPWI.LOAN_ID = LN.ID


UPDATE  WI
SET     STATUS_CD = 'WITHDRAWN' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'UNITRAC' ,
        LOCK_ID = CASE WHEN LOCK_ID >= 255 THEN 1
                       ELSE LOCK_ID + 1
                  END
--SELECT COUNT(*)
FROM    WORK_ITEM WI
        JOIN #TMPWI ON #TMPWI.WI_ID = WI.ID

