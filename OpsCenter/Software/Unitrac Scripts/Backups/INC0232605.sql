USE UniTrac


SELECT * FROM dbo.LENDER
WHERE CODE_TX = '4846' 

SELECT DISTINCT NUMBER_TX FROM dbo.LOAN
WHERE LENDER_ID = '2271' AND RECORD_TYPE_CD NOT IN ('I','U', 'E')

SELECT  * --INTO UniTracHDStorage.dbo.LOAN_4846_1
FROM    dbo.LOAN
WHERE   LENDER_ID IN ( 2271 )
        AND NUMBER_TX IN ( '30-014554', '30-014555', '30-014556', '30-014557',
                           '72-003687', '72-004158', '72-004159', '73-004681',
                           '73-004682', '73-004683', '74-018087', '74-018088',
                           '74-018089', '74-018090', '74-018091', '74-018092',
                           '74-018093', '74-018094', '74-018095', '74-018096',
                           '74-018097', '90-014383', '90-014384' )

SELECT * FROM UniTracHDStorage.dbo.LOAN_4846_1

UPDATE  Loan
SET     NUMBER_TX = '030-014554' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0232605'
WHERE   NUMBER_TX = '30-014554'
        AND LENDER_ID = '2271'
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '030-014555' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0232605'
WHERE   NUMBER_TX = '30-014555'
        AND LENDER_ID = '2271'
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '030-014556' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0232605'
WHERE   NUMBER_TX = '30-014556'
        AND LENDER_ID = '2271'
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '030-014557' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0232605'
WHERE   NUMBER_TX = '30-014557'
        AND LENDER_ID = '2271'
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '072-003687' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0232605'
WHERE   NUMBER_TX = '72-003687'
        AND LENDER_ID = '2271'
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '072-004158' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0232605'
WHERE   NUMBER_TX = '72-004158'
        AND LENDER_ID = '2271'
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '072-004159' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0232605'
WHERE   NUMBER_TX = '72-004159'
        AND LENDER_ID = '2271'
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '073-004681' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0232605'
WHERE   NUMBER_TX = '73-004681'
        AND LENDER_ID = '2271'
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '073-004682' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0232605'
WHERE   NUMBER_TX = '73-004682'
        AND LENDER_ID = '2271'
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '073-004683' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0232605'
WHERE   NUMBER_TX = '73-004683'
        AND LENDER_ID = '2271'
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '074-018087' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0232605'
WHERE   NUMBER_TX = '74-018087'
        AND LENDER_ID = '2271'
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '074-018088' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0232605'
WHERE   NUMBER_TX = '74-018088'
        AND LENDER_ID = '2271'
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '074-018089' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0232605'
WHERE   NUMBER_TX = '74-018089'
        AND LENDER_ID = '2271'
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '074-018090' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0232605'
WHERE   NUMBER_TX = '74-018090'
        AND LENDER_ID = '2271'
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '074-018091' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0232605'
WHERE   NUMBER_TX = '74-018091'
        AND LENDER_ID = '2271'
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '074-018092' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0232605'
WHERE   NUMBER_TX = '74-018092'
        AND LENDER_ID = '2271'
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '074-018093' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0232605'
WHERE   NUMBER_TX = '74-018093'
        AND LENDER_ID = '2271'
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '074-018094' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0232605'
WHERE   NUMBER_TX = '74-018094'
        AND LENDER_ID = '2271'
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '074-018095' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0232605'
WHERE   NUMBER_TX = '74-018095'
        AND LENDER_ID = '2271'
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '074-018096' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0232605'
WHERE   NUMBER_TX = '74-018096'
        AND LENDER_ID = '2271'
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '074-018097' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0232605'
WHERE   NUMBER_TX = '74-018097'
        AND LENDER_ID = '2271'
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '090-014383' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0232605'
WHERE   NUMBER_TX = '90-014383'
        AND LENDER_ID = '2271'
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '090-014384' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0232605'
WHERE   NUMBER_TX = '90-014384'
        AND LENDER_ID = '2271'
        AND PURGE_DT IS NULL;




--2) INSERT into PROPERTY_CHANGE table
INSERT INTO PROPERTY_CHANGE (ENTITY_NAME_TX,ENTITY_ID,USER_TX,ATTACHMENT_IN,CREATE_DT,AGENCY_ID,DETAILS_IN,FORMATTED_IN,LOCK_ID,PARENT_NAME_TX,PARENT_ID,TRANS_STATUS_CD,UTL_IN)
SELECT 'Allied.UniTrac.Loan',LOAN.ID,'INC0232605','N','2016-05-11 00:00:00.000',1,'Y','N',1,'Allied.UniTrac.Loan',LOAN.ID,'PEND','N'
FROM LOAN
WHERE ID IN (SELECT ID FROM UnitracHDStorage.dbo.LOAN_4846_1)
--46


--3) INSERT into PROPERTY_CHANGE_UPDATE table
INSERT INTO PROPERTY_CHANGE_UPDATE (CHANGE_ID, TABLE_NAME_TX, TABLE_ID, COLUMN_NM, FROM_VALUE_TX,TO_VALUE_TX,DATATYPE_NO,CREATE_DT,DISPLAY_IN,OPERATION_CD)
select PROPERTY_CHANGE.ID,'LOAN',ENTITY_ID,'NUMBER_TX',UnitracHDStorage.dbo.LOAN_4846_1.NUMBER_TX,LOAN.NUMBER_TX,1,'2016-05-11 00:00:00.000','Y','U'
from PROPERTY_CHANGE
INNER JOIN LOAN ON PROPERTY_CHANGE.ENTITY_ID = LOAN.ID AND ENTITY_NAME_TX = 'Allied.UniTrac.Loan' 
INNER JOIN UnitracHDStorage.dbo.LOAN_4846_1 ON LOAN.ID = UnitracHDStorage.dbo.LOAN_4846_1.ID --AND ENTITY_NAME_TX = 'Allied.UniTrac.Loan' 
WHERE PROPERTY_CHANGE.CREATE_DT = '2016-05-11 00:00:00.000'
AND ENTITY_ID IN (SELECT ID FROM UnitracHDStorage.dbo.LOAN_4846_1)
--46

---4) Insert into LOAN_NUMBER Table (Leave old numbers for matching purposes)

INSERT INTO LOAN_NUMBER (LOAN_ID,NUMBER_TX,EFFECTIVE_DT,CREATE_DT,UPDATE_DT,UPDATE_USER_TX, LOCK_ID)
SELECT dbo.LOAN.ID, dbo.LOAN.NUMBER_TX,dbo.LOAN.EFFECTIVE_DT,GETDATE(),GETDATE(),'INC0232605',1
FROM UnitracHDStorage.dbo.LOAN_4846_1 HD INNER JOIN dbo.LOAN ON HD.ID = LOAN.ID
--46

--5) Full Text Search Updates

--Create updates
SELECT 'EXEC SaveSearchFullText', PROPERTY.ID 
FROM PROPERTY
INNER JOIN COLLATERAL ON PROPERTY.ID = COLLATERAL.PROPERTY_ID
AND LOAN_ID in (select ID FROM UnitracHDStorage.dbo.LOAN_4846_1)
--46



EXEC SaveSearchFullText	126477030
EXEC SaveSearchFullText	126477031
EXEC SaveSearchFullText	126477034
EXEC SaveSearchFullText	126477035
EXEC SaveSearchFullText	126477036
EXEC SaveSearchFullText	126477039
EXEC SaveSearchFullText	126477046
EXEC SaveSearchFullText	126477048
EXEC SaveSearchFullText	126477050
EXEC SaveSearchFullText	126477053
EXEC SaveSearchFullText	126477054
EXEC SaveSearchFullText	126477055
EXEC SaveSearchFullText	126477058
EXEC SaveSearchFullText	126477059
EXEC SaveSearchFullText	126477060
EXEC SaveSearchFullText	126477061
EXEC SaveSearchFullText	126477062
EXEC SaveSearchFullText	126477063
EXEC SaveSearchFullText	126477064
EXEC SaveSearchFullText	126477065
EXEC SaveSearchFullText	126477067
EXEC SaveSearchFullText	126477069
EXEC SaveSearchFullText	126477070
EXEC SaveSearchFullText	126478824
EXEC SaveSearchFullText	126478832
EXEC SaveSearchFullText	126478874
EXEC SaveSearchFullText	126478875
EXEC SaveSearchFullText	126478926
EXEC SaveSearchFullText	126478927
EXEC SaveSearchFullText	126478928
EXEC SaveSearchFullText	126478944
EXEC SaveSearchFullText	126478951
EXEC SaveSearchFullText	126478971
EXEC SaveSearchFullText	126478974
EXEC SaveSearchFullText	126478975
EXEC SaveSearchFullText	126478976
EXEC SaveSearchFullText	126478977
EXEC SaveSearchFullText	126478978
EXEC SaveSearchFullText	126478984
EXEC SaveSearchFullText	126478988
EXEC SaveSearchFullText	126478995
EXEC SaveSearchFullText	126478996
EXEC SaveSearchFullText	126478998
EXEC SaveSearchFullText	126478999
EXEC SaveSearchFullText	126479003
EXEC SaveSearchFullText	126479004