USE [UniTrac]
GO 

--Loan Screen Information - LOAN/COLLATERAL/PROPERTY/OWNER/REQUIRED COVERAGE
SELECT PC.COVERAGE_BASIS_CD, OP. *
--INTO UniTracHDStorage..INC0228273_IH
 FROM LOAN L
INNER JOIN COLLATERAL C ON L.ID = C.LOAN_ID
INNER JOIN PROPERTY P ON C.PROPERTY_ID = P.ID
INNER JOIN REQUIRED_COVERAGE RC ON P.ID = RC.PROPERTY_ID
INNER JOIN OWNER_LOAN_RELATE OL ON L.ID = OL.LOAN_ID
INNER JOIN OWNER O ON OL.OWNER_ID = O.ID
INNER JOIN OWNER_ADDRESS OA ON O.ADDRESS_ID = OA.ID
INNER JOIN dbo.LENDER LL ON LL.ID = L.LENDER_ID
INNER JOIN dbo.PROPERTY_OWNER_POLICY_RELATE POP ON POP.PROPERTY_ID = P.ID
INNER JOIN dbo.OWNER_POLICY OP ON OP.ID = POP.OWNER_POLICY_ID
INNER JOIN dbo.POLICY_COVERAGE PC ON PC.OWNER_POLICY_ID = OP.ID
INNER JOIN UniTracHDStorage..INC0228273 B ON B.[Loan Number] = L.NUMBER_TX AND L.LENDER_ID = '2260'
WHERE LL.CODE_TX IN ('7350') AND PC.ID IN (351312535)


SELECT PC.COVERAGE_BASIS_CD, RC.IncludePolicyCoverageOtherStructure, PC. *
--INTO UniTracHDStorage..INC0228273_IH
 FROM LOAN L
INNER JOIN COLLATERAL C ON L.ID = C.LOAN_ID
INNER JOIN PROPERTY P ON C.PROPERTY_ID = P.ID
INNER JOIN REQUIRED_COVERAGE RC ON P.ID = RC.PROPERTY_ID
INNER JOIN OWNER_LOAN_RELATE OL ON L.ID = OL.LOAN_ID
INNER JOIN OWNER O ON OL.OWNER_ID = O.ID
INNER JOIN OWNER_ADDRESS OA ON O.ADDRESS_ID = OA.ID
INNER JOIN dbo.LENDER LL ON LL.ID = L.LENDER_ID
INNER JOIN dbo.PROPERTY_OWNER_POLICY_RELATE POP ON POP.PROPERTY_ID = P.ID
INNER JOIN dbo.OWNER_POLICY OP ON OP.ID = POP.OWNER_POLICY_ID
INNER JOIN dbo.POLICY_COVERAGE PC ON PC.OWNER_POLICY_ID = OP.ID
--INNER JOIN UniTracHDStorage..INC0228273 B ON B.[Loan Number] = L.NUMBER_TX AND L.LENDER_ID = '2260'
WHERE LL.CODE_TX IN ('7350') AND PC.ID IN (351312535)









SELECT * FROM dbo.REF_CODE
WHERE --CODE_CD = 'CADW'
DOMAIN_CD = 'CoverageBasis'































































































































































































































































/*

UPDATE dbo.POLICY_COVERAGE
SET COVERAGE_BASIS_CD = 'SV', LOCK_ID= LOCK_ID+1, UPDATE_DT = GETDATE(), UPDATE_USER_TX = 'INC0228273'
--SELECT COVERAGE_BASIS_CD, * FROM dbo.POLICY_COVERAGE
WHERE ID IN (351312535,
351312535)

UPDATE dbo.INTERACTION_HISTORY
SET     SPECIAL_HANDLING_XML.modify('replace value of (/SH/OwnerPolicy/PolicyCoverages/PolicyCoverage/CoverageBasisCd/text())[1] with "SV"') ,
        LOCK_ID = LOCK_ID + 1, UPDATE_DT = GETDATE(), UPDATE_USER_TX = 'INC0228273'
----SELECT SPECIAL_HANDLING_XML.value('(/SH/OwnerPolicy/PolicyCoverages/PolicyCoverage/CoverageBasisCd)[1]', 'nvarchar (50)'),* FROM dbo.INTERACTION_HISTORY
 WHERE ID = '194592014' 

 107811375

UPDATE dbo.POLICY_COVERAGE
SET COVERAGE_BASIS_CD = 'RCV', LOCK_ID= LOCK_ID+1, UPDATE_DT = GETDATE(), UPDATE_USER_TX = 'INC0228273'
--SELECT COVERAGE_BASIS_CD, * FROM dbo.POLICY_COVERAGE
WHERE ID IN (SELECT ID FROM UniTracHDStorage..INC0228273_PC) 

UPDATE dbo.INTERACTION_HISTORY
SET     SPECIAL_HANDLING_XML.modify('replace value of (/SH/OwnerPolicy/PolicyCoverages/PolicyCoverage/CoverageBasisCd/text())[1] with "RCV"') ,
        LOCK_ID = LOCK_ID + 1, UPDATE_DT = GETDATE(), UPDATE_USER_TX = 'INC0228273'
----SELECT SPECIAL_HANDLING_XML.value('(/SH/OwnerPolicy/PolicyCoverages/PolicyCoverage/CoverageBasisCd)[1]', 'nvarchar (50)'),* FROM dbo.INTERACTION_HISTORY
 WHERE ID IN (SELECT ID FROM dbo.INTERACTION_HISTORY
WHERE PROPERTY_ID IN (SELECT * FROM UniTracHDStorage..INC0228273_IH) AND TYPE_CD = 'OWNERPOLICY'
AND SPECIAL_HANDLING_XML.value('(/SH/OwnerPolicy/PolicyCoverages/PolicyCoverage/CoverageBasisCd)[1]', 'nvarchar (50)') = 'SV')



*/

