USE [UniTrac]
GO 

--Loan Screen Information - LOAN/COLLATERAL/PROPERTY/OWNER/REQUIRED COVERAGE
SELECT TOP 5 * FROM LOAN L
INNER JOIN COLLATERAL C ON L.ID = C.LOAN_ID
INNER JOIN PROPERTY P ON C.PROPERTY_ID = P.ID
INNER JOIN REQUIRED_COVERAGE RC ON P.ID = RC.PROPERTY_ID
INNER JOIN OWNER_LOAN_RELATE OL ON L.ID = OL.LOAN_ID
INNER JOIN OWNER O ON OL.OWNER_ID = O.ID
INNER JOIN OWNER_ADDRESS OA ON O.ADDRESS_ID = OA.ID
INNER JOIN dbo.LENDER LL ON LL.ID = L.LENDER_ID
WHERE l.NUMBER_TX = '9906-1' AND ll.CODE_TX = '2982'


SELECT * FROM dbo.LENDER
WHERE CODE_TX IN () 



SELECT  *
FROM    dbo.COLLATERAL_CODE
WHERE   DESCRIPTION_TX LIKE '%%'
        AND AGENCY_ID = '1'
        AND ID IN (  )








SELECT ID INTO #tmpLOAN2257
FROM LOAN
WHERE LENDER_ID = 2257

SELECT  ID ,
        ENTITY_NAME_TX ,
        ENTITY_ID ,
        NOTE_TX ,
        TICKET_TX ,
        USER_TX ,
        ATTACHMENT_IN ,
        PROPERTY_CHANGE.CREATE_DT PC_Create_DT,
        AGENCY_ID ,
        DESCRIPTION_TX ,
        DETAILS_IN ,
        FORMATTED_IN ,
        LOCK_ID ,
        PARENT_NAME_TX ,
        PARENT_ID ,
        TRANS_STATUS_CD ,
        TRANS_STATUS_DT ,
        UTL_IN ,
        SUPPORT_TRIGGER_IN ,
        CHANGE_ID ,
        TABLE_NAME_TX ,
        TABLE_ID ,
        QUALIFIER_TX ,
        COLUMN_NM ,
        FROM_VALUE_TX ,
        TO_VALUE_TX ,
        DATATYPE_NO ,
        PROPERTY_CHANGE_UPDATE.CREATE_DT PCU_Create_Dt ,
        AREA_TX ,
        FORMAT_FROM_VALUE_TX ,
        FORMAT_TO_VALUE_TX ,
        DISPLAY_IN ,
        OPERATION_CD INTO #tmpLoan2257_2
FROM PROPERTY_CHANGE
INNER JOIN PROPERTY_CHANGE_UPDATE ON PROPERTY_CHANGE.ID = PROPERTY_CHANGE_UPDATE.CHANGE_ID
WHERE ENTITY_NAME_TX = 'Allied.UniTrac.Loan' AND ENTITY_ID IN (SELECT ID FROM #tmpLOAN2257)
AND COLUMN_NM = 'BRANCH_CODE_TX'


 SELECT DISTINCT LO.TYPE_CD, LO.CODE_TX , Lo.NAME_TX INTO #tmpLoan2257_3
FROM LENDER L
INNER JOIN LENDER_ORGANIZATION LO ON L.ID = LO.LENDER_ID
INNER JOIN RELATED_DATA RD ON LO.ID = RD.RELATE_ID --AND RD.DEF_ID = '105'
WHERE L.CODE_TX = '2982' AND Lo.TYPE_CD = 'BRCH'

SELECT * FROM #tmpLoan2257_2
WHERE ID IN (3230490986)
--SELECT * FROM #tmpLoan2257_3


SELECT A.ENTITY_ID Loan_ID, L. NUMBER_TX,
 B.NAME_TX [From Branch], A.FROM_VALUE_TX [From Branch Code], 
C.NAME_TX[To Branch],A.TO_VALUE_TX [To Branch Code], A.PC_Create_DT [Date Changed]
FROM #tmpLoan2257_2 A
INNER JOIN #tmpLoan2257_3 B ON A.FROM_VALUE_TX = B. CODE_TX
INNER JOIN #tmpLoan2257_3 C ON A.TO_VALUE_TX = C.CODE_TX
INNER JOIN dbo.LOAN L ON L.ID = A.ENTITY_ID 
WHERE A.FROM_VALUE_TX <> A.TO_VALUE_TX AND A.PC_Create_DT > '2015-12-10'
ORDER BY A.PC_Create_DT ASC