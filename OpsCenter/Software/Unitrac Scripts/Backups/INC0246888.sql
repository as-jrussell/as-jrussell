USE UniTrac
SELECT * FROM dbo.LENDER
WHERE CODE_TX = '4299'

SELECT  * INTO UniTracHDStorage.dbo.LOAN_4299_1
FROM    dbo.LOAN
WHERE   LENDER_ID IN ( 450 )
        AND NUMBER_TX IN (  '135-202','2615-200','4835-200','5389-201','5868-201','6735-200','6821-200','7957-201','7988-201','8183-202','8243-202','8405-104','8571-202','8985-203','9236-202','9271-106','9391-200','11429-201','11590-202','11973-101','13667-204')

SELECT * FROM UniTracHDStorage.dbo.LOAN_4299_1



UPDATE  Loan
SET     NUMBER_TX = '135-200' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0246888'
WHERE   NUMBER_TX = '135-202'
        AND LENDER_ID = 450
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '2615-201' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0246888'
WHERE   NUMBER_TX = '2615-200'
        AND LENDER_ID = 450
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '4835-201' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0246888'
WHERE   NUMBER_TX = '4835-200'
        AND LENDER_ID = 450
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '5389-202' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0246888'
WHERE   NUMBER_TX = '5389-201'
        AND LENDER_ID = 450
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '5868-202' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0246888'
WHERE   NUMBER_TX = '5868-201'
        AND LENDER_ID = 450
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '6735-202' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0246888'
WHERE   NUMBER_TX = '6735-200'
        AND LENDER_ID = 450
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '6821-201' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0246888'
WHERE   NUMBER_TX = '6821-200'
        AND LENDER_ID = 450
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '7957-204' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0246888'
WHERE   NUMBER_TX = '7957-201'
        AND LENDER_ID = 450
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '7988-300' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0246888'
WHERE   NUMBER_TX = '7988-201'
        AND LENDER_ID = 450
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '8183-203' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0246888'
WHERE   NUMBER_TX = '8183-202'
        AND LENDER_ID = 450
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '8243-203' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0246888'
WHERE   NUMBER_TX = '8243-202'
        AND LENDER_ID = 450
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '8405-200' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0246888'
WHERE   NUMBER_TX = '8405-104'
        AND LENDER_ID = 450
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '8571-300' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0246888'
WHERE   NUMBER_TX = '8571-202'
        AND LENDER_ID = 450
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '8985-301' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0246888'
WHERE   NUMBER_TX = '8985-203'
        AND LENDER_ID = 450
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '9236-203' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0246888'
WHERE   NUMBER_TX = '9236-202'
        AND LENDER_ID = 450
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '9271-201' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0246888'
WHERE   NUMBER_TX = '9271-106'
        AND LENDER_ID = 450
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '9391-202' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0246888'
WHERE   NUMBER_TX = '9391-200'
        AND LENDER_ID = 450
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '11429-202' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0246888'
WHERE   NUMBER_TX = '11429-201'
        AND LENDER_ID = 450
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '11590-203' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0246888'
WHERE   NUMBER_TX = '11590-202'
        AND LENDER_ID = 450
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '11973-201' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0246888'
WHERE   NUMBER_TX = '11973-101'
        AND LENDER_ID = 450
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '13667-205' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0246888'
WHERE   NUMBER_TX = '13667-204'
        AND LENDER_ID = 450
        AND PURGE_DT IS NULL;


--2) INSERT into PROPERTY_CHANGE table
INSERT INTO PROPERTY_CHANGE (ENTITY_NAME_TX,ENTITY_ID,USER_TX,ATTACHMENT_IN,CREATE_DT,AGENCY_ID,DETAILS_IN,FORMATTED_IN,LOCK_ID,PARENT_NAME_TX,PARENT_ID,TRANS_STATUS_CD,UTL_IN)
SELECT 'Allied.UniTrac.Loan',LOAN.ID,'INC0246888','N','2016-08-31 00:00:00.000',1,'Y','N',1,'Allied.UniTrac.Loan',LOAN.ID,'PEND','N'
FROM LOAN
WHERE ID IN (SELECT ID FROM UnitracHDStorage.dbo.LOAN_4299_1)
--42


--3) INSERT into PROPERTY_CHANGE_UPDATE table
INSERT INTO PROPERTY_CHANGE_UPDATE (CHANGE_ID, TABLE_NAME_TX, TABLE_ID, COLUMN_NM, FROM_VALUE_TX,TO_VALUE_TX,DATATYPE_NO,CREATE_DT,DISPLAY_IN,OPERATION_CD)
select PROPERTY_CHANGE.ID,'LOAN',ENTITY_ID,'NUMBER_TX',UnitracHDStorage.dbo.LOAN_4299_1.NUMBER_TX,LOAN.NUMBER_TX,1,'2016-08-31 00:00:00.000','Y','U'
from PROPERTY_CHANGE
INNER JOIN LOAN ON PROPERTY_CHANGE.ENTITY_ID = LOAN.ID AND ENTITY_NAME_TX = 'Allied.UniTrac.Loan' 
INNER JOIN UnitracHDStorage.dbo.LOAN_4299_1 ON LOAN.ID = UnitracHDStorage.dbo.LOAN_4299_1.ID --AND ENTITY_NAME_TX = 'Allied.UniTrac.Loan' 
WHERE PROPERTY_CHANGE.CREATE_DT = '2016-08-31 00:00:00.000'
AND ENTITY_ID IN (SELECT ID FROM UnitracHDStorage.dbo.LOAN_4299_1)
--0

---4) Insert into LOAN_NUMBER Table (Leave old numbers for matching purposes)

INSERT INTO LOAN_NUMBER (LOAN_ID,NUMBER_TX,EFFECTIVE_DT,CREATE_DT,UPDATE_DT,UPDATE_USER_TX, LOCK_ID)
SELECT dbo.LOAN.ID, dbo.LOAN.NUMBER_TX,dbo.LOAN.EFFECTIVE_DT,GETDATE(),GETDATE(),'INC0246888',1
FROM UnitracHDStorage.dbo.LOAN_4299_1 HD INNER JOIN dbo.LOAN ON HD.ID = LOAN.ID
--42

--5) Full Text Search Updates

--Create updates
SELECT 'EXEC SaveSearchFullText', PROPERTY.ID 
FROM PROPERTY
INNER JOIN COLLATERAL ON PROPERTY.ID = COLLATERAL.PROPERTY_ID
AND LOAN_ID in (select ID FROM UnitracHDStorage.dbo.LOAN_4299_1)
--42



EXEC SaveSearchFullText	94626769
EXEC SaveSearchFullText	6433978
EXEC SaveSearchFullText	6434018
EXEC SaveSearchFullText	6434215
EXEC SaveSearchFullText	6434445
EXEC SaveSearchFullText	6434477
EXEC SaveSearchFullText	6434801
EXEC SaveSearchFullText	6434842
EXEC SaveSearchFullText	6433801
EXEC SaveSearchFullText	8940975
EXEC SaveSearchFullText	14798891
EXEC SaveSearchFullText	19523965
EXEC SaveSearchFullText	52042382
EXEC SaveSearchFullText	56036565
EXEC SaveSearchFullText	56037035
EXEC SaveSearchFullText	61139235
EXEC SaveSearchFullText	6434215
EXEC SaveSearchFullText	6434018
EXEC SaveSearchFullText	70520369
EXEC SaveSearchFullText	73862756
EXEC SaveSearchFullText	19523983
EXEC SaveSearchFullText	83847672
EXEC SaveSearchFullText	83847681
EXEC SaveSearchFullText	85660091
EXEC SaveSearchFullText	88504406
EXEC SaveSearchFullText	92441017
EXEC SaveSearchFullText	94626770
EXEC SaveSearchFullText	98599571
EXEC SaveSearchFullText	83847680
EXEC SaveSearchFullText	111269308
EXEC SaveSearchFullText	103506286
EXEC SaveSearchFullText	6434423
EXEC SaveSearchFullText	46279267
EXEC SaveSearchFullText	117985267
EXEC SaveSearchFullText	117985268
EXEC SaveSearchFullText	41102015
EXEC SaveSearchFullText	117985289
EXEC SaveSearchFullText	117985453
EXEC SaveSearchFullText	123023619
EXEC SaveSearchFullText	6433967
EXEC SaveSearchFullText	123023640
EXEC SaveSearchFullText	125300520
EXEC SaveSearchFullText	125300536
EXEC SaveSearchFullText	125300642
EXEC SaveSearchFullText	127088884