USE UniTrac


SELECT DISTINCT 
TP.EXTERNAL_ID_TX [Lender Code] ,
tp.NAME_TX[Lender Name] , LOC.NAME_TX [Division], DI.DELIVERY_TYPE_CD [PreProcessing Details],
RDD.VALUE_TX [Import Configurations],
MAX(CONVERT(DATE,cu.CREATE_DT) ) [Enable First Line Of Insurance Added],  
MAX(CU.TO_VALUE_TX) [Enable First Line Of Insurance]
FROM DELIVERY_INFO_EXTRACT_CONFIG_RELATE DIE
LEFT JOIN VUT.dbo.tbllenderextract LE on DIE.RELATE_ID = LE.LenderExtractKey AND DIE.RELATE_CLASS_NAME_TX = 'LenderExtract'
LEFT JOIN LENDER_ORGANIZATION LOC ON LE.ContractTypeKey = LOC.ID
LEFT JOIN dbo.LENDER L ON L.ID = LOC.LENDER_ID
LEFT JOIN dbo.TRADING_PARTNER TP ON TP.EXTERNAL_ID_TX = L.CODE_TX
LEFT JOIN dbo.DELIVERY_INFO DI ON DI.TRADING_PARTNER_ID = TP.ID
LEFT JOIN dbo.DELIVERY_INFO_GROUP DIG ON DIG.DELIVERY_INFO_ID = DI.ID
LEFT JOIN dbo.DELIVERY_DETAIL DD ON DD.DELIVERY_INFO_GROUP_ID = DIG.ID
LEFT JOIN dbo.DELIVERY_INFO_EXTRACT_CONFIG_RELATE DIC ON DIC.DELIVERY_INFO_ID = DI.ID
LEFT JOIN dbo.RELATED_DATA RDD ON RDD.RELATE_ID = DI.ID AND RDD.DEF_ID = '96'
LEFT JOIN dbo.CHANGE C ON DI.ID = C.ENTITY_ID
LEFT JOIN dbo.CHANGE_UPDATE CU ON CU.CHANGE_ID = C.ID AND Cu.QUALIFIER_TX like '%Enable 1st Line of Insurance Processing%'
LEFT JOIN dbo.PPDATTRIBUTE PD ON PD.ID = Cu.TABLE_ID
WHERE  DIE.PURGE_DT IS NULL 
AND C.DESCRIPTION_TX LIKE '%1st line%' 
GROUP BY TP.EXTERNAL_ID_TX ,tp.NAME_TX,  DI.DELIVERY_TYPE_CD,   LOC.NAME_TX,RDD.VALUE_TX, C.CREATE_DT,CU.TO_VALUE_TX 



