USE UniTrac;


select rc.ID, L.NUMBER_TX into #tmpR
--SELECT P.ID, L.NUMBER_TX into #tmpP 
FROM LOAN L
INNER JOIN COLLATERAL C ON L.ID = C.LOAN_ID
INNER JOIN PROPERTY P ON C.PROPERTY_ID = P.ID
INNER JOIN REQUIRED_COVERAGE RC ON P.ID = RC.PROPERTY_ID
INNER JOIN OWNER_LOAN_RELATE OL ON L.ID = OL.LOAN_ID
INNER JOIN OWNER O ON OL.OWNER_ID = O.ID
INNER JOIN OWNER_ADDRESS OA ON O.ADDRESS_ID = OA.ID
INNER JOIN dbo.LENDER LL ON LL.ID = L.LENDER_ID
WHERE LL.CODE_TX IN ('3000') AND L.NUMBER_TX IN ('118312185','117691874','117736645','117690019','117690037','117690046', '118199087','118153191','118142926','118084802','118302467','118157096','118278272','115701920','117778681','118130875',
'117966246','117961139','117698547','118234380','119100615','117553169','117975622','116689904','118031392','117715743','118211569','117783863','116271792','118118079','118048998','118269832','118141198','118137959','118168579','118349873',
'115741364','117712153','118143240','117718267','118010913','117870839','117590847','118387026','116871811','117810013','117863970','117557176','118166856','117614967','118222172','116897062','118282381','118315113','118315814','114783714',
'117729030','118331560','116117948','118291543','118017453','118298524','117793095','116683902','118074906','117797990','117670486','116866675','118041681','118115621','118163855','118071567','117794926','118037910','117722992','117684689',
'116861577','118200349','117714474','118291477','118174338','118216377','117782062','118223021','117526668','117772175','117637939','116816586','117823143','118161114','116978822','117703768','118282680','117796162','118130549','118233945',
'117920659','117850626','118088266','117602393','117602526','118166650','118146540','118390606','118390053','118365510','118373962','117747810','117741573','118214533','117943359','118361633','118241285','118393009','118188278','118127820',
'114206941','119201530','117655746','118249740','118224729','118224738','118104737','117636343','117636352','118184186','118206891','117429639','117901760','118076106','117631955','118314796','117993037','117786985','117608845','118329035',
'118017734','118155065','118310958','118172099','118372442','117750744','118265964','117834121','118384481','117851669','118147547','117904387','116875930','115943364','118415358','117559938','116869023','116885612','117834167','117358494',
'117325302','118214524','118194635','118214355','118315588','117757819','117700196','117657003','118003072','117860625','117770368','116910028','118090317','118241409','117734968','118213479','118194653','119062414','118385291','117769616',
'118198736','118073758','117756803','118229573','118204963','118377317','118258528','118012494','117813050','118209025','118091314')

update IH set purge_dt = GETDATE(), update_dt = GETDATE(), update_user_tx = 'INC0349338', LOCK_ID=LOCK_ID+1
--select * 
from interaction_history ih
join #tmpP P on P.ID = IH.Property_ID
where type_cd = 'IMPAIRMENT'



update IH set purge_dt = GETDATE(), update_dt = GETDATE(), update_user_tx = 'INC0349338', LOCK_ID=LOCK_ID+1
--select * 
from impairment ih
join #tmpR P on P.ID = IH.REQUIRED_COVERAGE_ID



select P.NUMBER_TX, IH.* into UnitracHDStorage..INC0349338_InteractionHistory
from interaction_history ih
join #tmpP P on P.ID = IH.Property_ID
where type_cd = 'IMPAIRMENT'
