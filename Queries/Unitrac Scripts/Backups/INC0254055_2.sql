USE [UniTrac]
GO 

--Loan Screen Information - LOAN/COLLATERAL/PROPERTY/OWNER/REQUIRED COVERAGE
SELECT PC.*
--INTO UniTracHDStorage..INC0254055_PC
 FROM LOAN L
INNER JOIN COLLATERAL C ON L.ID = C.LOAN_ID
INNER JOIN PROPERTY P ON C.PROPERTY_ID = P.ID
INNER JOIN REQUIRED_COVERAGE RC ON P.ID = RC.PROPERTY_ID
INNER JOIN dbo.PROPERTY_OWNER_POLICY_RELATE POP ON POP.PROPERTY_ID = P.ID
INNER JOIN dbo.OWNER_POLICY OP ON OP.ID = POP.OWNER_POLICY_ID
INNER JOIN dbo.POLICY_COVERAGE PC ON PC.OWNER_POLICY_ID = OP.ID
WHERE RC.ID IN (SELECT ID FROM UniTracHDStorage..INC0254055) AND CANCELLATION_DT IS NULL


UPDATE OP
SET OP.SUB_STATUS_CD = 'R', OP.STATUS_CD =  '' , OP.UPDATE_DT = GETDATE(), 
OP.UPDATE_USER_TX = 'INC0254055', OP.EXPIRATION_DT = DATEADD(MONTH, 6, OP.MOST_RECENT_EFFECTIVE_DT)
--SELECT  OP.MOST_RECENT_EFFECTIVE_DT, OP.EFFECTIVE_DT, OP.MOST_RECENT_MAIL_DT,  OP.EXPIRATION_DT, * 
FROM dbo.OWNER_POLICY OP
INNER JOIN UniTracHDStorage..INC0254055_OP OPP ON Opp.ID = OP.ID 




UPDATE PC SET PC.END_DT = OP.EXPIRATION_DT , 
PC.CANCELLED_IN = 'N' ,
PC.UPDATE_DT = GETDATE() , 
PC.UPDATE_USER_TX = 'INC0254055' , 
PC.LOCK_ID = PC.LOCK_ID % 255 + 1
---- SELECT PC.END_DT, OP.EXPIRATION_DT, *
FROM POLICY_COVERAGE PC 
JOIN  UniTracHDStorage..INC0254055_PC T1 ON T1.ID = PC.ID
JOIN dbo.OWNER_POLICY OP ON op.ID = PC.OWNER_POLICY_ID



UPDATE REQUIRED_COVERAGE 
 SET GOOD_THRU_DT = NULL , 
INSURANCE_STATUS_CD = '' , 
INSURANCE_SUB_STATUS_CD = 'R' , 
SUMMARY_STATUS_CD = '' , 
SUMMARY_SUB_STATUS_CD = 'R' , 
NOTICE_DT = NULL , 
NOTICE_SEQ_NO = NULL , 
NOTICE_TYPE_CD = NULL , 
LAST_EVENT_DT = NULL , 
LAST_EVENT_SEQ_ID = NULL , 
LAST_SEQ_CONTAINER_ID = NULL ,
UPDATE_DT = GETDATE() , 
UPDATE_USER_TX =  'INC0254055' , 
LOCK_ID = LOCK_ID % 255 + 1
---- SELECT * FROM REQUIRED_COVERAGE 
WHERE ID IN (SELECT ID FROM UniTracHDStorage..INC0254055)
AND REQUIRED_COVERAGE.STATUS_CD = 'A'


INSERT  INTO PROPERTY_CHANGE
        ( ENTITY_NAME_TX ,
          ENTITY_ID ,
          USER_TX ,
          ATTACHMENT_IN ,
          CREATE_DT ,
          AGENCY_ID ,
          DESCRIPTION_TX ,
          DETAILS_IN ,
          FORMATTED_IN ,
          LOCK_ID ,
          PARENT_NAME_TX ,
          PARENT_ID ,
          TRANS_STATUS_CD ,
          UTL_IN
        )
        SELECT DISTINCT
                'Allied.UniTrac.RequiredCoverage' ,
                ID ,
                'INC0254055' ,
                'N' ,
                GETDATE() ,
                1 ,
                'Changed Summary status to Re-audit Expired' ,
                'N' ,
                'Y' ,
                1 ,
                'Allied.UniTrac.RequiredCoverage' ,
                ID ,
                'PEND' ,
                'N'
        FROM    dbo.REQUIRED_COVERAGE
        WHERE   ID IN ( SELECT  ID
                        FROM    UniTracHDStorage..INC0254055)
						AND REQUIRED_COVERAGE.STATUS_CD = 'A'

--PHYS-DAMAGE
--COMM-LIABILITY
--FLOOD
--HAZARD

SELECT * FROM dbo.REF_CODE
WHERE DOMAIN_CD IN ('RequiredCoverageSubStatus', 'RequiredCoverageStatus')
AND CODE_CD IN ('F',  'D', 'C', 'A')

SELECT L.NUMBER_TX, RC.SUMMARY_STATUS_CD, RC.SUMMARY_SUB_STATUS_CD,
        RC.TYPE_CD
FROM    dbo.LOAN L
        JOIN dbo.COLLATERAL C ON C.LOAN_ID = L.ID
        JOIN dbo.PROPERTY P ON P.ID = C.PROPERTY_ID
        JOIN dbo.REQUIRED_COVERAGE RC ON RC.PROPERTY_ID = P.ID
WHERE  RC.TYPE_CD  IN ('PHYS-DAMAGE', 'COMM-LIABILITY') AND 
 L.NUMBER_TX IN ( '1010884820002', '7010002157', '1030436120005',
                         '1030812450003', '7000000640', '7010006687',
                         '1030893760003', '7010009475', '1030882300003',
                         '7010006521', '7000000580', '1030904820003',
                         '7000000713', '7010005689', '7000000509',
                         '7000000400', '7010005200', '1030910590003',
                         '1030136650005', '7010008626', '1017861700016',
                         '1030003840008', '7010009079', '7010008352',
                         '7000000762', '1015241000011', '1030128250004',
                         '1013329900006', '7000000055', '1030182360005',
                         '1011900100019', '7010002751', '7010006877',
                         '7000000115', '1030906520002', '7010010036',
                         '7000000612', '1030904610003', '1030794100003',
                         '1030048000006', '7010009822', '1030900260004',
                         '1704390600', '7000000900', '7010009939',
                         '7000000344', '7010008527', '7010010135',
                         '7010011356', '1030947500003', '7010006430',
                         '1014797700006', '1030388350004', '1031027490003',
                         '1030078660005', '1013179410004', '7010009913',
                         '1030667900003', '7010011380', '1013519300005',
                         '7010009624', '7010008634', '1015845900005',
                         '1015087110005', '1030168100005', '1031028570002',
                         '1030627350004', '7000001046', '7000000671',
                         '1014533200005', '1030228110001', '7010009715',
                         '1019688300004', '7010009368', '7000001809',
                         '7010011562', '7010011067', '1013921820006',
                         '7010008766', '1012463700013', '1031037210003',
                         '1030067510006', '1030555050003', '1030831270003',
                         '1011737700012', '1013297830002', '7010013899',
                         '1013682710002', '1030947460003', '7000000357',
                         '7010009285', '7010010606', '7010008741',
                         '1030702320003', '1031022400003', '1017129800005',
                         '1013136100005', '1031040020002', '7000000977',
                         '1031040660003', '7010011869', '1031044050003',
                         '7010014442', '7010014376', '1030939770004',
                         '7010012289', '7010013881', '1017928600005',
                         '1030609740002', '7010013832', '1011333790005',
                         '7010013204', '7010011695', '1018510800008',
                         '7010014863', '7010011679', '1031044280002',
                         '7010012487', '7000001251', '1017949610005',
                         '1031042990002', '1014324000008', '1030813230003',
                         '1016367800010', '7010013873', '7010011554',
                         '1030898210003', '7010014780', '7010015951',
                         '1270850600', '1014708620004', '1031043510003',
                         '7010012172', '7010015977', '1200660600',
                         '7000000988', '1031028070002', '1016117800004',
                         '7000001089', '7000001478', '7000001132',
                         '7010015464', '1030539710004', '1030916240003',
                         '7000001249', '7000001391', '1031061130003',
                         '7010008311', '7010012545', '7010015001',
                         '7010012990', '7010016959', '7010016710',
                         '1030077700007', '1017251500003', '1012237900003',
                         '7000001300', '7010016694', '1031045530002',
                         '1285550600', '7000001280', '7000000955',
                         '1031036520002', '1019583410002', '7010016223',
                         '7000000689', '7010017064', '1031071830002',
                         '1031065000003', '1030900240003', '1031065150003',
                         '1013759800011', '7010011281', '7010018922',
                         '7010015886', '1019323700006', '7010017403',
                         '1031077580003', '7010013766', '7000001121',
                         '1030268800006', '7000001609', '7000001314',
                         '7000001697', '7010017205', '1031055710003',
                         '7000001410', '1030195520007', '1011089710006',
                         '1031084330003', '1031068540004', '7010020100',
                         '1030425420005', '7010018088', '1031039400005',
                         '1540872600', '3052343602', '7000001776',
                         '1031090400002', '3033018600', '1030798920003',
                         '7000002115', '1030466010006', '1923750',
                         '1030453110004', '7000001818', '7000001526',
                         '7000001419', '7000002048', '3014212600',
                         '7000002111', '1712660600', '7000002213',
                         '7000001301', '3027999600', '7000001991',
                         '3062399600', '7000000056', '7000002079',
                         '7000001242', '3051029600', '7000000896',
                         '7000001367', '7000001909', '7000002212',
                         '7000001518', '1013748800006', '7000001371',
                         '1392377601', '7000001986', '7000000120',
                         '3047988601', '7000002207', '7000001711',
                         '7000002245', '7010002934', '1015946200006',
                         '1594620600', '7010001571', '7010003098',
                         '1257990601', '7000000233', '7000002292',
                         '7000000275', '7010002892', '7010003858',
                         '7000002192', '7010001860', '1030853870003',
                         '7010002264', '1030751960003', '1015575300005',
                         '7000000220', '7000000077', '7000001691',
                         '1015814810002', '7010002496', '1030790910003',
                         '7000000075', '7000001309', '1013861100004',
                         '7000001817', '1014312700008', '7000000188',
                         '7010001969', '7010003882', '7000000290',
                         '7010000904', '7010004674', '7010004583',
                         '7000001633', '1016369110003', '7010004476',
                         '1013122600007', '7010004807', '1030408210003',
                         '7010004625', '7010006372', '7010003262',
                         '7000000542', '7000000516', '7000000415',
                         '7010006695', '7000000399', '7010006109',
                         '1017652600005', '7010004450', '1030720840002',
                         '7000002140', '7000000506', '1011903510008',
                         '7010003346', '1014848200023', '7000000217',
                         '7010002959', '7010003148', '7010003437',
                         '1030144360006', '7000000347', '1030883060003',
                         '7010007321', '7010006794', '1030878740003',
                         '7010007578', '7010003676', '7010005697',
                         '7010005721', '7010006505', '1030888430002',
                         '7010001332', '7010004849', '7010003494',
                         '7000000419', '1030886390003', '7010007529',
                         '1030853920003', '1030880750002', '1030890090003',
                         '7010006935', '7000000575', '7000000379',
                         '7000000478' )


SELECT DISTINCT DOMAIN_CD FROM dbo.REF_CODE WHERE DOMAIN_CD LIKE 'RequiredCoverage%'