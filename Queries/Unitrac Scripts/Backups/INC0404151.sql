USE [UniTrac]
GO 

--Loan Screen Information - LOAN/COLLATERAL/PROPERTY/OWNER/REQUIRED COVERAGE
SELECT OL.OWNER_TYPE_CD, O.*
into UnitracHDStorage..INC0404151
FROM LOAN L
INNER JOIN COLLATERAL C ON L.ID = C.LOAN_ID
INNER JOIN PROPERTY P ON C.PROPERTY_ID = P.ID
INNER JOIN REQUIRED_COVERAGE RC ON P.ID = RC.PROPERTY_ID
INNER JOIN OWNER_LOAN_RELATE OL ON L.ID = OL.LOAN_ID
INNER JOIN OWNER O ON OL.OWNER_ID = O.ID
INNER JOIN OWNER_ADDRESS OA ON O.ADDRESS_ID = OA.ID
INNER JOIN dbo.LENDER LL ON LL.ID = L.LENDER_ID
WHERE LL.CODE_TX IN ('0108') AND OL.OWNER_TYPE_CD = 'CB' and L.NUMBER_TX IN ('120170492',
'12199180',
'131462065',
'131927573',
'132065694',
'136273260',
'300170501',
'300172801',
'300172802',
'300773976',
'301472858',
'301473295',
'301821900',
'302070292',
'302072864',
'305872311',
'305872414',
'305872437',
'305872592',
'305872600',
'305872621',
'305872642',
'305872774',
'305872792',
'305872989',
'3061729707',
'306173731',
'306272907',
'306272916',
'306272920',
'306273001',
'306273002',
'306273003',
'306273004',
'306273028',
'320170527',
'320172807',
'320172856',
'320270423',
'320322650',
'320466323',
'320470461',
'320470565',
'320566500',
'320770573',
'321115376',
'321170522',
'321466445',
'321472306',
'321472613',
'321472806',
'321473232',
'321818879',
'321825503',
'321826132',
'321918895',
'321970466',
'322072144',
'322072308',
'322072762',
'322073098',
'325872811',
'325873220',
'325873226',
'325873975',
'326173304',
'326173581',
'326173746',
'326173992',
'326272909',
'326272910',
'326272911',
'326272913',
'326272917',
'326272921',
'326272923',
'326272994',
'326272996',
'326272998',
'326273016',
'326273018',
'326273020',
'326273021',
'326273033',
'326273038',
'326273040',
'326273787',
'328171711',
'330166321',
'330166349',
'330172303',
'330172402',
'330172419',
'330172583',
'330172693',
'330172700',
'330172771',
'330172873',
'330228596',
'330228606',
'330232318',
'330266596',
'330270366',
'330319642',
'330330624',
'330330680',
'330334380',
'330370240',
'330370315',
'330372310',
'330436411',
'330436468',
'330436480',
'330445004',
'330445027',
'330462194',
'330464636',
'330464650',
'330464664',
'330466515',
'330466538',
'330472135',
'330770361',
'330770436',
'331170209',
'331170397',
'331170427',
'331424670',
'331429121',
'331429148',
'331445099',
'331462223',
'331470229',
'331470301',
'331470354',
'331472313',
'331472401',
'331472403',
'331472442',
'331472443',
'331473109',
'331473730',
'331818878',
'331866397',
'331925483',
'331929620',
'331930695',
'331932302',
'331932317',
'331932701',
'331934321',
'331966562',
'331966569',
'331966624',
'331970385',
'332034349',
'332062195',
'332066350',
'332066351',
'332066414',
'332066629',
'332070213',
'332070294',
'332070377',
'332070406',
'332070443',
'332072145',
'332073075',
'335872400',
'335872404',
'335872409',
'335872411',
'335872412',
'335872413',
'335872416',
'335872425',
'335872432',
'335872433',
'335872436',
'335872440',
'335872455',
'335872578',
'335872584',
'335872587',
'335872589',
'335872593',
'335872595',
'335872597',
'335872609',
'335872618',
'335872628',
'335872631',
'335872632',
'335872637',
'335872638',
'335872639',
'335872692',
'335872694',
'335872704',
'335872706',
'335872708',
'335872710',
'335872761',
'335872772',
'335872785',
'335872787',
'335872790',
'335872793',
'335872803',
'335872859',
'335872861',
'335872875',
'335872881',
'335872961',
'335872962',
'335872965',
'335872974',
'335872986',
'335872987',
'335872988',
'335873068',
'335873088',
'335873089',
'335873094',
'335873112',
'335873117',
'335873128',
'335873130',
'335873212',
'335873221',
'335873279',
'335873285',
'335873286',
'335873420',
'335873421',
'335873427',
'335873434',
'335873439',
'335873440',
'335873443',
'335873444',
'335873558',
'335873571',
'335873573',
'335873759',
'335873762',
'335873763',
'335873985',
'335873989',
'335972860',
'335973081',
'335973211',
'335973217',
'335973574',
'335973583',
'335973584',
'335973585',
'335973586',
'335973732',
'336172150',
'336172151',
'336172626',
'336172643',
'336172690',
'336172754',
'336172805',
'336172855',
'336172857',
'336172863',
'336172865',
'336172869',
'336172872',
'336172967',
'336172971',
'336172972',
'336172982',
'336172990',
'336173082',
'336173096',
'336173204',
'336173205',
'336173222',
'336173275',
'336173281',
'336173282',
'336173284',
'336173296',
'336173300',
'336173306',
'336173308',
'336173415',
'336173579',
'336173982',
'336173983',
'336173986',
'336272253',
'336272254',
'336272338',
'336272341',
'336272342',
'336272343',
'336272348',
'336272349',
'336272352',
'336272357',
'336272372',
'336272379',
'336272522',
'336272523',
'336272524',
'336272529',
'336272534',
'336272535',
'336272570',
'336272715',
'336272717',
'336272732',
'336272743',
'336272746',
'336272747',
'336272751',
'336272757',
'336272758',
'336272836',
'336272842',
'336272845',
'336272846',
'336272894',
'336272902',
'336272903',
'336273050',
'336273150',
'336273151',
'336273153',
'336273155',
'336273160',
'336273239',
'336273251',
'336273252',
'336273259',
'336273264',
'336273265',
'336273266',
'336273267',
'336273268',
'336273269',
'336273270',
'336273273',
'336273313',
'336273314',
'336273315',
'336273316',
'336273318',
'336273320',
'336273321',
'336273322',
'336273326',
'336273327',
'336273330',
'336273334',
'336273338',
'336273364',
'336273389',
'336273390',
'336273393',
'336273394',
'336273395',
'336273449',
'336273453',
'336273454',
'336273455',
'336273456',
'336273458',
'336273462',
'336273463',
'336273464',
'336273465',
'336273474',
'336273483',
'336273494',
'336273495',
'336273498',
'336273499',
'336273501',
'336273506',
'336273508',
'336273509',
'336273512',
'336273513',
'336273515',
'336273516',
'336273517',
'336273519',
'336273520',
'336273521',
'336273522',
'336273524',
'336273525',
'336273526',
'336273527',
'336273530',
'336273531',
'336273532',
'336273533',
'336273534',
'336273542',
'336273596',
'336273598',
'336273599',
'336273600',
'336273601',
'336273603',
'336273604',
'336273605',
'336273606',
'336273607',
'336273609',
'336273611',
'336273612',
'336273614',
'336273616',
'336273617',
'336273618',
'336273625',
'336273627',
'336273632',
'336273633',
'336273635',
'336273636',
'336273637',
'336273638',
'336273639',
'336273643',
'336273644',
'336273645',
'336273646',
'336273647',
'336273648',
'336273668',
'336273671',
'336273677',
'336273678',
'336273681',
'336273683',
'336273689',
'336273764',
'336273765',
'336273766',
'336273767',
'336273773',
'336273774',
'336273776',
'336273798',
'336273799',
'336273855',
'336273884',
'336273885',
'336273901',
'336273902',
'336273903',
'336273909',
'336273911',
'336273924',
'336273935',
'336273936',
'336273937',
'336273938',
'336273941',
'336273943',
'336273944',
'336273946',
'336273948',
'336273949',
'336273950',
'336273951',
'336273952',
'336273953',
'336273955',
'336273957',
'336273958',
'336273960',
'336273961',
'336273962',
'336273965',
'336274010',
'336274011',
'336274014',
'336274015',
'338171539',
'338171572',
'338171688',
'338171689',
'338171694',
'338171719',
'338171720',
'338171723',
'338171724',
'338171729',
'338171732',
'338171734',
'338171738',
'338171739',
'338171742',
'338171743',
'338171753',
'338171754',
'338171765',
'338171766',
'338171769',
'338171770',
'338171771',
'338171780',
'338171784',
'338171785',
'338171786',
'338171788',
'338171790',
'338171791',
'338171792',
'338171793',
'338171830',
'338171858',
'338172012',
'338172023',
'338172086',
'338172158',
'338172185',
'338172230',
'338172231',
'338172237',
'338172238',
'338470557',
'338472119',
'338472130',
'338472131',
'338472132',
'338472133',
'338472142',
'360166241',
'360170532',
'360173283',
'360445103',
'360462180',
'360466504',
'360470242',
'360470251',
'360470270',
'360470355',
'360470441',
'360470480',
'360527816',
'361120670',
'361166514',
'361462251',
'361470411',
'361921149',
'361928046',
'361929152',
'36199191',
'362023665',
'362031823',
'362070444',
'365873208',
'365873219',
'366172969',
'366172991',
'366173100',
'366173105',
'366173118',
'366173213',
'366173277',
'366173289',
'366272555',
'366272556',
'366272559',
'366272563',
'366272565',
'366272571',
'366272737',
'366272844',
'366272895',
'366273030',
'366273400',
'366273403',
'366273404',
'366273405',
'366273406',
'366273481',
'366273482',
'366273551',
'366273591',
'366273654',
'366273664',
'366273665',
'366273667',
'366273679',
'366273803',
'366273807',
'366273809',
'366273810',
'366273811',
'366273812',
'366273819',
'366273820',
'366273824',
'366273825',
'366273826',
'366273827',
'366273828',
'366273830',
'366273832',
'366273833',
'366273834',
'366273835',
'366273839',
'366273840',
'366273841',
'366273848',
'366273849',
'366273850',
'366273851',
'366273854',
'366273859',
'366273888',
'366273908',
'366274016',
'366274017',
'368171550',
'368171722',
'368171829',
'368172103',
'368172107',
'368172108',
'390172870',
'390172879',
'390470515',
'390772148',
'390772318',
'392073093',
'395872973',
'395872979',
'395873070',
'395873080',
'395873097',
'395873115',
'395873123',
'395873209',
'395873229',
'395873233',
'395873235',
'395873236',
'395873445',
'395873564',
'395873572',
'395873578',
'395873735',
'395873736',
'395873739',
'395873743',
'395873756',
'395873758',
'395973568',
'396172152',
'396172316',
'396172462',
'396172466',
'396172831',
'396173101',
'396173107',
'396173120',
'396173121',
'396173218',
'396173237',
'396173274',
'396173288',
'396173294',
'396173301',
'396173422',
'396173423',
'3961734232',
'396173438',
'396173446',
'396173447',
'396173560',
'396173561',
'396173562',
'396173563',
'396173566',
'396173737',
'396173747',
'396173748',
'396173749',
'396173750',
'396173751',
'396173974',
'396173978',
'396173990',
'396173995',
'396272241',
'396272242',
'396272243',
'396272248',
'396272355',
'396272362',
'396272370',
'396272380',
'396272506',
'396272508',
'396272509',
'396272536',
'396272537',
'396272546',
'396272566',
'396272714',
'396272719',
'396272720',
'396272722',
'396272834',
'396272892',
'396273005',
'396273019',
'396273031',
'396273034',
'396273039',
'396273139',
'396273142',
'396273162',
'396273163',
'396273166',
'396273186',
'396273191',
'396273201',
'396273246',
'396273311',
'396273319',
'396273323',
'396273343',
'396273344',
'396273382',
'396273388',
'396273391',
'396273392',
'396273408',
'396273457',
'396273471',
'396273473',
'396273475',
'396273476',
'396273478',
'396273479',
'396273486',
'396273487',
'396273488',
'396273492',
'396273500',
'396273504',
'396273507',
'396273514',
'396273528',
'396273536',
'396273544',
'396273548',
'396273595',
'396273602',
'396273608',
'396273641',
'396273642',
'396273663',
'396273670',
'396273682',
'396273769',
'396273770',
'396273781',
'396273815',
'396273880',
'396273898',
'396273899',
'396273900',
'396273904',
'396273905',
'396273928',
'396273929',
'396273930',
'396273931',
'396273940',
'396273942',
'396273947',
'396273956',
'396273966',
'396273971',
'396274013',
'396274018',
'396274020',
'396274021',
'398171529',
'398171536',
'398171537',
'398171564',
'398171691',
'398171810',
'398171829',
'398171833',
'398171904',
'398172027',
'398172029',
'398172065',
'398172073',
'398172186',
'398172187',
'398172188',
'398172224',
'398172225',
'398172233',
'398470517',
'400266601',
'400334325',
'40117320',
'40119170',
'401433422',
'401473429',
'401473979',
'401933463',
'405872312',
'405872328',
'405872596',
'405872963',
'405872978',
'405873069',
'405873090',
'405873095',
'406172981',
'411415964',
'411911904',
'4203663781',
'420772295',
'421170546',
'421470324',
'4219318134',
'4219318135',
'431134335',
'431473729',
'431973997',
'432072622',
'435872405',
'435872786',
'435872791',
'435872794',
'436173582',
'491173988',
'491473293',
'500134',
'7410324')
--6881


SELECT O.ID as Owner_ID, O.ADDRESS_ID as Owner_Address_Id, OL.ID as Owner_Relate_Id
into #tmpOwner
FROM LOAN L
INNER JOIN COLLATERAL C ON L.ID = C.LOAN_ID
INNER JOIN PROPERTY P ON C.PROPERTY_ID = P.ID
INNER JOIN REQUIRED_COVERAGE RC ON P.ID = RC.PROPERTY_ID
INNER JOIN OWNER_LOAN_RELATE OL ON L.ID = OL.LOAN_ID
INNER JOIN OWNER O ON OL.OWNER_ID = O.ID
INNER JOIN OWNER_ADDRESS OA ON O.ADDRESS_ID = OA.ID
INNER JOIN dbo.LENDER LL ON LL.ID = L.LENDER_ID
WHERE O.ID IN (select id from UnitracHDStorage..INC040415)


update O 
set purge_dt = GETDATE(), update_dt = GETDATE(), update_user_tx = 'INC0404151', LOCK_ID = CASE WHEN LOCK_ID >= 255 THEN 1 ELSE LOCK_ID + 1 END
from OWNER O
where O.ID IN (select Owner_ID from #tmpOwner) 


update OA
set purge_dt = GETDATE(), update_dt = GETDATE(), update_user_tx = 'INC0404151', LOCK_ID = CASE WHEN LOCK_ID >= 255 THEN 1 ELSE LOCK_ID + 1 END
from OWNER_ADDRESS OA
where OA.ID IN (select Owner_Address_Id from #tmpOwner) 


update OL
set purge_dt = GETDATE(), update_dt = GETDATE(), update_user_tx = 'INC0404151', LOCK_ID = CASE WHEN LOCK_ID >= 255 THEN 1 ELSE LOCK_ID + 1 END
from OWNER_LOAN_RELATE OL
where OL.ID IN (select Owner_Relate_Id from #tmpOwner) 