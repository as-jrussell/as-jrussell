USE UniTrac

--INC0253026
--Finding WI via Number
SELECT CONTENT_XML.value('(/Content/Lender/Code)[1]', 'varchar (50)') Lender,
CONTENT_XML.value('(/Content/Message/MessageId)[1]', 'varchar (50)') MessageID,
 WD.NAME_TX [Definition], 
WQ.NAME_TX [Queue], WI.*
FROM  WORK_ITEM WI
INNER JOIN dbo.WORKFLOW_DEFINITION WD ON WD.ID = WI.WORKFLOW_DEFINITION_ID
INNER JOIN dbo.WORK_QUEUE WQ ON WQ.ID = WI.CURRENT_QUEUE_ID
WHERE WI.ID IN (34611168 , 34634694, 34620679    )



--Finding WI via CODE_TX
----REPLACE #### WITH THE THE Lender ID
SELECT CONTENT_XML.value('(/Content/Lender/Code)[1]', 'varchar (50)') Lender, WD.NAME_TX [Definition], 
WQ.NAME_TX [Queue], WI.*
FROM  WORK_ITEM WI
INNER JOIN dbo.WORKFLOW_DEFINITION WD ON WD.ID = WI.WORKFLOW_DEFINITION_ID
INNER JOIN dbo.WORK_QUEUE WQ ON WQ.ID = WI.CURRENT_QUEUE_ID
WHERE WI.CONTENT_XML.value('(/Content/Lender/Code)[1]', 'varchar (50)') IN ('XXXX' , 'XXXX', 'XXXX')
AND WI.STATUS_CD NOT IN ('Complete' ,'Withdrawn' ,'ImportCompleted')
AND WI.WORKFLOW_DEFINITION_ID = 'X'



--Process Log ID


SELECT * FROM dbo.PROCESS_LOG_ITEM
WHERE PROCESS_LOG_ID IN (38392399,
38404924,
38420582) AND RELATE_TYPE_CD = 'Allied.UniTrac.ReportHistory'



= '38392399'ORDER BY RELATE_TYPE_CD ASC



SELECT * FROM dbo.WORK_QUEUE W
JOIN dbo.WORK_QUEUE_WORK_ITEM_RELATE WW ON WW.WORK_QUEUE_ID = W.ID
WHERE W.WORKFLOW_DEFINITION_ID = '9'


SELECT * FROM dbo.REPORT_HISTORY
WHERE ID IN
(SELECT RELATE_ID FROM dbo.PROCESS_LOG_ITEM
WHERE PROCESS_LOG_ID IN (38392399,
38404924,
38420582) AND RELATE_TYPE_CD = 'Allied.UniTrac.ReportHistory')


SELECT * FROM dbo.ESCROW
WHERE ID IN (SELECT RELATE_ID FROM dbo.PROCESS_LOG_ITEM
WHERE PROCESS_LOG_ID IN (38392399,
38404924,
38420582) AND RELATE_TYPE_CD = 'Allied.UniTrac.Escrow')


SELECT * FROM dbo.MESSAGE
WHERE ID = '6271096'


SELECT * FROM dbo.TRADING_PARTNER_LOG
WHERE MESSAGE_ID = '6271096'




SELECT * FROM dbo.WORK_ITEM
WHERE ID = '34620679'

SELECT * FROM dbo.PROCESS_LOG_ITEM
WHERE PROCESS_LOG_ID = '38404924'

UPDATE dbo.MESSAGE 
SET RECEIVED_STATUS_CD = 'RCVD', PROCESSED_IN = 'N', LOCK_ID = LOCK_ID+1,
UPDATE_DT = GETDATE(), UPDATE_USER_TX = 'INC0253026'
--SELECT * FROM dbo.MESSAGE
WHERE ID IN (6278959)

 6271096,6276709)


SELECT * FROM dbo.MESSAGE
WHERE ID IN (6271096,6276709,6278959)


SELECT * FROM dbo.TRADING_PARTNER_LOG
WHERE MESSAGE_ID = '6276709'

SELECT * FROM dbo.DOCUMENT
WHERE id = '15337735'

SELECT * FROM dbo.[TRANSACTION]
WHERE DOCUMENT_ID = '15337735'


SELECT * FROM dbo.DELIVERY_INFO_GROUP
WHERE ID = '5740'

--ESC-2250.34620679-20161019065551.txt

SELECT * FROM dbo.DELIVERY_INFO
WHERE ID = '3662'

SELECT * FROM dbo.PREPROCESSING_DETAIL
WHERE DELIVERY_INFO_GROUP_ID  = '5740'


UPDATE dbo.PREPROCESSING_DETAIL
SET PURGE_DT = '2016-06-28 07:19:54.190'
--SELECT * FROM dbo.PREPROCESSING_DETAIL
WHERE ID = '7216'
--2016-06-28 07:19:54.190

UPDATE dbo.PPDATTRIBUTE
SET PURGE_DT = NULL
WHERE PREPROCESSING_DETAIL_ID = '7216'


--2016-06-28 07:19:54.6100000 - 11314
--2016-06-28 07:19:54.9070000 - 14854
--2016-06-28 07:19:54.9070000 - 14855

UPDATE dbo.PPDATTRIBUTE
SET PURGE_DT = '2016-06-28 07:19:54.9070000'
--SELECT * FROM dbo.PPDATTRIBUTE
WHERE PREPROCESSING_DETAIL_ID = '7216'
--2016-06-28 07:19:54.190

SELECT * FROM dbo.COMMON_STYLESHEET
WHERE ID = '54'

Exception Transforming the Documents
Exception : Exception occurred for XSLT Pre Processing for Doc Id : 15337735
Exception Message : Unable to load one or more of the requested types. Retrieve the LoaderExceptions property for more information.

Exception Stack Trace :    at Allied.UniTrac.LenderExtract.BackFeed.EscrowBillPPD.Apply(Document document) in E:\Unitrac_QA_2.1\3 Upper Business Level\UniTracLib\LenderExtract\BackFeed\EscrowBillPPD.cs:line 200
   at LDHLib.Document.Transform(Boolean ignoreSettingTransformationStatus, Boolean processDJ, BusinessObjectCollection boColl) in E:\Unitrac_QA_2.1\3 Upper Business Level\LDH\LDHLib\Message\Document.cs:line 466
   at LDHLib.Message.Transform() in E:\Unitrac_QA_2.1\3 Upper Business Level\LDH\LDHLib\Message\Message.cs:line 1176


   SELECT * FROM dbo.TRADING_PARTNER
   WHERE ID = '1201'