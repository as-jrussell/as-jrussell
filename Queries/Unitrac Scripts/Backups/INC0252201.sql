USE UniTrac


--Finding WI via Number
SELECT CONTENT_XML.value('(/Content/Lender/Code)[1]', 'varchar (50)') Lender, WD.NAME_TX [Definition], 
WQ.NAME_TX [Queue], WI.*
FROM  WORK_ITEM WI
INNER JOIN dbo.WORKFLOW_DEFINITION WD ON WD.ID = WI.WORKFLOW_DEFINITION_ID
INNER JOIN dbo.WORK_QUEUE WQ ON WQ.ID = WI.CURRENT_QUEUE_ID
WHERE WI.ID IN (34495507)

SELECT * FROM dbo.PROCESS_LOG
WHERE ID IN (38221611,38227313)


--Process Log ID


SELECT L.ID, PLI.RELATE_ID
--INTO #tmp
 FROM dbo.PROCESS_LOG_ITEM PLI
JOIN dbo.LOAN L ON PLI.RELATE_ID = L.ID
JOIN dbo.COLLATERAL C ON C.LOAN_ID = L.ID
JOIN dbo.PROPERTY P ON P.ID = C.PROPERTY_ID
WHERE PLI.PROCESS_LOG_ID IN (38221611, 38227313)
AND RELATE_ID = '172283049'

SELECT C.* FROM dbo.LOAN L 
JOIN dbo.COLLATERAL C ON C.LOAN_ID = L.ID
JOIN dbo.PROPERTY P ON P.ID = C.PROPERTY_ID
JOIN dbo.REQUIRED_COVERAGE RC ON RC.PROPERTY_ID = P.ID
WHERE L.NUMBER_TX = '5304915456'  

UPDATE dbo.COLLATERAL
SET PRIMARY_LOAN_IN = 'N'
--SELECT * FROM dbo.COLLATERAL
WHERE ID IN (147786215,
146475319)


--145667518
----146289790
---144988066

SELECT * FROM dbo.PROPERTY
WHERE id IN (144988066,
146289790)




SELECT * FROM dbo.WORK_QUEUE W
JOIN dbo.WORK_QUEUE_WORK_ITEM_RELATE WW ON WW.WORK_QUEUE_ID = W.ID
WHERE W.WORKFLOW_DEFINITION_ID = '9'




SELECT L.* --INTO UniTracHDStorage..INC0252201_L
FROM dbo.LOAN L 
JOIN dbo.COLLATERAL C ON C.LOAN_ID = L.ID
JOIN dbo.PROPERTY P ON P.ID = C.PROPERTY_ID
JOIN dbo.REQUIRED_COVERAGE RC ON RC.PROPERTY_ID = P.ID
WHERE L.NUMBER_TX = '5304915456' 


SELECT C.* --INTO UniTracHDStorage..INC0252201_C
 FROM dbo.LOAN L 
JOIN dbo.COLLATERAL C ON C.LOAN_ID = L.ID
JOIN dbo.PROPERTY P ON P.ID = C.PROPERTY_ID
JOIN dbo.REQUIRED_COVERAGE RC ON RC.PROPERTY_ID = P.ID
WHERE L.NUMBER_TX = '5304915456' 


SELECT P.* --INTO UniTracHDStorage..INC0252201_P
FROM dbo.LOAN L 
JOIN dbo.COLLATERAL C ON C.LOAN_ID = L.ID
JOIN dbo.PROPERTY P ON P.ID = C.PROPERTY_ID
JOIN dbo.REQUIRED_COVERAGE RC ON RC.PROPERTY_ID = P.ID
WHERE L.NUMBER_TX = '5304915456' 

SELECT RC.* -- INTO UniTracHDStorage..INC0252201_RC
FROM dbo.LOAN L 
JOIN dbo.COLLATERAL C ON C.LOAN_ID = L.ID
JOIN dbo.PROPERTY P ON P.ID = C.PROPERTY_ID
JOIN dbo.REQUIRED_COVERAGE RC ON RC.PROPERTY_ID = P.ID
WHERE L.NUMBER_TX = '5304915456' 


SELECT * FROM UniTracHDStorage..INC0252201_C


UPDATE L
SET DIVISION_CODE_TX = LL.DIVISION_CODE_TX, UPDATE_USER_TX = LL.UPDATE_USER_TX
--SELECT * 
FROM  dbo.LOAN L
JOIN UniTracHDStorage..INC0252201_L LL ON LL.ID = L.ID


UPDATE C SET PURGE_DT = CC.PURGE_DT, UPDATE_USER_TX = CC.UPDATE_USER_TX, COLLATERAL_CODE_ID = CC.COLLATERAL_CODE_ID,
PRIMARY_LOAN_IN =CC.PRIMARY_LOAN_IN, LOAN_BALANCE_NO = CC.LOAN_BALANCE_NO, LOAN_PERCENTAGE_NO = CC.LOAN_PERCENTAGE_NO
--SELECT * 
FROM dbo.COLLATERAL C 
JOIN UniTracHDStorage..INC0252201_C CC ON CC.ID = C.ID


UPDATE dbo.PROPERTY
SET PURGE_DT = NULL
WHERE ID IN (146289790,
144988066)


SELECT * FROM dbo.COLLATERAL
WHERE PROPERTY_ID IN (145667518,
146289790,
144988066,
146767886,
147077615) AND PURGE_DT IS NULL

SELECT * FROM dbo.PROPERTY
WHERE ID IN (146289790,
146767886,
147077615)

---147077615
SELECT * FROM dbo.REQUIRED_COVERAGE
WHERE PROPERTY_ID IN  (146289790,
146767886,
147077615)


UPDATE dbo.REQUIRED_COVERAGE
SET TYPE_CD = ''
SELECT * FROM dbo.LOAN
WHERE ID IN (174067736,
174376323, 172283049)


UPDATE dbo.COLLATERAL
SET PURGE_DT = GETDATE()
--SELECT * FROM dbo.COLLATERAL
WHERE ID IN (146475319,
147160268)


UPDATE dbo.COLLATERAL
SET PURGE_DT = NULL 
--SELECT * FROM dbo.COLLATERAL
WHERE ID IN 
(147786215,
148268688,
148581316)

SELECT * FROM 


UPDATE dbo.COLLATERAL
SET COLLATERAL_CODE_ID = '437', LENDER_COLLATERAL_CODE_TX = 'EQUP'
WHERE ID = '148581316'



(148268688,
148581316)





SELECT rc.PURGE_DT, L.DIVISION_CODE_TX, L.BRANCH_CODE_TX, L.LENDER_BRANCH_CODE_TX, c.COLLATERAL_CODE_ID, c.LENDER_COLLATERAL_CODE_TX,*
FROM dbo.LOAN L 
JOIN dbo.COLLATERAL C ON C.LOAN_ID = L.ID
JOIN dbo.PROPERTY P ON P.ID = C.PROPERTY_ID
JOIN dbo.REQUIRED_COVERAGE RC ON RC.PROPERTY_ID = P.ID
WHERE L.NUMBER_TX = '5304915456' AND c.PURGE_DT IS NULL



SELECT * FROM dbo.LENDER
WHERE CODE_TX = '3067'

SELECT * FROM dbo.COLLATERAL_CODE
WHERE ID IN (437, 512)


SELECT * FROM dbo.PROCESS_DEFINITION
WHERE UPDATE_USER_TX = 'UBSPRT'
AND PROCESS_TYPE_CD = 'FULFILLPRC'


SELECT * FROM dbo.PROCESS_LOG
WHERE PROCESS_DEFINITION_ID IN (51,144380)
AND UPDATE_DT >= '2016-10-20 15:25 '


SELECT * FROM dbo.LOAN
WHERE NUMBER_TX = '5304915456'

SELECT * FROM dbo.COLLATERAL
WHERE LOAN_ID IN (172283049,
174067736,
174376323) AND PURGE_DT IS NULL 
ORDER BY PROPERTY_ID ASC 