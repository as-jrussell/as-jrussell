USE UniTrac

--Reset Queries---

--1) Obtain IDs for all EDI Trading Partners
SELECT ID into #tmpTP
FROM TRADING_PARTNER
WHERE TYPE_CD = 'EDI_TP'

--2) Obtain all EDI Messages from Trading Partner Log (based on Date)
--Can add in Error withc ommented out section, if necessary
SELECT RELATE_ID_TX INTO #tmpMSG
FROM   dbo.MESSAGE
WHERE  ID IN ( 10164003, 10268452, 10308768, 10320552, 10566828, 10567031 ,
               10664128 ,10784138, 10787447, 10850593, 11381177, 11563336 ,
               11565152 ,11622652, 11627941, 11796948, 11805816, 12192274 ,
               12195725 ,9425746, 9542766, 9724985, 9728291, 10593636 ,
               10914263 ,11005484, 11086400, 11449313, 11449427, 11642225 ,
               11810408 ,11922408, 11924081, 11927841, 11983744, 12063695 ,
               9251827 ,9259509, 9364034, 9365698, 9548235, 9882966, 10643705 ,
               10644995 ,10931528, 11245304, 11245305, 11249905, 11251238 ,
               11253040 ,11253212, 11253430, 11779469, 11780795, 11955352 ,
               12105302 ,12110495, 9527416, 9530578, 9899395, 10147914 ,
               10148146 ,10686354, 10688064, 10835430, 10836810, 10838485 ,
               10838925 ,11139710, 11139827, 11356563, 11356562, 11469380 ,
               11470704 ,11935984, 11995659, 12083066, 12084618, 12166967 ,
               9267905 ,9269646, 9383225, 9389663, 9757851, 9763825, 10055598 ,
               10237254 ,10547352, 10550037, 11069581, 11070413, 11177747 ,
               11346504 ,11347478, 11350538, 11512087, 11515842, 11680744 ,
               11686478 ,11836942, 12026649, 9213559, 9222596, 9448796 ,
               9708343 ,10135174, 10326821, 10459166, 10470698, 10728881 ,
               11284575 ,11657077, 11657250, 11661593, 11664170, 11898377 ,
               11903448 ,12197964, 12204730, 9491745, 9493310, 9843611 ,
               9847119 ,9847156, 10025076, 10099512, 10213614, 10218620 ,
               11705081 ,11735281, 10339292, 10492106, 10492234, 10634191 ,
               10749229 ,10750130, 10806754, 10901992, 11219021, 11406706 ,
               11408760 ,11489102, 11759694, 11845207, 11847224, 11941477 ,
               11952392 ,11998018, 12094408, 12094481, 12174851, 12179945 ,
               12185263 ,9194497, 9413483, 9600279, 10367018, 10514278 ,
               11210442 ,11313237, 11393815, 11395872, 11396691, 11498424 ,
               11498898 ,11699175, 11860513, 11966003, 11968932, 11969521 ,
               12045694 ,12046738, 12052279, 12158489, 9584549, 10273533 ,
               10658337 ,10714753, 10783123, 10958834, 10964486, 10967881 ,
               11021336 ,11109080, 11379781, 11383341, 11383904, 11384105 ,
               11473037 ,11565077, 11626305, 11704146, 11870265, 11886373 ,
               12125168 ,12191208, 12125449, 12185686, 12191177, 12192101 ,
               12195143 ,10590591, 10594476, 10609712, 10609874, 11005642 ,
               11192139 ,11370458, 11559732, 11723158, 11922406, 11976560 ,
               11982013 ,11982442, 11983759, 12062708, 12063248, 12144846 ,
               11245618 ,11250566, 11254192, 11595630, 11953448, 12110261 ,
               10138261 ,10187553, 10193667, 10432861, 10947584, 10956736 ,
               11138276 ,11187810, 11275729, 11278051, 11364522, 11365186 ,
               11649355 ,11735276, 11930135, 11936808, 11937830, 12167406 ,
               12168104 ,12171005, 12191209, 9179955, 9379600, 9660304 ,
               10545731 ,11071537, 11168233, 11346505, 11515178, 11839113 ,
               11842170 ,11843782, 11912446, 11915460, 12023734, 12128307 ,
               12130114 ,12130586, 12136450, 9213757, 9452749, 9458995 ,
               9706620 ,9795887, 9800267, 9937160, 10133818, 10223276 ,
               10458296 ,10459982, 10719135, 10729464, 10875196, 10875215 ,
               11060134 ,11156352, 11420705, 11752742, 11755261, 11902749 ,
               11903441 ,12076906, 12079522, 12199611, 12201279, 9492685 ,
               9615282 ,10029419, 10100436, 10631464, 10701351, 10702218 ,
               10744000 ,10806763, 10903822, 11143420, 11218173, 11219993 ,
               11321866 ,11586666, 11944453, 11947094, 11952756, 11998167 ,
               12000528 ,12001500, 12094619, 12175189, 12175427, 12180085 ,
               9309198 ,9415594, 9515849, 9612947, 9614209, 9791137, 9912320 ,
               9912328 ,10037013, 10118186, 10834854, 10997339, 11210443 ,
               11210871 ,11396173, 11498914, 11614610, 11698984, 11789687 ,
               11965264 ,11968918, 11969079, 11969487, 12053086, 12154105 ,
               10155328 ,10268539, 10396275, 10402866, 10424592, 10505535 ,
               10713573 ,10714777, 10717974, 10784280, 10854673, 10854837 ,
               10964892 ,10964897, 11387371, 11481876, 11561453, 11561687 ,
               11622376 ,11626587, 11884664, 11885163, 11886002, 12010273 ,
               12012550 ,12013449, 12018854, 12122947, 12124769, 12191207 ,
               9533074 ,9730240, 10914464, 11086193, 11303425, 11366933 ,
               11449595 ,11452323, 11556459, 11634854, 11634931, 11811217 ,
               11813401 ,11921244, 11982935, 11983087, 12060943, 12062316 ,
               12148684 ,9364134, 9672187, 10648797, 11245234, 11245267 ,
               11245268 ,11246152, 11595440, 11600658, 11963882, 12105864 ,
               12110263 ,12114585, 9330968, 10187780, 10300822, 10304304 ,
               10529587 ,10531211, 10682492, 10835308, 11029659, 11187723 ,
               11277036 ,11356220, 11363151, 11365245, 11469444, 11728462 ,
               11731205 ,11929952, 11930598, 11937996, 11987614, 12079984 ,
               12168998 ,9380663, 9389338, 10057488, 10060956, 10563399 ,
               10971256 ,11170363, 11345230, 11346018, 11434565, 11434780 ,
               11434788 ,11435434, 11436307, 11511708, 11511711, 11515204 ,
               11515217 ,11515303, 11522366, 11687955, 11688652, 11689735 ,
               11740375 ,12023581, 12128917, 12135490, 9223620, 9459566 ,
               9460395 ,11039482, 11161949, 11281713, 11290142, 11290757 ,
               11291361 ,11423804, 11659643, 11666009, 11750394, 11751737 ,
               11901829 ,12070523, 12071523, 12078949, 9627154, 9850699 ,
               10025214 ,10025212, 10027382, 10435959, 10491697, 10534415 ,
               10628017 ,10632916, 10701904, 10704685, 10744866, 10799608 ,
               10799628 ,10800024, 10989324, 11219495, 11408142, 11483346 ,
               11489291 ,11491529, 11671078, 11772329, 11947316, 11947805 ,
               11948866 ,11952835, 12094463, 12094462, 12100886, 12175093 ,
               12181250 ,12181260, 12181965, 9194443, 9310523, 9413225 ,
               9413623 ,9516820, 9702549, 9702559, 9702739, 9790789, 10115446 ,
               11201458 ,11312146, 11313211, 11397518, 11399718, 11496910 ,
               11965437 ,12045787, 12045829, 12047588, 12051905, 12053048 ,
               9588654 ,10076753, 10318176, 10394366, 10413005, 10500554 ,
               10714669 ,10714752, 11022848, 11383911, 11471227, 11561857 ,
               11570944 ,11805924, 11870453, 11872435, 11888901, 12013777 ,
               12019280 ,12019279, 12114855, 12123671, 12191203, 12124222 ,
               12191968 ,12195708, 9542762, 10595198, 11005548, 11303285 ,
               11366351 ,11449425, 11644876, 11716901, 11721839, 11722496 ,
               11922390 ,11924362, 11981844, 12063698, 12064949, 12066836 ,
               9373231 ,9373887, 9769993, 9874029, 11245306, 11245309 ,
               11252624 ,11253211, 11254916, 11447147, 11447308, 11779822 ,
               12105568 ,12107294, 12110494, 10074264, 10187621, 10471915 ,
               10472899 ,10473988, 10475619, 10949315, 10954281, 11139911 ,
               11184384 ,11278175, 11352748, 11356432, 11462294, 11466011 ,
               11536687 ,11732482, 11732778, 11831949, 11928513, 11930198 ,
               11935987 ,11936064, 11937802, 11989825, 11995120, 11995124 ,
               11995637 ,11995861, 11996117, 12083024, 12191197, 9269396 ,
               9379542 ,9383398, 9389179, 9658807, 9763826, 10353179 ,
               10362397 ,10545715, 10562336, 11063892, 11510561, 11515176 ,
               11522196 ,11909142, 12129794, 12136351, 9213558, 9452354 ,
               9453146 ,10048350, 10226779, 10731140, 11055625, 11287545 ,
               11664169 ,11664340, 11754094, 12076099, 12076595, 12078665 ,
               12197944 ,12198264, 9497112, 9850160, 9851603, 10099596 ,
               10339138 ,10441313, 10627943, 10630753, 10989303, 11214000 ,
               11322745 ,11484861, 11941201, 11946629, 11997783, 12094482 ,
               12094626 ,12100365, 9194487, 9309262, 9702509, 10033553 ,
               10118585 ,10255592, 10676007, 10997789, 10999340, 11210691 ,
               11308386 ,11313238, 11395873, 11396179, 11498423, 11499046 ,
               11609102 ,11699174, 11861144, 11972131, 12046288, 12158377 ,
               9584544 ,9588646, 9595258, 10150525, 10171354, 10500357 ,
               10566755 ,10660896, 10661006, 10957857, 10964922, 11027944 ,
               11112539 ,11120186, 11627693, 11702701, 11704805, 11796947 ,
               11800939 ,11800957, 11803306, 11881099, 12018758, 12019423 ,
               12192035 ,12195739, 12195732, 9428801, 9730247, 10817754 ,
               10822582 ,10915070, 11086158, 11195698, 11304412, 11375247 ,
               11554413 ,11559213, 11919412, 11924060, 12065402, 12144592 ,
               12144591 ,12145289, 12146011, 10646877, 10945179, 11245197 ,
               11254191 ,11594713, 11779242, 12103116, 9330353, 9530726 ,
               9907530 ,10193623, 10251331, 10614162, 10616568, 10682797 ,
               10838340 ,11037802, 11138275, 11187261, 11278589, 11356560 ,
               11365453 ,11819356, 11822759, 11930200, 11987616, 12082895 ,
               12167396 ,12167900, 12168093, 12168351, 12170960, 9658808 ,
               9763533 ,10104350, 10347411, 10362614, 10546840, 10548565 ,
               10561905 ,11345146, 11346534, 11352595, 11429947, 11430912 ,
               11431858 ,11434417, 11434791, 11511966, 11515162, 11522371 ,
               11683949 ,11688632, 11909385, 12130115, 9448798, 9562817 ,
               9795926 ,10131269, 10458295, 10580744, 10878265, 11156309 ,
               11290399 ,11290596, 11658245, 11897075, 11903442, 12070315 ,
               12070329 ,12072008, 12077112, 12078163, 12078990, 12197819 ,
               12197818 ,9332034, 9614921, 9622101, 9739453, 10625226 ,
               10695151 ,10901825, 10901991, 10988729, 10988738, 10993013 ,
               11142977 ,11219532, 11401806, 11590478, 11844377, 11997791 ,
               11998020 ,12001738, 12094306, 12097860, 12175181, 9413482 ,
               9413741 ,9515848, 9694685, 9702606, 9702635, 9915089, 9918080 ,
               10121701 ,10365737, 10998667, 11203246, 11313174, 11391876 ,
               11397522 ,11498704, 11701419, 11867231, 11965238, 11966312 ,
               11969078 ,11969488, 12051374, 12055453, 12158488, 12159891 ,
               10163883 ,10164009, 10166088, 10319914, 10402725, 10403839 ,
               10508988 ,10660553, 10714245, 10858424, 10957954, 11028079 ,
               11561918 ,11569907, 11627695, 11704804, 11884020, 11885156 ,
               12011976 ,12019538, 12114764, 12191232, 12195693, 9544250 ,
               10590786 ,10733573, 10818097, 10915450, 11013699, 11014370 ,
               11367119 ,11370574, 11448741, 11449542, 11717071, 11722697 ,
               11723408 ,11921246, 12063839, 12066834, 12144849, 12145268 ,
               9774289 ,10389731, 10643423, 10643681, 11106260, 11112782 ,
               11252904 ,11253210, 11773402, 11956198, 10187845, 10194960 ,
               10251671 ,10305975, 10839342, 10948913, 10956092, 10957456 ,
               11030894 ,11031259, 11185653, 11277047, 11356437, 11361920 ,
               11469195 ,11532026, 11533610, 11647197, 11649335, 11820424 ,
               11830346 ,11931070, 11935850, 11987330, 11989823, 11994249 ,
               12079969 ,12080257, 12167341, 12171109, 9477353, 9660397 ,
               10237068 ,10241488, 10347312, 10799609, 10978412, 11063937 ,
               11066243 ,11070490, 11172714, 11346528, 11434416, 11434789 ,
               11523711 ,11688634, 12023822, 12026961, 12128964, 9461243 ,
               9797322 ,9943182, 10132206, 10136257, 10321425, 10452427 ,
               10462635 ,10589273, 11156295, 11289423, 11664675, 11751769 ,
               12070308 ,12076901, 12077234, 12077574, 9622720, 9626352 ,
               9626316 ,10026475, 10026922, 10442804, 10492165, 10628690 ,
               10695171 ,10743994, 10904309, 10989292, 11145727, 11586618 ,
               11947319 ,11953290, 12090944, 12094444, 12094620, 12174715 ,
               12175090 ,9194496, 9309324, 9702607, 9702813, 9702891 ,
               10516500 ,10825410, 11204883, 11305531, 11863416, 11968922 ,
               11971699 ,11972040, 12046572, 12047344, 12052470, 12055122 ,
               12156359 ,12157821, 12159539, 10318003, 10402419, 10403054 ,
               10412767 ,10499231, 10568710, 10705969, 10706819, 10714641 ,
               10783112 ,10850557, 11023104, 11023106, 11383193, 11384252 ,
               11387368 ,11473060, 11481828, 11570093, 11702415, 11870266 ,
               11888516 ,11888949, 12114725, 12122631, 12186323, 12190403 ,
               12191175 ,12192502, 10607415, 10609907, 11006695, 11015348 ,
               11095461 ,11449200, 11449319, 11717517, 11721526, 11723159 ,
               11819023 ,11924280, 11979197, 11982324, 11982312, 11983754 ,
               12057699 ,12066701, 12145451, 9364007, 9671588, 9674345 ,
               9883559 ,10389359, 10645226, 11595474, 11598542, 11775295 ,
               11953498 ,11957469, 11964857, 12103996, 12105301, 12107417 ,
               12114702 ,12191198, 9530818, 10072593, 10187606, 10253923 ,
               10303980 ,11138180, 11186982, 11278161, 11352901, 11355050 ,
               11364526 ,11465284, 11469196, 11647198, 11989795, 11989824 ,
               11994760 ,11997362, 12079966, 12079968, 12083192, 12171110 ,
               9268397 ,9465297, 9966302, 10104458, 10239160, 10362689 ,
               10547169 ,10562810, 10970741, 11071382, 11347328, 11511561 ,
               11511710 ,11520074, 11683410, 12031133, 12041987, 12129915 ,
               12130033 ,9222851, 9226126, 9393198, 9453708, 9711479, 9795836 ,
               9797193 ,10219124, 10222949, 10321151, 10321172, 10859973 ,
               10879640 ,11281720, 11289747, 11758408, 11758409, 12069951 ,
               12071135 ,12071565, 12076891, 12201437, 9333619, 9336802 ,
               9736080 ,10027216, 10335407, 10337007, 10435994, 10630229 ,
               10744837 ,10749217, 11150298, 11151777, 11218495, 11219665 ,
               11318630 ,11318631, 11321122, 11409008, 11409298, 11409306 ,
               11845218 ,11952884, 11998164, 12094410, 12094443, 12094475 ,
               12094476 ,12094625, 12175331, 12179944, 12180084, 12185338 ,
               12191210 ,9310268, 9706435, 10120208, 10825783, 11204021 ,
               11204606 ,11210693, 11313167, 11389201, 11396178, 11498915 ,
               11789695 ,11790385, 11971695, 12046573, 12051882, 9588631 ,
               10154028 ,10267799, 10271577, 10507878, 10662193, 10662212 ,
               10662810 ,10786485, 10787852, 10854829, 10964858, 10967867 ,
               11384254 ,11707503, 11711337, 11870995, 11884970, 11886372 ,
               12012302 ,12012403, 12013192, 12013174, 12019424, 12185751 ,
               9419794 ,9543879, 9725227, 10590953, 10594949, 10607776 ,
               11195692 ,11449596, 11449593, 11557750, 11639164, 11642758 ,
               11724540 ,11811214, 11813383, 11981578, 11984072, 12145665 ,
               12147163 ,9367194, 9443375, 9445175, 9558898, 9874697, 9883858 ,
               10927921 ,10944250, 11245617, 11447551, 11953320, 11953431 ,
               11954355 ,11963093, 12104989, 12104909, 12105300, 12108134 ,
               9895880 ,9896416, 10072126, 10301436, 10302268, 10303780 ,
               10472891 ,10532756, 10682491, 10836012, 10957467, 11184439 ,
               11270306 ,11272048, 11276209, 11276699, 11356221, 11469446 ,
               11469445 ,11930011, 11930901, 11936746, 11936805, 11937025 ,
               11938092 ,11988348, 11996091, 12167925, 12171069, 9266670 ,
               9658828 ,10053546, 10057489, 10059259, 10105891, 10234316 ,
               10347331 ,10350044, 10362177, 10563528, 11346016, 11431988 ,
               11435605 ,11510888, 11511964, 11515203, 11740519, 11913260 ,
               12026441 ,9224587, 9707572, 9711156, 9710665, 9937931, 9945483 ,
               10045838 ,10131467, 10320706, 10457643, 10729488, 10874430 ,
               11044976 ,11055728, 11286108, 11290355, 11659866, 11665969 ,
               11752863 ,12069950, 12071525, 12078472, 12201439, 10100389 ,
               10213699 ,10492454, 10536307, 10744307, 10908212, 10910871 ,
               10988677 ,11219989, 11317417, 11407741, 11409007, 11409201 ,
               11489289 ,11584326, 11946391, 11947186, 11952410, 12001499 ,
               12001613 ,12094464, 12094461, 12100888, 12100946, 12173438 ,
               12181302 ,12181966, 9702558, 9703967, 10037221, 10041980 ,
               10828308 ,10998060, 11201089, 11310807, 11313182, 11396507 ,
               11399633 ,11789737, 11864755, 11965438, 11968135, 11968906 ,
               11969080 ,11969959, 11971892, 12047089, 12051906, 12051907 ,
               12053049 ,12053046, 12157087, 9290132
             );

--3) Obtain Documents for above Messages
SELECT DISTINCT ID into #tmpDOC
FROM DOCUMENT
WHERE MESSAGE_ID IN (SELECT DISTINCT MESSAGE_ID FROM #tmpMSG)
--146738

--4) Obtain Transactions for Above Documents
SELECT ID into #tmpTXN
FROM [TRANSACTION]
WHERE DOCUMENT_ID IN (SELECT ID FROM #tmpDOC) AND STATUS_CD = 'ERR'
--603561


SELECT TOP 10000 ID INTO #tmptrans FROM dbo.[TRANSACTION]
WHERE ID IN (SELECT  ID FROM #tmpTXN)


--5) Reset all Transactions for Messages being Re-processed
UPDATE [TRANSACTION]
SET STATUS_CD = 'INIT', PROCESSED_IN = 'N'
--SELECT* FROM dbo.[TRANSACTION]
WHERE ID IN (SELECT  ID FROM #tmptrans)
--23583

SELECT PROCESSED_IN,*
FROM MESSAGE
WHERE RELATE_ID_TX IN (SELECT DISTINCT MESSAGE_ID FROM #tmpMSG)


--6) Review Status of Transactions as they are being re-processed
SELECT STATUS_CD, COUNT(ID)
FROM [TRANSACTION]
WHERE ID IN (SELECT ID FROM #tmpTXN)
GROUP BY STATUS_CD






-------Queries to Determine Counts-------------


--1) Obtain IDs for all EDI Trading Partners
SELECT ID into #tmpTP
FROM TRADING_PARTNER
WHERE TYPE_CD = 'EDI_TP'

--2) Obtain all EDI Messages from Trading Partner Log (based on Date)
SELECT DISTINCT MESSAGE_ID into #tmpMSGALL
from TRADING_PARTNER_LOG
where TRADING_PARTNER_ID in (SELECT ID from #tmpTP) AND CREATE_DT >= '2017-08-01'
--7008

--3) Obtain Documents for above Messages
SELECT *
--SELECT DISTINCT ID into #tmpDOCALL
FROM DOCUMENT
WHERE MESSAGE_ID IN (SELECT DISTINCT MESSAGE_ID FROM #tmpMSGALL)
--146738

--4) Obtain Transactions for Above Documents
SELECT ID into #tmpTXNALL
FROM [TRANSACTION]
WHERE DOCUMENT_ID IN (SELECT ID FROM #tmpDOCALL) AND STATUS_CD = 'ERR'
--603561

--5) Total EDI Txn Errors
SELECT COUNT(ID)
from TRADING_PARTNER_LOG
WHERE MESSAGE_ID IN (SELECT DISTINCT MESSAGE_ID FROM #tmpMSGALL)
AND LOG_SEVERITY_CD = 'ERROR' AND RELATE_TYPE_CD = 'Transaction'
--1,599,793

--6) "Has Been Updated by Another User" Errors
SELECT COUNT(ID)
from TRADING_PARTNER_LOG
WHERE MESSAGE_ID IN (SELECT DISTINCT MESSAGE_ID FROM #tmpMSGALL)
AND LOG_SEVERITY_CD = 'ERROR' AND RELATE_TYPE_CD = 'Transaction'
AND LOG_MESSAGE LIKE '%has been updated by another user%'
--1,568,215

--7) "BorrowerInsuranceAgency Has Been Updated by Another User" Errors
SELECT COUNT(ID)
from TRADING_PARTNER_LOG
WHERE MESSAGE_ID IN (SELECT DISTINCT MESSAGE_ID FROM #tmpMSGALL)
AND LOG_SEVERITY_CD = 'ERROR' AND RELATE_TYPE_CD = 'Transaction'
AND LOG_MESSAGE LIKE '%BorrowerInsuranceAgency%has been updated by another user%'
--273,483

--8) "Address Id Has Been Updated by Another User" Errors
SELECT COUNT(ID)
from TRADING_PARTNER_LOG
WHERE MESSAGE_ID IN (SELECT DISTINCT MESSAGE_ID FROM #tmpMSGALL)
AND LOG_SEVERITY_CD = 'ERROR' AND RELATE_TYPE_CD = 'Transaction'
AND LOG_MESSAGE LIKE '%Address Id%has been updated by another user%'
--519,523

--9) "Has Been Updated by Another User" Errors Broken down by Trading Partner
SELECT DISTINCT TRADING_PARTNER.EXTERNAL_ID_TX, TRADING_PARTNER.NAME_TX, COUNT(TRADING_PARTNER_LOG.ID) as TotalErrors
from TRADING_PARTNER_LOG
LEFT JOIN MESSAGE ON TRADING_PARTNER_LOG.MESSAGE_ID = MESSAGE.ID
INNER JOIN DELIVERY_INFO ON MESSAGE.DELIVERY_INFO_ID = DELIVERY_INFO.ID
INNER JOIN TRADING_PARTNER ON DELIVERY_INFO.TRADING_PARTNER_ID = TRADING_PARTNER.ID
WHERE MESSAGE_ID IN (SELECT DISTINCT MESSAGE_ID FROM #tmpMSGALL)
AND LOG_SEVERITY_CD = 'ERROR' AND TRADING_PARTNER_LOG.RELATE_TYPE_CD = 'Transaction'
AND LOG_MESSAGE LIKE '%has been updated by another user%'
GROUP BY TRADING_PARTNER.EXTERNAL_ID_TX, TRADING_PARTNER.NAME_TX
ORDER BY COUNT(TRADING_PARTNER_LOG.ID) DESC

--10) "BorrowerInsuranceAgency Has Been Updated by Another User" Errors Broken down by Trading Partner
SELECT DISTINCT TRADING_PARTNER.EXTERNAL_ID_TX, TRADING_PARTNER.NAME_TX, COUNT(TRADING_PARTNER_LOG.ID) as TotalErrors
from TRADING_PARTNER_LOG
LEFT JOIN MESSAGE ON TRADING_PARTNER_LOG.MESSAGE_ID = MESSAGE.ID
INNER JOIN DELIVERY_INFO ON MESSAGE.DELIVERY_INFO_ID = DELIVERY_INFO.ID
INNER JOIN TRADING_PARTNER ON DELIVERY_INFO.TRADING_PARTNER_ID = TRADING_PARTNER.ID
WHERE MESSAGE_ID IN (SELECT DISTINCT MESSAGE_ID FROM #tmpMSGALL)
AND LOG_SEVERITY_CD = 'ERROR' AND TRADING_PARTNER_LOG.RELATE_TYPE_CD = 'Transaction'
AND LOG_MESSAGE LIKE '%BorrowerInsuranceAgency%has been updated by another user%'
GROUP BY TRADING_PARTNER.EXTERNAL_ID_TX, TRADING_PARTNER.NAME_TX
ORDER BY COUNT(TRADING_PARTNER_LOG.ID) DESC

--11) "Address Id Has Been Updated by Another User" Errors Broken down by Trading Partner
SELECT DISTINCT TRADING_PARTNER.EXTERNAL_ID_TX, TRADING_PARTNER.NAME_TX, COUNT(TRADING_PARTNER_LOG.ID) as TotalErrors
from TRADING_PARTNER_LOG
LEFT JOIN MESSAGE ON TRADING_PARTNER_LOG.MESSAGE_ID = MESSAGE.ID
INNER JOIN DELIVERY_INFO ON MESSAGE.DELIVERY_INFO_ID = DELIVERY_INFO.ID
INNER JOIN TRADING_PARTNER ON DELIVERY_INFO.TRADING_PARTNER_ID = TRADING_PARTNER.ID
WHERE MESSAGE_ID IN (SELECT DISTINCT MESSAGE_ID FROM #tmpMSGALL)
AND LOG_SEVERITY_CD = 'ERROR' AND TRADING_PARTNER_LOG.RELATE_TYPE_CD = 'Transaction'
AND LOG_MESSAGE LIKE '%Address Id%has been updated by another user%'
GROUP BY TRADING_PARTNER.EXTERNAL_ID_TX, TRADING_PARTNER.NAME_TX
ORDER BY COUNT(TRADING_PARTNER_LOG.ID) DESC
