USE [UniTrac]
GO 


--Loan Screen Information - LOAN/COLLATERAL/PROPERTY/OWNER/REQUIRED COVERAGE
SELECT  P.*
INTO    UniTracHDStorage..INC0288456_P
FROM    LOAN L
        INNER JOIN COLLATERAL C ON L.ID = C.LOAN_ID
        INNER JOIN PROPERTY P ON C.PROPERTY_ID = P.ID
        INNER JOIN REQUIRED_COVERAGE RC ON P.ID = RC.PROPERTY_ID
        INNER JOIN OWNER_LOAN_RELATE OL ON L.ID = OL.LOAN_ID
        INNER JOIN OWNER O ON OL.OWNER_ID = O.ID
        INNER JOIN OWNER_ADDRESS OA ON O.ADDRESS_ID = OA.ID
        INNER JOIN dbo.LENDER LL ON LL.ID = L.LENDER_ID
WHERE   LL.CODE_TX IN ( '7100' )
        AND L.NUMBER_TX IN ( '101217-3', '101217-53', '108549-2', '108549-2',
                             '11363-54', '142870-55', '15069-53', '15069-53',
                             '152827-54', '152827-54', '153183-1', '153183-1',
                             '153183-53', '153183-53', '155111-55',
                             '155111-55', '155111-56', '163924-46',
                             '163924-46', '16630-54', '168447-54', '168447-54',
                             '175011-54', '175011-54', '175011-54',
                             '176489-54', '176489-54', '176489-54',
                             '176491-47', '176491-47', '176491-47',
                             '182112-54', '182112-54', '204949-1', '204949-53',
                             '210936-53', '219089-54', '219089-54',
                             '222722-53', '222722-54', '222722-54',
                             '224822-46', '224822-46', '230276-53',
                             '237478-53', '237478-53', '241681-46',
                             '241681-46', '241681-60', '241681-60',
                             '246167-55', '248093-53', '248093-53',
                             '248093-54', '248093-54', '251767-53',
                             '251767-53', '252578-46', '254523-46',
                             '266621-42', '266621-47', '268571-53',
                             '268571-53', '276977-46', '27927-53', '27927-53',
                             '279362-53', '279362-53', '3019303-53',
                             '3019303-53', '3050757-1', '3050757-1',
                             '3050757-53', '3050757-53', '3089518-54',
                             '3089518-54', '314437-53', '314437-53',
                             '316894-51', '316894-51', '316894-51',
                             '316928-54', '33331-53', '333732-53', '333732-53',
                             '333732-53', '338712-53', '347410-53',
                             '347410-53', '347410-53', '349870-53',
                             '349870-53', '354716-53', '354716-53',
                             '361526-54', '361526-54', '363212-46',
                             '363212-46', '363212-46', '364454-55',
                             '364454-55', '367893-46', '37831-54', '37831-54',
                             '38211-54', '386169-54', '386291-53', '386291-53',
                             '38822-54', '38822-54', '388259-40', '388259-40',
                             '39425-54', '39425-54', '40169-57', '40169-57',
                             '4077055-54', '4092943-60', '4092943-60',
                             '422724-47', '422724-47', '427673-46',
                             '429637-48', '429637-48', '430433-53',
                             '430433-53', '434044-46', '434044-46',
                             '434044-60', '434044-60', '466751-53',
                             '466751-53', '491578-54', '496591-53',
                             '5004449-60', '502908-46', '502908-46',
                             '502908-46', '511580-54', '511580-54',
                             '519156-46', '519156-46', '519156-46',
                             '526633-46', '526633-46', '527331-53',
                             '527331-53', '532082-40', '532082-40',
                             '532082-46', '532082-46', '54351-1', '54351-1',
                             '557793-46', '557793-46', '577977-53',
                             '578510-53', '578510-53', '578510-53',
                             '588312-53', '594738-53', '595716-53',
                             '6009747-47', '6009747-5', '6009909-3',
                             '6009909-3', '6009909-54', '6009909-54',
                             '601770-54', '6018443-46', '6018443-46',
                             '6020206-53', '6020206-53', '603633-53',
                             '628520-1', '628520-1', '628520-53', '628520-53',
                             '66768-56', '68173-53', '69542-53', '69542-53',
                             '70514-1', '70514-1', '70514-54', '70514-54',
                             '75266-54', '806502-40', '806502-46', '860370-53',
                             '860370-53', '860716-53', '860716-53',
                             '860716-53', '876210-54', '876210-54',
                             '886336-53', '886336-53', '903268-54',
                             '903268-54', '903268-54', '904120-53',
                             '904120-53', '92664-53', '92664-53', '92690-46',
                             '92690-46', '92696-60', '92696-60', '92889-53',
                             '92889-53', '937890-53', '950811-53', '953087-53',
                             '953087-53', '956293-53', '956293-53',
                             '962086-53', '962086-53', '965679-1', '965679-1',
                             '965679-1', '965679-53', '965679-53', '965679-53',
                             '977752-4', '977752-4', '977752-53', '977752-53',
                             '982507-46', '982507-46', '134403-53',
                             '134403-53', '134403-53', '142206-1', '142206-1',
                             '232601-46', '232601-46', '232601-46',
                             '275015-46', '275015-46', '275015-46', '279362-1',
                             '279362-1', '388259-46', '388259-46', '422724-53',
                             '422724-53', '562005-1', '562005-1', '827023-46',
                             '827023-46', '827023-46', '111471-40',
                             '111471-40', '111471-53', '111471-53',
                             '114692-54', '114692-54', '134582-46',
                             '134582-46', '142870-55', '155111-54',
                             '156892-54', '156892-54', '190681-53',
                             '190681-53', '302632-53', '302632-53',
                             '3089518-53', '3089518-53', '314437-46',
                             '314437-46', '314437-53', '314437-53', '37831-53',
                             '37831-53', '386169-53', '386376-46', '386376-46',
                             '38822-1', '38822-1', '39217-1', '39217-1',
                             '39217-54', '39217-54', '40169-55', '40169-55',
                             '4058543-53', '4058543-53', '4058543-53',
                             '4077055-53', '511580-53', '511580-53',
                             '52128-55', '52128-55', '577922-53', '6009747-2',
                             '6009747-46', '6009909-53', '6009909-53',
                             '826665-53', '826665-53', '876210-55',
                             '876210-55', '903268-53', '903268-53',
                             '903268-53', '904378-53', '904378-53',
                             '910014-53', '910014-53', '941669-53',
                             '941669-53', '962086-53', '962086-53', '977752-3',
                             '977752-3', '977752-46', '977752-46', '984603-1',
                             '984603-1' )

--Loan Screen Information - LOAN/COLLATERAL/PROPERTY/OWNER/REQUIRED COVERAGE
SELECT P.* FROM LOAN L
INNER JOIN COLLATERAL C ON L.ID = C.LOAN_ID
INNER JOIN PROPERTY P ON C.PROPERTY_ID = P.ID
INNER JOIN REQUIRED_COVERAGE RC ON P.ID = RC.PROPERTY_ID
INNER JOIN OWNER_LOAN_RELATE OL ON L.ID = OL.LOAN_ID
INNER JOIN OWNER O ON OL.OWNER_ID = O.ID
INNER JOIN OWNER_ADDRESS OA ON O.ADDRESS_ID = OA.ID
INNER JOIN dbo.LENDER LL ON LL.ID = L.LENDER_ID
WHERE LL.CODE_TX IN ('7100') AND L.NUMBER_TX IN ('101217-3','101217-53')


UPDATE PROPERTY
SET  UPDATE_DT = GETDATE(),UPDATE_USER_TX = 'INC0288456', LOCK_ID = CASE WHEN LOCK_ID >= 255 THEN 1 ELSE LOCK_ID + 1 END, 
FIELD_PROTECTION_XML = NULL
--SELECT * FROM PROPERTY
WHERE ID IN (SELECT ID FROM  UniTracHDStorage..INC0288456_P)




INSERT INTO PROPERTY_CHANGE
 ( ENTITY_NAME_TX , ENTITY_ID , USER_TX , ATTACHMENT_IN , 
 CREATE_DT , AGENCY_ID , DESCRIPTION_TX ,  DETAILS_IN , FORMATTED_IN ,
 LOCK_ID , PARENT_NAME_TX , PARENT_ID , TRANS_STATUS_CD , UTL_IN )
 SELECT DISTINCT 'Allied.UniTrac.Property' , P.ID , 'INC0288456' , 'N' , 
 GETDATE() ,  1 , 
 'Removing loans from retain per INC0288456', 
 'Y' , 'N' , 1 ,  'Allied.UniTrac.Property' , P.ID , 'PEND' , 'N'
FROM PROPERTY P
WHERE P.ID IN (SELECT ID FROM UniTracHDStorage..INC0288456_P)
