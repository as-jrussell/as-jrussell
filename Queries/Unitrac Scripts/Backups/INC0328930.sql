USE UniTrac

--

SELECT * --INTO  #tmp
FROM   dbo.LOAN L
JOIN dbo.FORCE_PLACED_CERTIFICATE fpc ON fpc.LOAN_ID = L.ID
WHERE  L.NUMBER_TX IN ( '911162116', '996030596', '996186786', '996233256' ,
                      '996372666' ,'996433956', '996457346', '996602086' ,
                      '996639426' ,'996704656', '996857196', '996979046' ,
                      '997013526' ,'997164076', '997200136', '997225506' ,
                      '997350626' ,'997364586', '997417896', '997509096' ,
                      '997544106' ,'997661536', '997704736', '997710336' ,
                      '997750326' ,'997807536', '998036366', '998072156' ,
                      '998091756' ,'998210046', '998230076', '998240676' ,
                      '998257026' ,'998266506', '998280476', '998291346' ,
                      '998297426' ,'998303156', '998346416', '998390526' ,
                      '998390586' ,'998415376', '998433866', '998440916' ,
                      '998458056' ,'998472766',  '998496816' ,
                      '998567166' ,'998593796', '998594386', '998645026' ,
                      '998669686' ,'998698276', '998706286', '998714836' ,
                      '998722906' ,'998732706', '998758466', '998908486' ,
                      '999004476' ,'999342066', '998488956'
                    )
       AND LENDER_ID = '2254';


UPDATE LOAN 
SET  UPDATE_DT = GETDATE(),UPDATE_USER_TX = 'INC0328930', LOCK_ID = CASE WHEN LOCK_ID >= 255 THEN 1 ELSE LOCK_ID + 1 END, RECORD_TYPE_CD = 'D', PURGE_DT = NULL
--SELECT * FROM LOAN
WHERE ID IN (SELECT ID FROM  #tmp)


INSERT INTO PROPERTY_CHANGE
 ( ENTITY_NAME_TX , ENTITY_ID , USER_TX , ATTACHMENT_IN , 
 CREATE_DT , AGENCY_ID , DESCRIPTION_TX ,  DETAILS_IN , FORMATTED_IN ,
 LOCK_ID , PARENT_NAME_TX , PARENT_ID , TRANS_STATUS_CD , UTL_IN )
 SELECT DISTINCT 'Allied.UniTrac.Loan' , L.ID , 'INC0XXXXXX' , 'N' , 
 GETDATE() ,  1 , 
 'Marked back to deleted', 
 'Y' , 'N' , 1 ,  'Allied.UniTrac.Loan' , L.ID , 'PEND' , 'N'
FROM LOAN L 
WHERE L.ID IN (SELECT ID FROM  #tmp)



UPDATE LOAN 
SET  UPDATE_DT = GETDATE(),UPDATE_USER_TX = 'INC0328930', LOCK_ID = CASE WHEN LOCK_ID >= 255 THEN 1 ELSE LOCK_ID + 1 END, RECORD_TYPE_CD = 'A', PURGE_DT = NULL
--SELECT * FROM LOAN
WHERE ID IN (134704456)


INSERT INTO PROPERTY_CHANGE
 ( ENTITY_NAME_TX , ENTITY_ID , USER_TX , ATTACHMENT_IN , 
 CREATE_DT , AGENCY_ID , DESCRIPTION_TX ,  DETAILS_IN , FORMATTED_IN ,
 LOCK_ID , PARENT_NAME_TX , PARENT_ID , TRANS_STATUS_CD , UTL_IN )
 SELECT DISTINCT 'Allied.UniTrac.Loan' , L.ID , 'INC0XXXXXX' , 'N' , 
 GETDATE() ,  1 , 
 'Marked to archive', 
 'Y' , 'N' , 1 ,  'Allied.UniTrac.Loan' , L.ID , 'PEND' , 'N'
FROM LOAN L 
WHERE L.ID IN (134704456)




UPDATE pc SET pc.DESCRIPTION_TX = 'Marked to deleted', pc.USER_TX =  'INC0328930'
--SELECT * 
FROM dbo.PROPERTY_CHANGE pc
WHERE USER_TX = 'INC0XXXXXX' AND ENTITY_NAME_TX = 'Allied.UniTrac.Loan'
AND ENTITY_ID IN (SELECT id FROM LOAN
WHERE ID IN (SELECT ID FROM  #tmp))


UPDATE pc SET pc.USER_TX =  'INC0328930'
--SELECT * 
FROM dbo.PROPERTY_CHANGE pc
WHERE USER_TX = 'INC0XXXXXX' AND ENTITY_NAME_TX = 'Allied.UniTrac.Loan'
AND ENTITY_ID IN (134704456)