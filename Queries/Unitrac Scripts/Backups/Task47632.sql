use UniTrac

select *
into unitrachdstorage..Task47632
from COLLATERAL
where id in ('243731825',
'243731830',
'243731831',
'243731835',
'243731839',
'243731850',
'243731851',
'243731854',
'243731855',
'243731856',
'243731860',
'243731867',
'243731869',
'243731866',
'243731872',
'243731877',
'243731876',
'243731889',
'243731892',
'243731899',
'243731899',
'243731900',
'243731897',
'243731904',
'243731906',
'243731911',
'243731909',
'243731914',
'243731919',
'243731923',
'243731917',
'243731918',
'243731918',
'243731921',
'243731927',
'243731924',
'243731928',
'243731928',
'243731925',
'243731926',
'243731930',
'243731931',
'243731932',
'243731933',
'243731936',
'243731934',
'243731948',
'243731937',
'243731938',
'243731938',
'243731946',
'243731947',
'243731939',
'243731940',
'243731944',
'243731942',
'243731951',
'243731953',
'243731941',
'243731949',
'243731952',
'243731950',
'243731956',
'243731957',
'243731958',
'243731954',
'243731955',
'243731961',
'243731960',
'243731959',
'243731959',
'243731962',
'243731969',
'243731963',
'243731965',
'243731968',
'243731971',
'243731973',
'243731964',
'243731967',
'243731975',
'243731987',
'243731974',
'243731977',
'243731981',
'243731978',
'243731976',
'243731979',
'243731983',
'243731988',
'243731999',
'243731989',
'243731995',
'243731982',
'243731984',
'243731991',
'243732000',
'243731985',
'243732004',
'243731997',
'243732001',
'243732007',
'243732009',
'243732011',
'243731990',
'243731992',
'243731993',
'243731998',
'243732012',
'243731994',
'243731994',
'243731996',
'243732002',
'243732003',
'243732006',
'243732008',
'243732010',
'243732005',
'243732025',
'243732025',
'243732029',
'243732013',
'243732015',
'243732016',
'243732017',
'243732019',
'243732022',
'243732018',
'243732021',
'243732014',
'243732020',
'243732024',
'243732024',
'243732026',
'243732027',
'243732027',
'243732031',
'243732031',
'243698915',
'243698915',
'243732036',
'243732036',
'243732030',
'243732038',
'243732039',
'243732035',
'243732033',
'243732041',
'243732034',
'243732045',
'243732040',
'243732042',
'243732043',
'243732044',
'243732047',
'243732046',
'243732048',
'243732052',
'243732053',
'243732049',
'243732056',
'243732055',
'243732058',
'243732059',
'243732060',
'243732054',
'243732061',
'243732063',
'243732062',
'243732064',
'243732066',
'243732065',
'243732067',
'243732069',
'243732073',
'243732068',
'243732076',
'243732070',
'243732071',
'243732071',
'243732074',
'243732078',
'243732086',
'243732083',
'243732085',
'243732080',
'243732091',
'243732092',
'243732090',
'243732093',
'243732095',
'243732096',
'243732098',
'243732097',
'243732097',
'243732103',
'243732094',
'243732100',
'243732101',
'243732106',
'243732099',
'243732102',
'243732108',
'243732107',
'243732109',
'243732111',
'243732105',
'243732112',
'243732115',
'243732118',
'243732117',
'243732114',
'243732110',
'243732119',
'243732116',
'243732113',
'243732120',
'243732121',
'243732122',
'243732124',
'243732125',
'243732123',
'243732127',
'243732127',
'243732133',
'243732128',
'243732130',
'243732134',
'243732137',
'243732135',
'243732136',
'243732140',
'243732141',
'243732145',
'243732147',
'243732142',
'243732150',
'243732143',
'243732152',
'243732153',
'243732149',
'243732154',
'243732144',
'243732160',
'243732164',
'243732156',
'243732163',
'243732166',
'243732159',
'243732161',
'243732158',
'243732162',
'243732169',
'243732171',
'243732173',
'243732165',
'243732168',
'243732168',
'243732172',
'243732174',
'243732179',
'243732182',
'243732186',
'243732181',
'243732184',
'243732188',
'243732188',
'243732189',
'243732192',
'243732187',
'243732200',
'243732195',
'243732201',
'243732193',
'243732191',
'243732194',
'243732199',
'243732214',
'243732202',
'243732209',
'243732211',
'243732208',
'243732213',
'243732205',
'243732215',
'243732210',
'243732220',
'243732216',
'243732217',
'243732227',
'243732219',
'243732223',
'243732224',
'243732228',
'243732230',
'243732218',
'243732222',
'243732226',
'243732232',
'243732225',
'243732231',
'243732237',
'243732229',
'243732233',
'243732234',
'243732238',
'243732245',
'243732236',
'243732240',
'243732247',
'243732242',
'243732249',
'243732251',
'243732252',
'243732250',
'243732250',
'243732253',
'243732256',
'243732260',
'243732255',
'243732257',
'243732257',
'243732263',
'243732265',
'243732270',
'243732264',
'243732268',
'243732266',
'243732273',
'243732280',
'243732276',
'243732279',
'243732271',
'243732272',
'243680424',
'243732275',
'243732278',
'243732282',
'243732283',
'243824013',
'243732281',
'243732291',
'243732284',
'243732288',
'243732292',
'243732286',
'243732287',
'243732289',
'243732293',
'243732294',
'243732299',
'243732300',
'243732308',
'243732296',
'243732301',
'243732304',
'243732305',
'243732303',
'243732312',
'243732306',
'243732309',
'243732316',
'243732320',
'243732322',
'243732324',
'243732325',
'243732326',
'243732336',
'243732328',
'243732353',
'243680434',
'243732430',
'243732501',
'243732509',
'243732509',
'243732511',
'243732510',
'243732515',
'243732518',
'243732516',
'243732517',
'243732520',
'243732521',
'243732519',
'243732522',
'243732523',
'243732526',
'243732528',
'243732529',
'243732524',
'243732533',
'243732538',
'243732539',
'243732540',
'243732535',
'243732534',
'243732537',
'243732543',
'243732545',
'243732544',
'243732546',
'243732548',
'243732547',
'243732549',
'243732549',
'243732550',
'243732551',
'243732552',
'243732562',
'243732569',
'243732567',
'243732567',
'243732579',
'243732577',
'243732581',
'243732593',
'243732597',
'243732588',
'243732588',
'243732595',
'243732596',
'243732601',
'243732594',
'243732605',
'243732608',
'243732603',
'243732614',
'243732590',
'243732599',
'243732599',
'243732610',
'243732613',
'243732618',
'243732598',
'243732600',
'243732602',
'243732607',
'243732611',
'243732616',
'243732619',
'243732620',
'243732604',
'243732606',
'243732612',
'243732615',
'243798891')



update C
set COLLATERAL_CODE_ID = T.[New Collateral Code ID], UPDATE_DT = GETDATE(), UPDATE_USER_TX = 'Task47632', LOCK_ID = LOCK_ID+1
--select COLLATERAL_CODE_ID ,T.[New Collateral Code ID], *
from COLLATERAL C
join UniTracHDStorage..[Task 47654_HS] T on C.ID = T.[Collateral ID]
where id in (select [Collateral ID] from UniTracHDStorage..[Task 47654_HS])
and COLLATERAL_CODE_ID <> T.[New Collateral Code ID]

INSERT INTO PROPERTY_CHANGE
 ( ENTITY_NAME_TX , ENTITY_ID , USER_TX , ATTACHMENT_IN , 
 CREATE_DT , AGENCY_ID , DESCRIPTION_TX ,  DETAILS_IN , FORMATTED_IN ,
 LOCK_ID , PARENT_NAME_TX , PARENT_ID , TRANS_STATUS_CD , UTL_IN )
 SELECT DISTINCT 'Allied.UniTrac.Collateral' , C.ID , 'Task47632' , 'N' , 
 GETDATE() ,  1 , 
'Change Collateral Code ID to 524', 
 'Y' , 'N' , 1 ,  'Allied.UniTrac.Collateral' , C.ID , 'PEND' , 'N'
from COLLATERAL C
join UniTracHDStorage..[Task 47654_HS] T on C.ID = T.[Collateral ID]
where C.id in (243850521)


update PC set DESCRIPTION_TX = 'Change Collateral Code ID to 524, and marked as retained'
--select * 
from PROPERTY_CHANGE PC
where create_dt >= '2018-11-06' and user_tx = 'Task47632'


select * from UniTracHDStorage..[Task 47654_HS]
where FIELD_PROTECTION_XML is not null 



update C
set COLLATERAL_CODE_ID = T.[New Collateral Code ID], UPDATE_DT = GETDATE(), UPDATE_USER_TX = 'Task47632', LOCK_ID = LOCK_ID+1, C.RETAIN_IN = 'Y'
--C.FIELD_PROTECTION_XML = T.FIELD_PROTECTION_XML
--select C.FIELD_PROTECTION_XML ,T.FIELD_PROTECTION_XML, COLLATERAL_CODE_ID , T.[New Collateral Code ID], *
from COLLATERAL C
join UniTracHDStorage..[Task 47654_HS] T on C.ID = T.[Collateral ID]
where id in (select [Collateral ID] from UniTracHDStorage..[Task 47654_HS])
and T.FIELD_PROTECTION_XML is not null 



update C
set COLLATERAL_CODE_ID = T.[New Collateral Code ID], UPDATE_DT = GETDATE(), UPDATE_USER_TX = 'Task47632', LOCK_ID = LOCK_ID+1, C.RETAIN_IN = 'N',
C.FIELD_PROTECTION_XML = '<FP><Field name="CollateralCodeId" /></FP>'
--select C.FIELD_PROTECTION_XML ,T.FIELD_PROTECTION_XML, COLLATERAL_CODE_ID , T.[New Collateral Code ID], *
from COLLATERAL C
join UniTracHDStorage..[Task 47654_HS] T on C.ID = T.[Collateral ID]
where id in (select [Collateral ID] from UniTracHDStorage..[Task 47654_HS])
and T.FIELD_PROTECTION_XML is  null

