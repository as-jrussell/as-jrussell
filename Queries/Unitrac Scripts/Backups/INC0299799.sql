USE [UniTrac]
GO 


SELECT L.NUMBER_TX, RC.SUMMARY_STATUS_CD, RC.SUMMARY_SUB_STATUS_CD, 
RC.CPI_STATUS_CD, RC.CPI_SUB_STATUS_CD,
* FROM LOAN L
INNER JOIN COLLATERAL C ON L.ID = C.LOAN_ID
INNER JOIN PROPERTY P ON C.PROPERTY_ID = P.ID
INNER JOIN REQUIRED_COVERAGE RC ON P.ID = RC.PROPERTY_ID
WHERE L.LENDER_ID IN (2327) AND L.NUMBER_TX IN ( '3672573', '8027765' , '7003625')
AND RC.SUMMARY_STATUS_CD = 'F' 



--Loan Screen Information - LOAN/COLLATERAL/PROPERTY/OWNER/REQUIRED COVERAGE
SELECT rc.SUMMARY_STATUS_CD, SUMMARY_SUB_STATUS_CD, RC.*
--INTO UniTracHDStorage..INC0299799_RC
 FROM LOAN L
INNER JOIN COLLATERAL C ON L.ID = C.LOAN_ID
INNER JOIN PROPERTY P ON C.PROPERTY_ID = P.ID
INNER JOIN REQUIRED_COVERAGE RC ON P.ID = RC.PROPERTY_ID
INNER JOIN OWNER_LOAN_RELATE OL ON L.ID = OL.LOAN_ID
INNER JOIN OWNER O ON OL.OWNER_ID = O.ID
INNER JOIN OWNER_ADDRESS OA ON O.ADDRESS_ID = OA.ID
INNER JOIN dbo.LENDER LL ON LL.ID = L.LENDER_ID
WHERE L.LENDER_ID IN (2327) AND L.NUMBER_TX IN ( '3672573', '8027765' , '7003625')
AND RC.SUMMARY_STATUS_CD = 'F' 


SELECT * FROM dbo.REF_CODE
WHERE CODE_CD = 'F'

SELECT * FROM UniTracHDStorage..INC0299799_RC

SELECT * FROM dbo.REF_CODE
WHERE DOMAIN_CD = 'RequiredCoverageInsStatus'


UPDATE  dbo.REQUIRED_COVERAGE
SET     UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0299799' ,
        LOCK_ID = CASE WHEN LOCK_ID >= 255 THEN 1
                       ELSE LOCK_ID + 1
                  END ,
        SUMMARY_STATUS_CD = 'B' ,
        CPI_STATUS_CD = 'B'
--SELECT * FROM dbo.REQUIRED_COVERAGE
WHERE   ID IN ( SELECT  ID
                FROM    UniTracHDStorage..INC0299799_RC )






INSERT  INTO PROPERTY_CHANGE
        ( ENTITY_NAME_TX ,
          ENTITY_ID ,
          USER_TX ,
          ATTACHMENT_IN ,
          CREATE_DT ,
          AGENCY_ID ,
          DESCRIPTION_TX ,
          DETAILS_IN ,
          FORMATTED_IN ,
          LOCK_ID ,
          PARENT_NAME_TX ,
          PARENT_ID ,
          TRANS_STATUS_CD ,
          UTL_IN
        )
        SELECT DISTINCT
                'Allied.UniTrac.RequiredCoverage' ,
                RC.ID ,
                'INC0299799' ,
                'N' ,
                GETDATE() ,
                1 ,
                'Moved status from inforce to binder ' ,
                'Y' ,
                'N' ,
                1 ,
                'Allied.UniTrac.RequiredCoverage' ,
                RC.ID ,
                'PEND' ,
                'N'
        FROM    REQUIRED_COVERAGE RC
        WHERE   RC.ID IN ( SELECT   ID
                           FROM     UniTracHDStorage..INC0299799_RC )









SELECT * 
--INTO UniTracHDStorage..INC0299799_IH
FROM dbo.INTERACTION_HISTORY
WHERE PROPERTY_ID IN (148126042,
148126348,
148127144,
148127647) AND TYPE_CD = 'CPI'



UPDATE  dbo.INTERACTION_HISTORY
SET     SPECIAL_HANDLING_XML.modify('replace value of (/SH/Status/text())[1] with "CPI Binder"') ,
        LOCK_ID = LOCK_ID + 1
--SELECT * FROM  dbo.INTERACTION_HISTORY
WHERE ID IN (287941835,
291399380,
287941842)	


SELECT * FROM dbo.FORCE_PLACED_CERTIFICATE
WHERE id IN (6279538,
6279537,
6303084,
6279539)


SELECT * FROM dbo.CPI_QUOTE
WHERE id IN (38043556,
38043557,
38043558,
38117259)



SELECT * FROM dbo.REF_CODE
WHERE CODE_CD = 'E'


SELECT * FROM dbo.CPI_ACTIVITY
WHERE CPI_QUOTE_ID IN (38043556,
38043557,
38043558,
38117259)


