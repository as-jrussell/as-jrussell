USE UniTrac

-----Error Status
SELECT * 
FROM    REPORT_HISTORY
WHERE   STATUS_CD = 'ERR'
        AND CAST(UPDATE_DT AS DATE) >= CAST(GETDATE()-1 AS DATE)
        AND GENERATION_SOURCE_CD = 'u'
        AND MSG_LOG_TX IS NOT NULL
		ORDER BY UPDATE_DT DESC

-----Complete
SELECT *
FROM    REPORT_HISTORY
WHERE   STATUS_CD = 'COMP'
		AND CAST(UPDATE_DT AS DATE) = CAST(GETDATE() AS DATE)
        AND GENERATION_SOURCE_CD = 'u'     AND MSG_LOG_TX IS NOT NULL
ORDER BY UPDATE_DT DESC

SELECT * FROM dbo.REPORT

----Find Work Item, Process Log ID and Process Definition ID

SELECT rh.REPORT_DATA_XML.value( '(/ReportData/Report/WorkItemId/@value)[1]', 'varchar(500)' ) as [WI.ID],
rh.REPORT_DATA_XML.value( '(/ReportData/Report/ProcessDefinitionID/@value)[1]', 'varchar(500)' ) as [PD.ID],
rh.REPORT_DATA_XML.value( '(/ReportData/Report/ProcessLogID/@value)[1]', 'varchar(500)' ) as [ProcessLog.ID],
*
FROM REPORT_HISTORY rh 
WHERE CAST(RH.UPDATE_DT AS DATE) = CAST(GETDATE() AS DATE) AND rh.STATUS_CD = 'PEND'
ORDER BY rh.RECORD_COUNT_NO DESC



		            ---------------- Setting Report to Re-Pend/Re-Try -------------------
UPDATE  [UniTrac].[dbo].[REPORT_HISTORY]
SET     STATUS_CD = 'PEND' ,
        RETRY_COUNT_NO = 0 ,
        MSG_LOG_TX = NULL ,
        --RECORD_COUNT_NO = 0 ,
        ELAPSED_RUNTIME_NO = 0,
		UPDATE_DT = GETDATE()
		--, REPORT_DATA_XML = 
		,REPORT_ID = '27'
--SELECT * FROM dbo.REPORT_HISTORY
WHERE   ID IN (9406547)
(9405890,
9405815,
9406328,
9406360,
9405654,
9406471,
9405710,
9405843)






 (SELECT ID 
FROM    REPORT_HISTORY
WHERE   STATUS_CD = 'ERR'
        AND CAST(UPDATE_DT AS DATE) >= CAST(GETDATE() AS DATE)) 


--
    
	SELECT * FROM dbo.LENDER
	WHERE ID = '1835'

------Show all Reports


-----Find a report and where document lives
SELECT DM.SERVER_SHARE_TX,DC.RELATIVE_PATH_TX, DC.ORIGINAL_FILE_NAME_TX, 
DC.RELATE_CLASS_NAME_TX, DM.STORAGE_TYPE_CD, RH.*
FROM dbo.REPORT_HISTORY RH
INNER JOIN dbo.DOCUMENT_CONTAINER DC ON RH.DOCUMENT_CONTAINER_ID = DC.ID
INNER JOIN dbo.DOCUMENT_MANAGEMENT DM ON DM.ID = DC.DOCUMENT_MANAGEMENT_ID
WHERE RH.ID IN (XXXXXXXX) 

SELECT * FROM dbo.REPORT_HISTORY
WHERE ID IN (XXXXXXXX) 



------Group of counts by user
--SELECT  UPDATE_USER_TX [User], COUNT(*) [Counts]
--FROM    REPORT_HISTORY
--WHERE   STATUS_CD = 'COMP'
--		AND CAST(UPDATE_DT AS DATE) = CAST(GETDATE()-1 AS DATE)
--        AND GENERATION_SOURCE_CD = 'u'
--        AND MSG_LOG_TX IS NOT NULL
--GROUP BY UPDATE_USER_TX
--ORDER BY COUNT(*) DESC

SELECT * FROM UniTracHDStorage..ReportErr_20160226



SELECT * FROM dbo.LOAN
WHERE ID IN (2016535941)




SELECT 
REPORT_DATA_XML.value( '(/ReportData/Report/FilterByTx/@value)[1]', 'varchar(500)' ), 
* FROM dbo.REPORT_HISTORY
WHERE REPORT_ID = '45' AND CREATE_DT >= '2016-05-23 17:00:00 '
ORDER BY STATUS_CD DESC 


SELECT REPORT_ID, COUNT(id) FROM dbo.REPORT_HISTORY
WHERE STATUS_CD IN ('HOLD', 'IGN') and
CREATE_DT >= '2016-05-23 17:00:00 '
GROUP BY REPORT_ID
ORDER BY COUNT(id) desc




SELECT STATUS_CD, COUNT(id) FROM dbo.REPORT_HISTORY
WHERE REPORT_ID = '40'  and
CREATE_DT >= '2016-05-23 17:00:00 '
GROUP BY STATUS_CD
ORDER BY COUNT(id) desc


