USE UniTrac
SELECT * FROM dbo.LENDER
WHERE CODE_TX = '2623'

SELECT  * INTO UniTracHDStorage.dbo.LOAN_2623_1
FROM    dbo.LOAN
WHERE   LENDER_ID IN ( 140 )
        AND NUMBER_TX IN ('2393007-1',
'2400000-1',
'2988004-2',
'6096006-1',
'6283009-2',
'7044007-3',
'11415000-4',
'11691005-1',
'14843006-1',
'15013007-2',
'15556000-2',
'15953009-2',
'16175009-3',
'18394000-3',
'18605005-4',
'22927008-2',
'23116007-1'  )

SELECT * FROM UniTracHDStorage.dbo.LOAN_2623_1


UPDATE  Loan
SET     NUMBER_TX = '2393007-0001' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0276147'
WHERE   NUMBER_TX = '2393007-1'
        AND LENDER_ID = 140
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '2400000-0001' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0276147'
WHERE   NUMBER_TX = '2400000-1'
        AND LENDER_ID = 140
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '2988004-0001' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0276147'
WHERE   NUMBER_TX = '2988004-2'
        AND LENDER_ID = 140
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '6096006-0001' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0276147'
WHERE   NUMBER_TX = '6096006-1'
        AND LENDER_ID = 140
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '6283009-0002' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0276147'
WHERE   NUMBER_TX = '6283009-2'
        AND LENDER_ID = 140
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '7044007-0002' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0276147'
WHERE   NUMBER_TX = '7044007-3'
        AND LENDER_ID = 140
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '11415000-0003' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0276147'
WHERE   NUMBER_TX = '11415000-4'
        AND LENDER_ID = 140
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '11691005-0001' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0276147'
WHERE   NUMBER_TX = '11691005-1'
        AND LENDER_ID = 140
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '14843006-0001' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0276147'
WHERE   NUMBER_TX = '14843006-1'
        AND LENDER_ID = 140
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '15013007-0002' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0276147'
WHERE   NUMBER_TX = '15013007-2'
        AND LENDER_ID = 140
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '15556000-0002' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0276147'
WHERE   NUMBER_TX = '15556000-2'
        AND LENDER_ID = 140
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '15953009-0002' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0276147'
WHERE   NUMBER_TX = '15953009-2'
        AND LENDER_ID = 140
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '16175009-0002' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0276147'
WHERE   NUMBER_TX = '16175009-3'
        AND LENDER_ID = 140
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '18394000-0003' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0276147'
WHERE   NUMBER_TX = '18394000-3'
        AND LENDER_ID = 140
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '18605005-0002' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0276147'
WHERE   NUMBER_TX = '18605005-4'
        AND LENDER_ID = 140
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '22927008-0002' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0276147'
WHERE   NUMBER_TX = '22927008-2'
        AND LENDER_ID = 140
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '23116007-0001' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0276147'
WHERE   NUMBER_TX = '23116007-1'
        AND LENDER_ID = 140
        AND PURGE_DT IS NULL;



--2) INSERT into PROPERTY_CHANGE table
INSERT INTO PROPERTY_CHANGE (ENTITY_NAME_TX,ENTITY_ID,USER_TX,ATTACHMENT_IN,CREATE_DT,AGENCY_ID,DETAILS_IN,FORMATTED_IN,LOCK_ID,PARENT_NAME_TX,PARENT_ID,TRANS_STATUS_CD,UTL_IN)
SELECT 'Allied.UniTrac.Loan',LOAN.ID,'INC0276147','N','2016-12-13 00:00:00.000',1,'Y','N',1,'Allied.UniTrac.Loan',LOAN.ID,'PEND','N'
FROM LOAN
WHERE ID IN (SELECT ID FROM UnitracHDStorage.dbo.LOAN_2623_1)
--42


--3) INSERT into PROPERTY_CHANGE_UPDATE table
INSERT INTO PROPERTY_CHANGE_UPDATE (CHANGE_ID, TABLE_NAME_TX, TABLE_ID, COLUMN_NM, FROM_VALUE_TX,TO_VALUE_TX,DATATYPE_NO,CREATE_DT,DISPLAY_IN,OPERATION_CD)
select PROPERTY_CHANGE.ID,'LOAN',ENTITY_ID,'NUMBER_TX',UnitracHDStorage.dbo.LOAN_2623_1.NUMBER_TX,LOAN.NUMBER_TX,1,'2016-12-13 00:00:00.000','Y','U'
from PROPERTY_CHANGE
INNER JOIN LOAN ON PROPERTY_CHANGE.ENTITY_ID = LOAN.ID AND ENTITY_NAME_TX = 'Allied.UniTrac.Loan' 
INNER JOIN UnitracHDStorage.dbo.LOAN_2623_1 ON LOAN.ID = UnitracHDStorage.dbo.LOAN_2623_1.ID --AND ENTITY_NAME_TX = 'Allied.UniTrac.Loan' 
WHERE PROPERTY_CHANGE.CREATE_DT = '2016-12-13 00:00:00.000'
AND ENTITY_ID IN (SELECT ID FROM UnitracHDStorage.dbo.LOAN_2623_1)
--0

---4) Insert into LOAN_NUMBER Table (Leave old numbers for matching purposes)

INSERT INTO LOAN_NUMBER (LOAN_ID,NUMBER_TX,EFFECTIVE_DT,CREATE_DT,UPDATE_DT,UPDATE_USER_TX, LOCK_ID)
SELECT dbo.LOAN.ID, dbo.LOAN.NUMBER_TX,dbo.LOAN.EFFECTIVE_DT,GETDATE(),GETDATE(),'INC0276147',1
FROM UnitracHDStorage.dbo.LOAN_2623_1 HD INNER JOIN dbo.LOAN ON HD.ID = LOAN.ID
--42

--5) Full Text Search Updates

--Create updates
SELECT 'EXEC SaveSearchFullText', PROPERTY.ID 
FROM PROPERTY
INNER JOIN COLLATERAL ON PROPERTY.ID = COLLATERAL.PROPERTY_ID
AND LOAN_ID in (select ID FROM UnitracHDStorage.dbo.LOAN_2623_1)
--42


EXEC SaveSearchFullText	230266
EXEC SaveSearchFullText	246266
EXEC SaveSearchFullText	248304
EXEC SaveSearchFullText	252335
EXEC SaveSearchFullText	305096
EXEC SaveSearchFullText	372127
EXEC SaveSearchFullText	398218
EXEC SaveSearchFullText	411504
EXEC SaveSearchFullText	470552
EXEC SaveSearchFullText	470564
EXEC SaveSearchFullText	470568
EXEC SaveSearchFullText	30057577
EXEC SaveSearchFullText	72780888
EXEC SaveSearchFullText	72780916
EXEC SaveSearchFullText	72781027
EXEC SaveSearchFullText	72781081
EXEC SaveSearchFullText	72781090
EXEC SaveSearchFullText	93052951
EXEC SaveSearchFullText	72781041
EXEC SaveSearchFullText	93052952
EXEC SaveSearchFullText	114659329
EXEC SaveSearchFullText	72780927
EXEC SaveSearchFullText	72780887
EXEC SaveSearchFullText	72780866
EXEC SaveSearchFullText	137412697
EXEC SaveSearchFullText	137412702
EXEC SaveSearchFullText	93052971
EXEC SaveSearchFullText	76355857
EXEC SaveSearchFullText	72780955
EXEC SaveSearchFullText	1481051
EXEC SaveSearchFullText	1476396
EXEC SaveSearchFullText	1486965
EXEC SaveSearchFullText	598776
EXEC SaveSearchFullText	127830691
EXEC SaveSearchFullText	72781045
EXEC SaveSearchFullText	96562448