USE UniTrac
SELECT * FROM dbo.LENDER
WHERE CODE_TX = '5201'

SELECT  * INTO UniTracHDStorage.dbo.LOAN_5201_1
FROM    dbo.LOAN
WHERE   LENDER_ID IN ( 853 )
        AND NUMBER_TX IN ( '1563630', '1563630', '1630731', '17231', '2540534',
                           '456330', '456330', '4861533', '775632' )

SELECT * FROM UniTracHDStorage.dbo.LOAN_5201_1


UPDATE  Loan
SET     NUMBER_TX = '15636-30' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0272995'
WHERE   NUMBER_TX = '1563630'
        AND LENDER_ID = 853
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '15636-30' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0272995'
WHERE   NUMBER_TX = '1563630'
        AND LENDER_ID = 853
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '16307-31' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0272995'
WHERE   NUMBER_TX = '1630731'
        AND LENDER_ID = 853
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '172-31' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0272995'
WHERE   NUMBER_TX = '17231'
        AND LENDER_ID = 853
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '25405-34' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0272995'
WHERE   NUMBER_TX = '2540534'
        AND LENDER_ID = 853
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '84011-30' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0272995'
WHERE   NUMBER_TX = '456330'
        AND LENDER_ID = 853
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '84011-30' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0272995'
WHERE   NUMBER_TX = '456330'
        AND LENDER_ID = 853
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '48615-33' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0272995'
WHERE   NUMBER_TX = '4861533'
        AND LENDER_ID = 853
        AND PURGE_DT IS NULL;
UPDATE  Loan
SET     NUMBER_TX = '7756-32' ,
        UPDATE_DT = GETDATE() ,
        UPDATE_USER_TX = 'INC0272995'
WHERE   NUMBER_TX = '775632'
        AND LENDER_ID = 853
        AND PURGE_DT IS NULL;



--2) INSERT into PROPERTY_CHANGE table
INSERT INTO PROPERTY_CHANGE (ENTITY_NAME_TX,ENTITY_ID,USER_TX,ATTACHMENT_IN,CREATE_DT,AGENCY_ID,DETAILS_IN,FORMATTED_IN,LOCK_ID,PARENT_NAME_TX,PARENT_ID,TRANS_STATUS_CD,UTL_IN)
SELECT 'Allied.UniTrac.Loan',LOAN.ID,'INC0272995','N','2016-11-22 00:00:00.000',1,'Y','N',1,'Allied.UniTrac.Loan',LOAN.ID,'PEND','N'
FROM LOAN
WHERE ID IN (SELECT ID FROM UnitracHDStorage.dbo.LOAN_5201_1)
--42


--3) INSERT into PROPERTY_CHANGE_UPDATE table
INSERT INTO PROPERTY_CHANGE_UPDATE (CHANGE_ID, TABLE_NAME_TX, TABLE_ID, COLUMN_NM, FROM_VALUE_TX,TO_VALUE_TX,DATATYPE_NO,CREATE_DT,DISPLAY_IN,OPERATION_CD)
select PROPERTY_CHANGE.ID,'LOAN',ENTITY_ID,'NUMBER_TX',UnitracHDStorage.dbo.LOAN_5201_1.NUMBER_TX,LOAN.NUMBER_TX,1,'2016-11-22 00:00:00.000','Y','U'
from PROPERTY_CHANGE
INNER JOIN LOAN ON PROPERTY_CHANGE.ENTITY_ID = LOAN.ID AND ENTITY_NAME_TX = 'Allied.UniTrac.Loan' 
INNER JOIN UnitracHDStorage.dbo.LOAN_5201_1 ON LOAN.ID = UnitracHDStorage.dbo.LOAN_5201_1.ID --AND ENTITY_NAME_TX = 'Allied.UniTrac.Loan' 
WHERE PROPERTY_CHANGE.CREATE_DT = '2016-11-22 00:00:00.000'
AND ENTITY_ID IN (SELECT ID FROM UnitracHDStorage.dbo.LOAN_5201_1)
--0

---4) Insert into LOAN_NUMBER Table (Leave old numbers for matching purposes)

INSERT INTO LOAN_NUMBER (LOAN_ID,NUMBER_TX,EFFECTIVE_DT,CREATE_DT,UPDATE_DT,UPDATE_USER_TX, LOCK_ID)
SELECT dbo.LOAN.ID, dbo.LOAN.NUMBER_TX,dbo.LOAN.EFFECTIVE_DT,GETDATE(),GETDATE(),'INC0272995',1
FROM UnitracHDStorage.dbo.LOAN_5201_1 HD INNER JOIN dbo.LOAN ON HD.ID = LOAN.ID
--42

--5) Full Text Search Updates

--Create updates
SELECT 'EXEC SaveSearchFullText', PROPERTY.ID 
FROM PROPERTY
INNER JOIN COLLATERAL ON PROPERTY.ID = COLLATERAL.PROPERTY_ID
AND LOAN_ID in (select ID FROM UnitracHDStorage.dbo.LOAN_5201_1)
--42



EXEC SaveSearchFullText	8026913
EXEC SaveSearchFullText	8027142
EXEC SaveSearchFullText	8027144
EXEC SaveSearchFullText	8027146
EXEC SaveSearchFullText	8028760
EXEC SaveSearchFullText	8028761
EXEC SaveSearchFullText	8028762
EXEC SaveSearchFullText	8083025
EXEC SaveSearchFullText	8083024
EXEC SaveSearchFullText	8052531
EXEC SaveSearchFullText	8052530
EXEC SaveSearchFullText	9065797
EXEC SaveSearchFullText	38017140
EXEC SaveSearchFullText	38017134
EXEC SaveSearchFullText	38017383
EXEC SaveSearchFullText	56844973
EXEC SaveSearchFullText	57571841
EXEC SaveSearchFullText	8766130
EXEC SaveSearchFullText	8766137
EXEC SaveSearchFullText	56364619
EXEC SaveSearchFullText	56364620
EXEC SaveSearchFullText	55761576
EXEC SaveSearchFullText	8766137
EXEC SaveSearchFullText	57571840
EXEC SaveSearchFullText	8766130
EXEC SaveSearchFullText	38017373
EXEC SaveSearchFullText	55761575
EXEC SaveSearchFullText	56844972
EXEC SaveSearchFullText	58021447
EXEC SaveSearchFullText	58021448