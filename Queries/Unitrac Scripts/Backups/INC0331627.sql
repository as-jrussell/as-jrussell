USE UniTrac;

SELECT RC.ID INTO #tmp
FROM   dbo.LOAN L
JOIN dbo.COLLATERAL C ON C.LOAN_ID = L.ID
JOIN dbo.PROPERTY P ON P.ID = C.PROPERTY_ID
JOIN dbo.REQUIRED_COVERAGE RC ON RC.PROPERTY_ID = P.ID
JOIN dbo.COLLATERAL_CODE CC ON CC.ID = C.COLLATERAL_CODE_ID
WHERE L.LENDER_ID = 2238 and  L.NUMBER_TX IN ( '0000157310', '0000238501', '0000263124' ,
                        '0000266424' ,'0000271260', '0000283041' ,
                        '0000306979' ,'0000401913', '0000406631' ,
                        '0000407199' ,'0000415107', '0000416599' ,
                        '0000428782' ,'0000435330', '0000443091' ,
                        '0000464483' ,'0000464922', '0000465006' ,
                        '0000469474' ,'0000473373', '0000473689' ,
                        '0000474633' ,'0000476689', '0000478255' ,
                        '0000480258' ,'0000480919', '0000481182' ,
                        '0000481261' ,'0000481284', '0000481399' ,
                        '0000482543' ,'0000482586', '0000485837' ,
                        '0000489512' ,'0000497080', '0000498638' ,
                        '0000504128' ,'0000506073', '0000507476' ,
                        '0000507699' ,'0000516194', '0000518026' ,
                        '0000520833' ,'0000521912', '0000524750' ,
                        '0000527175' ,'0000532142', '0000533449' ,
                        '0000539176' ,'0000540234', '0000547877' ,
                        '0000550173' ,'0000556252', '0000558378' ,
                        '0000563617' ,'0000565750', '0000565766' ,
                        '0000570251' ,'0000570322', '0000571463' ,
                        '0000572969' ,'0000579390', '0000581786' ,
                        '0000583076' ,'0000585473', '0000585674' ,
                        '0000590471' ,'0000590632', '0000590922' ,
                        '0000592132' ,'0000594653', '0000594882' ,
                        '0000594967' ,'0000595287', '0000597140' ,
                        '0000597612' ,'0000599427', '0000600382' ,
                        '0000603122' ,'0000605258', '0000606326' ,
                        '0000607870' ,'0000630220', '0000641709' ,
                        '0000643348' ,'0000649070', '0000650633' ,
                        '0000655248' ,'0000663322', '0000665971' ,
                        '0000667731' ,'0000674063', '0000677320' ,
                        '0000686252' ,'0000688484', '0000698107' ,
                        '0000704869' ,'0000711543', '0000713028' ,
                        '0000720818' ,'0000725040', '0000725515' ,
                        '0000727280' ,'0000727384', '0000728686' ,
                        '0000728932' ,'0000738962', '0000743813' ,
                        '0000759092' ,'0000763596', '0000764685' ,
                        '0000776847' ,'0000781835', '0000783839' ,
                        '0000787639' ,'0000790324', '0000792201' ,
                        '0000793748' ,'0000795517', '0001011329' ,
                        '0001023933' ,'0001029308', '0001040153' ,
                        '0002005178' ,'0002007511', '0002011831' ,
                        '0002015095' ,'0002018530', '0002024794' ,
                        '0002025190' ,'0002034704', '0011026528'
                      );







SELECT * 
INTO UnitracHDStorage..INC0331627
FROM dbo.REQUIRED_COVERAGE
WHERE ID IN (SELECT ID FROM #tmp)
AND TYPE_CD = 'PHYS-DAMAGE'


UPDATE RC SET RC.RECORD_TYPE_CD = 'D', RC.PURGE_DT = GETDATE(), RC.UPDATE_USER_TX = 'INC0331627', LOCK_ID = CASE WHEN LOCK_ID >= 255 THEN 1 ELSE LOCK_ID + 1 END
--SELECT * 
FROM dbo.REQUIRED_COVERAGE RC
WHERE ID IN (SELECT ID FROM UnitracHDStorage..INC0331627)


	
INSERT INTO PROPERTY_CHANGE
 ( ENTITY_NAME_TX , ENTITY_ID , USER_TX , ATTACHMENT_IN , 
 CREATE_DT , AGENCY_ID , DESCRIPTION_TX ,  DETAILS_IN , FORMATTED_IN ,
 LOCK_ID , PARENT_NAME_TX , PARENT_ID , TRANS_STATUS_CD , UTL_IN )
 SELECT DISTINCT 'Allied.UniTrac.RequiredCoverage' , L.ID , 'INC0331627' , 'N' , 
 GETDATE() ,  1 , 
'Deleted Physical Damage', 
 'Y' , 'N' , 1 ,  'Allied.UniTrac.RequiredCoverage' , L.ID , 'PEND' , 'N'
FROM dbo.REQUIRED_COVERAGE L
WHERE L.ID IN (SELECT ID FROM UniTracHDStorage..INC0331627)
