USE [UniTrac]
GO 


--Loan Screen Information - LOAN/COLLATERAL/PROPERTY/OWNER/REQUIRED COVERAGE
Select C.COLLATERAL_CODE_ID, L.*
--INTO #tmp
 FROM LOAN L
INNER JOIN COLLATERAL C ON L.ID = C.LOAN_ID
WHERE L.NUMBER_TX IN ('4000208-2800','767770-2000','594154-2000','4006153-2002', '750620-2003','550700-2000')

Select  * FROM LOAN L
INNER JOIN COLLATERAL C ON L.ID = C.LOAN_ID
INNER JOIN PROPERTY P ON C.PROPERTY_ID = P.ID
INNER JOIN REQUIRED_COVERAGE RC ON P.ID = RC.PROPERTY_ID
INNER JOIN dbo.LENDER LL ON LL.ID = L.LENDER_ID
WHERE LL.CODE_TX IN ('6229') 
AND c.COLLATERAL_CODE_ID = 576 AND L.RECORD_TYPE_CD = 'G'



---Finding Branch
Select LO.TYPE_CD, LO.CODE_TX , Lo.NAME_TX,*
FROM LENDER L
INNER JOIN LENDER_ORGANIZATION LO ON L.ID = LO.LENDER_ID
INNER JOIN RELATED_DATA RD ON LO.ID = RD.RELATE_ID --AND RD.DEF_ID = '105'
WHERE L.CODE_TX = '' AND Lo.TYPE_CD = 'DIV'



---Finding Collateral Code
Select  CC.ID ,
        CC.CODE_TX ,
        CC.DESCRIPTION_TX ,
		CCR.*

         FROM dbo.COLLATERAL_CODE CC
INNER JOIN dbo.LCCG_COLLATERAL_CODE_RELATE CCR ON CCR.COLLATERAL_CODE_ID = CC.ID
INNER JOIN dbo.LENDER_COLLATERAL_CODE_GROUP LCCG ON LCCG.ID = CCR.LCCG_ID
INNER JOIN dbo.LENDER L ON L.ID = LCCG.LENDER_ID
WHERE L.CODE_TX = '6229'
AND CC.ID IN (542,17,18,8,11,527,23,543, 587)



SELECT DISTINCT COLLATERAL_CODE_ID, NUMBER_TX
INTO #tmpCC
 FROM #tmp



 
Select DISTINCT CCR.* 
 --INTO #tmpLCCG
 FROM  dbo.LCCG_COLLATERAL_CODE_RELATE CCR
 JOIN dbo.LENDER_COLLATERAL_CODE_GROUP LCCG ON LCCG.ID = CCR.LCCG_ID
 WHERE LCCG.LENDER_ID = 858 AND CCR.COLLATERAL_CODE_ID = 23


Select * FROM dbo.COLLATERAL_CODE
WHERE ID IN (576)


Select * FROM LCCG_COLLATERAL_CODE_RELATE
WHERE COLLATERAL_CODE_ID IN  (Select DISTINCT C.COLLATERAL_CODE_ID FROM #tmpCC C
 LEFT JOIN #tmpLCCG L ON C.COLLATERAL_CODE_ID = L.COLLATERAL_CODE_ID
 WHERE L.COLLATERAL_CODE_ID IS NULL)


(Select * FROM dbo.LENDER_COLLATERAL_CODE_GROUP
WHERE LENDER_ID IN  (858)

--858


INSERT dbo.LCCG_COLLATERAL_CODE_RELATE
(
    COLLATERAL_CODE_ID,
    LCCG_ID,
    CREATE_DT,
    UPDATE_DT,
    UPDATE_USER_TX,
    PURGE_DT,
    LOCK_ID
)
VALUES
(   576,             -- COLLATERAL_CODE_ID - bigint
    348,             -- LCCG_ID - bigint
    SYSDATETIME(; -- CREATE_DT - datetime2(7)
    SYSDATETIME(; -- UPDATE_DT - datetime2(7)
    N'INC0341797',           -- UPDATE_USER_TX - nvarchar(15)
    NULL, -- PURGE_DT - datetime2(7)
    1              -- LOCK_ID - tinyint
    )

Select DISTINCT C.COLLATERAL_CODE_ID FROM #tmpCC C
 LEFT JOIN #tmpLCCG L ON C.COLLATERAL_CODE_ID = L.COLLATERAL_CODE_ID
 WHERE L.COLLATERAL_CODE_ID IS NULL

INSERT into dbo.LCCG_COLLATERAL_CODE_RELATE
(COLLATERAL_CODE_ID,LCCG_ID,CREATE_DT,UPDATE_DT,UPDATE_USER_TX,PURGE_DT,LOCK_ID)
SELECT 587	 , 348	, SYSDATETIME()	, SYSDATETIME()	, N'INC0341797'	, NULL	, 1;
SELECT 527	 , 348	, SYSDATETIME()	, SYSDATETIME()	, N'INC0341797'	, NULL	, 1;
SELECT 584	 , 348	, SYSDATETIME()	, SYSDATETIME()	, N'INC0341797'	, NULL	, 1;
SELECT 528	 , 348	, SYSDATETIME()	, SYSDATETIME()	, N'INC0341797'	, NULL	, 1;
SELECT 250	 , 348	, SYSDATETIME()	, SYSDATETIME()	, N'INC0341797'	, NULL	, 1;
SELECT 579	 , 348	, SYSDATETIME()	, SYSDATETIME()	, N'INC0341797'	, NULL	, 1;
SELECT 542	 , 348	, SYSDATETIME()	, SYSDATETIME()	, N'INC0341797'	, NULL	, 1;
SELECT 24	 , 348	, SYSDATETIME()	, SYSDATETIME()	, N'INC0341797'	, NULL	, 1;
SELECT 18	 , 348	, SYSDATETIME()	, SYSDATETIME()	, N'INC0341797'	, NULL	, 1;
SELECT 19	 , 348	, SYSDATETIME()	, SYSDATETIME()	, N'INC0341797'	, NULL	, 1;
SELECT 583	 , 348	, SYSDATETIME()	, SYSDATETIME()	, N'INC0341797'	, NULL	, 1;
SELECT 577	 , 348	, SYSDATETIME()	, SYSDATETIME()	, N'INC0341797'	, NULL	, 1;
SELECT 434	 , 348	, SYSDATETIME()	, SYSDATETIME()	, N'INC0341797'	, NULL	, 1;
SELECT 448	 , 348	, SYSDATETIME()	, SYSDATETIME()	, N'INC0341797'	, NULL	, 1;
SELECT 22	 , 348	, SYSDATETIME()	, SYSDATETIME()	, N'INC0341797'	, NULL	, 1;
SELECT 531	 , 348	, SYSDATETIME()	, SYSDATETIME()	, N'INC0341797'	, NULL	, 1;
SELECT 39	 , 348	, SYSDATETIME()	, SYSDATETIME()	, N'INC0341797'	, NULL	, 1;
SELECT 580	 , 348	, SYSDATETIME()	, SYSDATETIME()	, N'INC0341797'	, NULL	, 1;
SELECT 586	 , 348	, SYSDATETIME()	, SYSDATETIME()	, N'INC0341797'	, NULL	, 1;
SELECT 543	 , 348	, SYSDATETIME()	, SYSDATETIME()	, N'INC0341797'	, NULL	, 1;
SELECT 17	 , 348	, SYSDATETIME()	, SYSDATETIME()	, N'INC0341797'	, NULL	, 1;
SELECT 581	 , 348	, SYSDATETIME()	, SYSDATETIME()	, N'INC0341797'	, NULL	, 1;
SELECT 40	 , 348	, SYSDATETIME()	, SYSDATETIME()	, N'INC0341797'	, NULL	, 1;
SELECT 20	 , 348	, SYSDATETIME()	, SYSDATETIME()	, N'INC0341797'	, NULL	, 1;
SELECT 578	 , 348	, SYSDATETIME()	, SYSDATETIME()	, N'INC0341797'	, NULL	, 1