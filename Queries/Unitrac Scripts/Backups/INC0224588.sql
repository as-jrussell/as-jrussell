USE [UniTrac]
GO 


--Loan Screen Information - LOAN/COLLATERAL/PROPERTY/OWNER/REQUIRED COVERAGE
SELECT  L.NUMBER_TX, RC.*
INTO    #tmp
FROM    LOAN L
        INNER JOIN COLLATERAL C ON L.ID = C.LOAN_ID
        INNER JOIN PROPERTY P ON C.PROPERTY_ID = P.ID
        INNER JOIN REQUIRED_COVERAGE RC ON P.ID = RC.PROPERTY_ID
        INNER JOIN OWNER_LOAN_RELATE OL ON L.ID = OL.LOAN_ID
        INNER JOIN OWNER O ON OL.OWNER_ID = O.ID
        INNER JOIN OWNER_ADDRESS OA ON O.ADDRESS_ID = OA.ID
        INNER JOIN dbo.LENDER LL ON LL.ID = L.LENDER_ID
        INNER JOIN dbo.PROPERTY_OWNER_POLICY_RELATE POP ON POP.PROPERTY_ID = P.ID
        INNER JOIN dbo.OWNER_POLICY OP ON OP.ID = POP.OWNER_POLICY_ID
        INNER JOIN dbo.POLICY_COVERAGE PC ON PC.OWNER_POLICY_ID = OP.ID
        INNER JOIN dbo.INTERACTION_HISTORY IH ON IH.PROPERTY_ID = P.ID
                                                 AND IH.RELATE_CLASS_TX = 'Allied.UniTrac.Notice'
        INNER JOIN dbo.NOTICE_REQUIRED_COVERAGE_RELATE NC ON NC.REQUIRED_COVERAGE_ID = RC.ID
        INNER JOIN dbo.NOTICE N ON N.ID = NC.NOTICE_ID
WHERE   LL.CODE_TX = '4357'
        AND L.NUMBER_TX IN ( '9258030-61', '388560-80', '914405-80',
                             '967946-81', '220278-80', '17103-80', '225723-81',
                             '838699-80', '942427-80', '49636-81', '55347-81',
                             '512270-82', '213722-80', '937129-80',
                             '247989-82', '889556-80', '20217-81', '107920-80',
                             '232781-80', '488440-80', '822469-81',
                             '279631-80', '486060-80', '310070-80',
                             '348690-90', '946868-80', '588260-81',
                             '215363-82', '970939-80', '911582-84', '19249-80',
                             '9262640-91', '137920-80', '893021-81',
                             '223336-80', '798931-80', '9281940-91',
                             '825979-80', '2868-80', '852475-80', '895227-81',
                             '826223-80', '884908-80', '895698-80',
                             '762527-80', '222197-80', '43295-80', '246457-81',
                             '1424-81', '858781-81', '950347-80', '228517-81',
                             '586100-90', '842654-83', '816599-80',
                             '751583-80', '36837-80', '13800-80', '48651-81',
                             '890678-80', '766420-80', '343720-90', '31500-81',
                             '908941-80', '907772-80', '272261-80',
                             '218826-83', '9272640-83', '116910-61',
                             '296180-81', '865077-80', '406580-81',
                             '881017-80', '9249260-80', '860602-81',
                             '206803-80', '904867-80', '836679-81',
                             '929341-80', '867106-81', '722202-80',
                             '225575-80', '222057-80', '304450-80',
                             '756175-90', '889026-80', '451040-80', '21285-80',
                             '15949-80', '143160-61', '473700-57', '24251-82',
                             '854199-80', '853470-80', '219917-66',
                             '821093-90', '249567-81', '865989-80',
                             '881073-81', '220796-81', '4594-89', '3699-80',
                             '503000-81', '914938-80', '896129-80',
                             '951416-80', '30753-82', '157050-81', '39288-88',
                             '270230-80', '915729-80', '220298-88', '7772-81',
                             '24716-80', '407730-80', '884659-81', '862025-81',
                             '9259130-91', '886754-80', '900627-81',
                             '75936-80', '908739-80', '886662-80', '225886-83',
                             '17523-80', '71264-80', '83779-83', '778556-90',
                             '33663-80', '130760-94', '66129-80', '79483-80',
                             '26100-80', '470760-43', '925743-80', '614240-90',
                             '906277-80', '878962-80', '912877-80',
                             '853042-81', '353040-80', '9207570-43',
                             '29053-80', '913315-80', '229643-81', '955365-81',
                             '958468-80', '384800-92', '163220-90',
                             '951445-80', '878751-80', '863532-80',
                             '915671-80', '926185-81', '407011-91',
                             '854376-80', '38142-83', '726697-80', '962060-80',
                             '847916-80', '117220-91', '902556-82',
                             '914405-81', '2288775-80', '842471-80',
                             '72773-80', '218620-80', '143120-62', '807013-81',
                             '221833-80', '122530-80', '561360-80',
                             '959641-80', '28266-83', '66539-80', '137900-80',
                             '889552-81', '359990-80', '223078-80',
                             '922131-80', '877541-81', '910149-80', '18162-80',
                             '2231503-80', '890666-80', '257172-81',
                             '934382-80', '716962-80', '755920-93',
                             '838128-80', '721648-90', '213928-80', '54572-82',
                             '584660-90', '818285-80', '858028-80',
                             '868182-84', '21835-80', '17281-88', '948530-80',
                             '895055-80', '864324-80', '64207-84',
                             '9229000-81', '909902-80', '926759-80',
                             '744510-91', '887555-81', '9261640-80',
                             '63053-80', '538410-90', '855005-80',
                             '2265374-80', '955457-81', '917969-80',
                             '862207-83', '205440-80', '70481-80', '823154-83',
                             '821144-57', '895405-80', '18662-83', '289237-80',
                             '201770-80', '853897-80', '809870-82',
                             '210180-80', '44253-80', '304620-80', '223157-82',
                             '407400-90', '2178670-82', '2229785-80',
                             '70692-80', '273940-80', '854858-80', '244214-83',
                             '885950-80', '375740-80', '892933-81',
                             '167980-80', '874458-84', '24463-81', '114429-80',
                             '282940-91', '222570-81', '857954-80',
                             '607780-81', '515760-93', '247108-80', '65835-80',
                             '9433-81', '871634-80', '24080-81', '2266081-80',
                             '866655-80', '435400-80', '135660-80',
                             '155570-82', '962325-81', '878909-80',
                             '915852-80', '914549-80', '8699-82', '236691-80',
                             '611130-58', '925270-80', '925270-81', '81396-82',
                             '858789-80', '88739-81', '835797-80', '922791-80',
                             '59871-80', '93386-85', '798582-80', '657660-80',
                             '962583-80', '876786-81', '762573-80',
                             '902408-80', '9250510-91', '838091-80',
                             '254406-80', '221702-80', '966057-80',
                             '881973-80', '223864-81', '768004-80',
                             '916402-81', '963725-80', '904833-80',
                             '2231701-80', '40491-80', '36071-80', '885897-80',
                             '897187-83', '218618-82', '224920-81',
                             '840305-80', '720558-80', '502721-57',
                             '344890-90', '885127-81', '724745-80',
                             '845820-83', '892744-80', '755860-80',
                             '352550-61', '255805-81', '255805-82',
                             '255805-84', '850739-80', '502510-81',
                             '208914-81', '816985-80', '723373-80',
                             '607810-90', '909010-80', '767808-90',
                             '253058-81', '773054-90', '859297-80',
                             '870571-80', '922556-80', '902262-81',
                             '857376-80', '884573-80', '566970-90',
                             '9212600-80', '242088-80', '488910-80',
                             '727633-80', '224858-80', '944775-81',
                             '912899-80', '363530-91', '816626-80', '43240-90',
                             '864369-80', '908260-80', '17112-80', '841060-82',
                             '894498-81', '862495-80', '906207-80',
                             '225470-81', '71359-80', '214914-69', '891314-80',
                             '928015-80', '335283-80', '338600-83',
                             '807333-90', '721232-91', '56110-81', '195200-81',
                             '191010-81', '856546-81', '839782-81',
                             '373839-81', '886170-80', '518740-80',
                             '421470-90', '888526-80', '83286-88', '918486-80',
                             '223814-82', '223261-80', '223179-83',
                             '347240-91', '626320-90', '281040-83',
                             '629040-80', '725117-80', '221176-80',
                             '874291-80', '390009-81', '719402-80',
                             '902597-80', '470500-92', '909899-80',
                             '874232-81', '9279621-91', '889188-80',
                             '626200-80', '762936-81', '753621-48',
                             '242736-80', '2230266-81', '213154-80',
                             '717883-91', '774034-80', '13758-81', '282540-80',
                             '66943-90', '866819-80', '2086730-80',
                             '886347-80', '199190-80', '220632-81',
                             '9244160-61', '866105-81', '9221311-80',
                             '530270-80', '871798-81', '92797-80', '920456-80',
                             '93670-80', '443160-80', '373790-80', '218820-80',
                             '889958-81', '532260-90', '54279-80', '912654-80',
                             '772897-90', '860774-82', '919709-80', '24638-80',
                             '24638-81', '53748-82', '216597-81', '933559-80',
                             '776796-90', '503560-60', '83201-81', '14549-90',
                             '769148-80', '165560-80', '216556-82',
                             '842031-85', '199230-80', '765091-80',
                             '100610-90', '140220-81', '924307-80',
                             '166330-80', '898486-82', '2261419-80',
                             '891639-80', '923133-80', '18038-86', '426430-80',
                             '928504-80', '69930-81', '198151-61', '915404-80',
                             '905414-80', '217059-83', '9251460-80',
                             '16889-82', '963513-80', '767046-80', '827783-80',
                             '22828-82', '902291-82', '553300-80' )

SELECT  SPECIAL_HANDLING_XML.value('(/SH/Sequence/text)[1]', 'varchar (50)'), * FROM #tmp T
--INNER JOIN dbo.NOTICE N ON T.Relate_ID = N. ID
ORDER BY T.Number_TX ASC

UPDATE dbo.INTERACTION_HISTORY
SET    SPECIAL_HANDLING_XML.modify('replace value of (/SH/Sequence/text())[1] with "1"') ,        
        LOCK_ID = LOCK_ID + 1, UPDATE_DT = GETDATE(),
		UPDATE_USER_TX = 'INC0224588'
--SELECT * FROM #tmp
WHERE  ID = '207625698'

SELECT * FROM UniTracHDStorage..INC0224588_Notice_ID16502874

SELECT *
INTO UniTracHDStorage..INC0224588_Notice
 FROM dbo.NOTICE
WHERE ID IN (SELECT relate_id FROM #tmp)


UPDATE dbo.NOTICE
SET SEQUENCE_NO = '1', LOCK_ID = LOCK_ID + 1, UPDATE_DT = GETDATE(), UPDATE_USER_TX = 'INC0224588'
--SELECT * FROM dbo.NOTICE
WHERE ID IN (SELECT ID FROM UniTracHDStorage..INC0224588_Notice)
AND NOTICE.LOAN_ID = '144235568'

SELECT * FROM dbo.LENDER
WHERE ID = '2266'
SELECT * FROM dbo.LOAN
WHERE ID IN (144236871)

SELECT * FROM dbo.PROCESS_LOG_ITEM
WHERE PROCESS_LOG_ID = '31421803'
AND RELATE_ID IN (SELECT RELATE_ID FROM #tmp)


SELECT * FROM dbo.PROCESS_LOG
WHERE ID = '31421803'


SELECT WQ.NAME_TX, WQ.DESCRIPTION_TX, WD.NAME_TX, WI.* FROM dbo.WORK_ITEM WI
INNER JOIN dbo.WORK_QUEUE WQ ON WQ.ID = WI.CURRENT_QUEUE_ID
INNER JOIN dbo.WORKFLOW_DEFINITION WD ON WD.ID = WI.WORKFLOW_DEFINITION_ID 
--INNER JOIN dbo.WORK_ITEM_ACTION WIA ON WIA.WORK_ITEM_ID = WI.ID
WHERE wi.ID = '29810428'


SELECT * FROM dbo.PROCESS_DEFINITION
WHERE ID = '230135'


SELECT * FROM dbo.LOAN
WHERE NUMBER_TX = '107920-80'

SELECT * FROM #tmp
WHERE NUMBER_TX = '107920-80'


SELECT L.NUMBER_TX, N.* FROM dbo.NOTICE N
INNER JOIN dbo.LOAN L ON L.ID = N.LOAN_ID
WHERE N.ID = '16502447'



SELECT *
FROM UniTracHDStorage..INC0224588_RC
