USE UniTrac

SELECT DISTINCT TP.EXTERNAL_ID_TX  [Lender Code] ,
       tp.NAME_TX [Lender Name] ,
	   CCU.QUALIFIER_TX [Division],
	    PD.TYPE_CD [Pre-Processing Details],
        CU.TO_VALUE_TX [Enable First Line Of Insurance],
		 C.CREATE_DT [Enable First Line Of Insurance Added],
		RD.VALUE_TX [Import Configurations]
		FROM    dbo.PREPROCESSING_DETAIL PD
        INNER JOIN dbo.PPDATTRIBUTE PPD ON PPD.PREPROCESSING_DETAIL_ID = PD.ID AND PPD.CODE_CD = 'EnableFirstLineOfInsurance' 
        INNER JOIN dbo.DELIVERY_INFO_GROUP D ON D.ID = PD.DELIVERY_INFO_GROUP_ID AND PD.TYPE_CD = 'Informatica'
        INNER JOIN dbo.DELIVERY_INFO DD ON DD.ID = D.DELIVERY_INFO_ID
        INNER JOIN dbo.TRADING_PARTNER TP ON TP.ID = DD.TRADING_PARTNER_ID
        INNER JOIN dbo.DELIVERY_INFO_DELIVER_TO_TP_RELATE DT ON DT.DELIVERY_INFO_ID = DD.ID
		INNER JOIN dbo.DELIVERY_INFO_EXTRACT_CONFIG_RELATE DIE ON DIE.DELIVERY_INFO_ID = DD.ID
		INNER JOIN dbo.CHANGE C ON C.ENTITY_ID = DD.ID AND C.ENTITY_NAME_TX = 'LDHLib.DeliveryInfo'
		INNER JOIN dbo.CHANGE_UPDATE CU ON C.ID = CU.CHANGE_ID  AND Cu.QUALIFIER_TX like '%Enable 1st Line of Insurance Processing%'
		INNER JOIN dbo.CHANGE CC ON CC.ENTITY_ID = DD.ID AND CC.ENTITY_NAME_TX = 'LDHLib.DeliveryInfo'
		INNER JOIN dbo.CHANGE_UPDATE CCU ON CC.ID = CCU.CHANGE_ID AND CCu.QUALIFIER_TX like '%Contract Data%'
		LEFT OUTER JOIN RELATED_DATA_DEF rdd	ON (rdd.RELATE_CLASS_NM = 'DeliveryInfo' AND rdd.NAME_TX = 'UniTracDeliveryType')
		INNER JOIN dbo.RELATED_DATA RD ON RDD.ID = RD.DEF_ID  
		INNER JOIN dbo.LENDER_ORGANIZATION LO ON LO.ID = RD.RELATE_ID AND Lo.TYPE_CD = 'DIV'
		WHERE   CU.TO_VALUE_TX   IN ('Y', 'N') AND 
		DIE.PURGE_DT IS NULL AND
		 RD.VALUE_TX = 'IMPORT'  AND CCU.TO_VALUE_TX = 'Added'
		 ORDER BY CCU.CREATE_DT DESC


