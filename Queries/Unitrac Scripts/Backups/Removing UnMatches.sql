USE UniTrac 


SELECT L.* 
INTO #tmpFPC
FROM LOAN L
JOIN dbo.FORCE_PLACED_CERTIFICATE FPC ON FPC.LOAN_ID = L.ID
WHERE L.LENDER_ID = 2238 AND L.STATUS_CD = 'U'
AND L.RECORD_TYPE_CD NOT IN ('A', 'D') AND L.ID NOT IN ('227467670','224191593', '224177837', '224178615', '224178666', '224179864',
                '224180837', '224181752', '224181919', '224181995',
                '224182393', '224183430', '224183623', '224187952',
                '224188159', '224188230', '224188546', '224191593',
                '224192947', '224193095', '224194084', '224514202',
                '225565057', '225986799', '226049655', '226050632',
                '227243697', '227467670', '228083613', '228909540',
                '229611246', '230634245', '233495401', '234735034',
                '235262402', '224061841', '224063397', '224065734',
                '224065941', '224067153', '224071816', '224081529',
                '224085837', '224086734', '224088309', '224090152',
                '224090499', '224094628', '224095243', '224096205',
                '224096548', '224096980', '224097687', '224097913',
                '224107285', '224108220', '224109163', '224109373',
                '224110780', '224111324', '224112012', '224112341',
                '224112816', '224114366', '224115056', '224115434',
                '224115630', '224117003', '224117252', '224120448',
                '224122470', '224124602', '224125782', '224126281',
                '224127265', '224127414', '224128436', '224128739',
                '224130421', '224132280', '224133517', '224135893',
                '224135983', '224136389', '224137985', '224138238',
                '224138851', '224139272', '224140816', '224141057',
                '224146527', '224147851', '224149165', '224152052',
                '224155715', '224156743', '224159851', '224160254',
                '224162016', '224162071', '224166105', '224167111',
                '224168508', '224170019', '224170571', '224171502',
                '224171852', '224173013', '224173319', '224175460' )
--58



SELECT L.* 
INTO #tmpNOFPC
FROM dbo.LOAN L
WHERE LENDER_ID = 2238
AND L.STATUS_CD = 'U'
AND L.ID NOT IN (SELECT L.ID FROM LOAN L JOIN dbo.FORCE_PLACED_CERTIFICATE FPC ON FPC.LOAN_ID = L.ID WHERE L.LENDER_ID = 2238 AND L.STATUS_CD = 'U') 
AND L.ID NOT IN ('227467670','224191593', '224177837', '224178615', '224178666', '224179864',
                '224180837', '224181752', '224181919', '224181995',
                '224182393', '224183430', '224183623', '224187952',
                '224188159', '224188230', '224188546', '224191593',
                '224192947', '224193095', '224194084', '224514202',
                '225565057', '225986799', '226049655', '226050632',
                '227243697', '227467670', '228083613', '228909540',
                '229611246', '230634245', '233495401', '234735034',
                '235262402', '224061841', '224063397', '224065734',
                '224065941', '224067153', '224071816', '224081529',
                '224085837', '224086734', '224088309', '224090152',
                '224090499', '224094628', '224095243', '224096205',
                '224096548', '224096980', '224097687', '224097913',
                '224107285', '224108220', '224109163', '224109373',
                '224110780', '224111324', '224112012', '224112341',
                '224112816', '224114366', '224115056', '224115434',
                '224115630', '224117003', '224117252', '224120448',
                '224122470', '224124602', '224125782', '224126281',
                '224127265', '224127414', '224128436', '224128739',
                '224130421', '224132280', '224133517', '224135893',
                '224135983', '224136389', '224137985', '224138238',
                '224138851', '224139272', '224140816', '224141057',
                '224146527', '224147851', '224149165', '224152052',
                '224155715', '224156743', '224159851', '224160254',
                '224162016', '224162071', '224166105', '224167111',
                '224168508', '224170019', '224170571', '224171502',
                '224171852', '224173013', '224173319', '224175460' ) 

--33334

UPDATE L
SET L.RECORD_TYPE_CD = 'A', L.UPDATE_DT = GETDATE(), L.UPDATE_USER_TX = 'INC0330199', LOCK_ID = CASE WHEN LOCK_ID >= 255 THEN 1 ELSE LOCK_ID + 1 END
--SELECT * 
FROM dbo.LOAN L
WHERE ID IN (SELECT ID FROM #tmpFPC)



declare @rowcount int = 1000
while @rowcount >= 1000
BEGIN
 BEGIN TRY
 UPDATE TOP (1000) L
SET L.RECORD_TYPE_CD = 'D', L.UPDATE_DT = GETDATE(), L.UPDATE_USER_TX = 'INC0330199', LOCK_ID = CASE WHEN LOCK_ID >= 255 THEN 1 ELSE LOCK_ID + 1 END
--SELECT * 
FROM dbo.LOAN L
WHERE ID IN (SELECT ID FROM #tmpNOFPC)
and L.RECORD_TYPE_CD != 'D' 

 select @rowcount = @@rowcount
 END TRY
 BEGIN CATCH
  select Error_number(),
      error_message(),
      error_severity(),
    error_state(),
    error_line()
   THROW
   BREAK
 END CATCH
END
