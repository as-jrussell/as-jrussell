/*

Logon to https://portal.azure.com/

Click Home
Click rfpl-sql-prod
Click on the "listed databases" 
Click on Restore
	Keep all the information the same: 
		Subscription: SQL DB
		Resource Group: RG-SQLDB-RFPL-PROD
		Source Database: XXXXXXXX
		Select Source: Point-In-Time
		Earliest Restore Point XXXX-XX-XX XX:XX UTC
		Restore Point (UTC) 03/30/2022 08:45:00 PM 


Database Name: XXXXXXXX_2022-03-31T04-29Z
Managed Instance: rfpl-sql-prod (RG-SQLDB-RFPL-PROD/GeneralPurpose) 

*/


/*
Core:
PRL_USERS_PROD
PRL_ALLIEDSYS_PROD



Client:
PRL_HUNTINGTON_5392_PROD
PRL_ENTCREDITUNION_2107_PROD
PRL_FIRSTINVESTORS_7441_PROD
PRL_PNC_6525_PROD
PRL_AIRACADEMY_1555_PRO
PRL_BLUEFCU_1894_PRODD
PRL_WESTERRA_537_PROD
PRL_SELCO_572_PROD
PRL_PARTNERS_6321_PROD
PRL_APLUS_661_PROD
PRL_VELOCITY_4008_PROD

*/

/*

Rename the old database to with the suffix _OLD

*/

EXEC sp_renamedb 'PRL_TEXASDOW_731_PROD','PRL_TEXASDOW_731_PROD_OLD'
EXEC sp_renamedb 'PRL_HUNTINGTON_5392_PROD','PRL_HUNTINGTON_5392_PROD_OLD'
EXEC sp_renamedb 'PRL_ALLIEDSYS_PROD', 'PRL_ALLIEDSYS_PROD_OLD'
EXEC sp_renamedb 'PRL_USERS_PROD','PRL_USERS_PROD_OLD'
EXEC sp_renamedb 'PRL_PNC_6525_PROD','PRL_PNC_6525_PROD_OLD'
EXEC sp_renamedb 'PRL_ENTCREDITUNION_2107_PROD','PRL_ENTCREDITUNION_2107_PROD_OLD'
EXEC sp_renamedb 'PRL_FIRSTINVESTORS_7441_PROD','PRL_FIRSTINVESTORS_7441_PROD_OLD'
EXEC sp_renamedb 'PRL_AIRACADEMY_1555_PROD', 'PRL_AIRACADEMY_1555_PROD_OLD'
EXEC sp_renamedb 'PRL_BLUEFCU_1894_PROD','PRL_BLUEFCU_1894_PROD_OLD'
EXEC sp_renamedb 'PRL_WESTERRA_537_PROD','PRL_WESTERRA_537_PROD_OLD'
EXEC sp_renamedb 'PRL_SELCO_572_PROD', 'PRL_SELCO_572_PROD_OLD'
EXEC sp_renamedb 'PRL_PARTNERS_6321_PROD', 'PRL_PARTNERS_6321_PROD_OLD'
EXEC sp_renamedb 'PRL_APLUS_661_PROD', 'PRL_APLUS_661_PROD_OLD'
EXEC sp_renamedb 'PRL_VELOCITY_4008_PROD', 'PRL_VELOCITY_4008_PROD_OLD'


/*

Rename the restored database to Production name

*/


EXEC sp_renamedb 'PRL_TEXASDOW_731_PROD_2022-03-30T20-45Z', 'PRL_TEXASDOW_731_PROD'
EXEC sp_renamedb 'PRL_HUNTINGTON_5392_PROD_2022-03-30T20-45Z', 'PRL_HUNTINGTON_5392_PROD'
EXEC sp_renamedb 'PRL_ALLIEDSYS_PROD_2022-03-30T20-45Z', 'PRL_ALLIEDSYS_PROD'
EXEC sp_renamedb 'PRL_USERS_PROD_2022-03-30T20-45Z', 'PRL_USERS_PROD'
EXEC sp_renamedb 'PRL_PNC_6525_PROD_2022-03-30T20-45Z', 'PRL_PNC_6525_PROD'
EXEC sp_renamedb 'PRL_ENTCREDITUNION_2107_PROD_2022-03-30T20-45Z', 'PRL_ENTCREDITUNION_2107_PROD'
EXEC sp_renamedb 'PRL_FIRSTINVESTORS_7441_PROD_2022-03-30T20-45Z', 'PRL_FIRSTINVESTORS_7441_PROD'
EXEC sp_renamedb 'PRL_AIRACADEMY_1555_PROD_2022-03-30T20-45Z', 'PRL_AIRACADEMY_1555_PROD'
EXEC sp_renamedb 'PRL_BLUEFCU_1894_PROD_2022-03-30T20-45Z', 'PRL_BLUEFCU_1894_PROD'
EXEC sp_renamedb 'PRL_WESTERRA_537_PROD_2022-03-30T20-45Z', 'PRL_WESTERRA_537_PROD'
EXEC sp_renamedb 'PRL_SELCO_572_PROD_2022-03-30T20-45Z', 'PRL_SELCO_572_PROD'
EXEC sp_renamedb 'PRL_PARTNERS_6321_PROD_2022-03-30T20-45Z', 'PRL_PARTNERS_6321_PROD'
EXEC sp_renamedb 'PRL_APLUS_661_PROD_2022-03-30T20-45Z', 'PRL_APLUS_661_PROD'
EXEC sp_renamedb 'PRL_VELOCITY_4008_PROD_2022-03-30T20-45Z', 'PRL_VELOCITY_4008_PROD'


SELECT CONCAT('DROP DATABASE [', name, ']')
from sys.databases
where name like '%_old'









